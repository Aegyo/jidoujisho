var so=Object.defineProperty;var uo=(t,e,n)=>e in t?so(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var we=(t,e,n)=>(uo(t,typeof e!="symbol"?e+"":e,n),n);import{S as Qe,i as Ze,n as xe,a0 as fo,e as lt,a1 as co,a as G,Q as st,f as E,ad as Lt,h as ho,j as U,w as he,s as $,k as J,l as Q,x as de,c as ee,m as W,ae as L,p as F,y as me,_ as Pe,d as H,g as Ge,t as X,b as Ne,z as ge,af as Gt,a2 as j,a8 as nn,ag as Rn,ac as oe,O as Y,a3 as on,q as ae,r as le,u as Fe,ah as sn,ai as se,aj as ue,o as zn,a6 as mo,a7 as go,N as ko,ak as po,a9 as Ln,ab as un,aa as bo}from"../../../chunks/singletons-54206af0.js";import{a as Co,p as Gn,b as Nn,i as _o,c as Ft,e as ft,h as vo,j as wo,k as So,l as je,o as nt,s as kt,m as _e,n as Nt,F as Be,q as Qt,r as Hn,t as Je,u as mt,v as Zt,w as xt,R as yo,x as $t,V as Et,y as rn,z as Mo,A as Po,B as Fo,N as Eo,C as Do,D as Xe,f as fn,d as ht,E as Bo,S as Io,G as To,H as Ao,g as Vo,I as Oo,J as en,K as tn,L as Ro,M as Yt,O as zo,P as Lo,Q as Go,T as No,U as Ho,W as qo,X as Wo,Y as Xo,Z as jo,_ as Ko,$ as Yo,a0 as Uo,a1 as Jo}from"../../../chunks/format-page-title-24d86e72.js";import{p as Qo}from"../../../chunks/stores-41bc0127.js";import{p as qn,l as Bt,m as pt,_ as _t,q as Zo,O as Ye,i as tt,n as xo,j as $o,B as It,a as Me,w as er,d as cn}from"../../../chunks/dialog-manager-6307dd27.js";import{m as tr,t as Te,g as Wn,a as Xn,c as bt,p as hn,f as dn,b as nr,i as jn}from"../../../chunks/index-63863b80.js";import{F as He,f as Ct,a as or,M as rr,m as Tt,b as ir,c as ar,d as lr,e as sr,g as ur,h as Kn}from"../../../chunks/merged-header-icon-aec892cb.js";import{r as ot,a as fr}from"../../../chunks/theme-option-7cf46fe1.js";var gt={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,r=gt.delegate;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=e(function(i){n=void 0,t(i)});return new qn(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=gt.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Bt([],pt(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=gt.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,Bt([],pt(t)))},delegate:void 0},cr=function(t){_t(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(qn),At={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=At.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,Bt([t,e],pt(n))):setInterval.apply(void 0,Bt([t,e],pt(n)))},clearInterval:function(t){var e=At.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Yn=function(t){_t(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){var o;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),At.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&At.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Zo(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(cr),mn=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Co.now,t}(),Un=function(t){_t(e,t);function e(n,r){r===void 0&&(r=mn.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(mn),Ht=new Un(Yn),hr=Ht,dr=function(t){_t(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o}return e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,r,o):(n.actions.push(this),n._scheduled||(n._scheduled=gt.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,r,o){var i;if(o===void 0&&(o=0),o!=null?o>0:this.delay>0)return t.prototype.recycleAsyncId.call(this,n,r,o);var a=n.actions;r!=null&&((i=a[a.length-1])===null||i===void 0?void 0:i.id)!==r&&(gt.cancelAnimationFrame(r),n._scheduled=void 0)},e}(Yn),mr=function(t){_t(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var o=this.actions,i;n=n||o.shift();do if(i=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===r&&o.shift());if(this._active=!1,i){for(;(n=o[0])&&n.id===r&&o.shift();)n.unsubscribe();throw i}},e}(Un),qt=new mr(dr),ut=new Ye(function(t){return t.complete()});function an(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Gn(t);return Nn(t,n)}function gr(t){return t instanceof Date&&!isNaN(t)}var kr=["addListener","removeListener"],pr=["addEventListener","removeEventListener"],br=["on","off"];function Ke(t,e,n,r){if(tt(n)&&(r=n,n=void 0),r)return Ke(t,e,n).pipe(tr(r));var o=pt(vr(t)?pr.map(function(l){return function(u){return t[l](e,u,n)}}):Cr(t)?kr.map(gn(t,e)):_r(t)?br.map(gn(t,e)):[],2),i=o[0],a=o[1];if(!i&&_o(t))return Ft(function(l){return Ke(l,e,n)})(ft(t));if(!i)throw new TypeError("Invalid event target");return new Ye(function(l){var u=function(){for(var c=[],m=0;m<arguments.length;m++)c[m]=arguments[m];return l.next(1<c.length?c:c[0])};return i(u),function(){return a(u)}})}function gn(t,e){return function(n){return function(r){return t[n](e,r)}}}function Cr(t){return tt(t.addListener)&&tt(t.removeListener)}function _r(t){return tt(t.on)&&tt(t.off)}function vr(t){return tt(t.addEventListener)&&tt(t.removeEventListener)}function Wt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=hr);var r=-1;return e!=null&&(vo(e)?n=e:r=e),new Ye(function(o){var i=gr(t)?+t-n.now():t;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function wr(t,e){return t===void 0&&(t=0),e===void 0&&(e=Ht),t<0&&(t=0),Wt(t,t,e)}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Gn(t),r=wo(t,1/0),o=t;return o.length?o.length===1?ft(o[0]):So(r)(Nn(o,n)):ut}var Sr=Array.isArray;function yr(t){return t.length===1&&Sr(t[0])?t[0]:t}function Mr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=yr(t),t.length===1?ft(t[0]):new Ye(Pr(t))}function Pr(t){return function(e){for(var n=[],r=function(i){n.push(ft(t[i]).subscribe(je(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==i&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)r(o)}}function Fr(t){return nt(function(e,n){var r=!1,o=null,i=null,a=function(){if(i==null||i.unsubscribe(),i=null,r){r=!1;var l=o;o=null,n.next(l)}};e.subscribe(je(n,function(l){i==null||i.unsubscribe(),r=!0,o=l,i=je(n,a,xo),ft(t(l)).subscribe(i)},function(){a(),n.complete()},void 0,function(){o=i=null}))})}function Vt(t,e){return e===void 0&&(e=Ht),nt(function(n,r){var o=null,i=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var c=i;i=null,r.next(c)}};function u(){var c=a+t,m=e.now();if(m<c){o=this.schedule(void 0,c-m),r.add(o);return}l()}n.subscribe(je(r,function(c){i=c,a=e.now(),o||(o=e.schedule(u,t),r.add(o))},function(){l(),r.complete()},void 0,function(){i=o=null}))})}function vt(t){return t<=0?function(){return ut}:nt(function(e,n){var r=0;e.subscribe(je(n,function(o){++r<=t&&(n.next(o),t<=r&&n.complete())}))})}function Jn(t,e){return e===void 0&&(e=$o),t=t??Er,nt(function(n,r){var o,i=!0;n.subscribe(je(r,function(a){var l=e(a);(i||!t(o,l))&&(i=!1,o=l,r.next(a))}))})}function Er(t,e){return t===e}function Dr(t){return nt(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function Br(){return nt(function(t,e){var n,r=!1;t.subscribe(je(e,function(o){var i=n;n=o,r&&e.next([i,o]),r=!0}))})}var Qn={leading:!0,trailing:!1};function Ir(t,e){return e===void 0&&(e=Qn),nt(function(n,r){var o=e.leading,i=e.trailing,a=!1,l=null,u=null,c=!1,m=function(){u==null||u.unsubscribe(),u=null,i&&(h(),c&&r.complete())},d=function(){u=null,c&&r.complete()},g=function(b){return u=ft(t(b)).subscribe(je(r,m,d))},h=function(){if(a){a=!1;var b=l;l=null,r.next(b),!c&&g(b)}};n.subscribe(je(r,function(b){a=!0,l=b,!(u&&!u.closed)&&(o?h():g(b))},function(){c=!0,!(i&&a&&u&&!u.closed)&&r.complete()}))})}function Tr(t,e,n){e===void 0&&(e=Ht),n===void 0&&(n=Qn);var r=Wt(t,e);return Ir(function(){return r},n)}const ln=new It([]),Ot=new Me,wt=new Me,at=new Me;function Zn(t){const e=t.filter(i=>!i.parentChapter);let n=t.find(i=>i.progress<100);n||(n=t[t.length-1]);const r=n.parentChapter||n.reference,o=e.findIndex(i=>i.reference===r);return[e,o,r]}function Ar(t){let e,n;return{c(){e=new fo(!1),n=lt(),this.h()},l(r){e=co(r,!1),n=lt(),this.h()},h(){e.a=n},m(r,o){e.m(t[0],r,o),G(r,n,o)},p(r,[o]){o&1&&e.p(r[0])},i:st,o:st,d(r){r&&E(n),r&&e.d()}}}function Vr(t,e,n){let{html:r}=e;const o=Lt();return ho(()=>{o("load")}),t.$$set=i=>{"html"in i&&n(0,r=i.html)},[r]}class xn extends Qe{constructor(e){super(),Ze(this,e,Vr,Ar,xe,{html:0})}}class Or{constructor(e,n,r,o,i=qt){we(this,"enabled$",new It(!1));this.multiplier=e,this.verticalMode=n,this.enabled$.pipe(kt(a=>{if(!a)return ut;let l=0;return wr(0,i).pipe(_e(()=>Date.now()),Br(),_e(u=>this.calcNewPos(u)),_e(u=>{l+=u;const c=Math.trunc(l);return l-=c,c}),Nt(u=>u!==0))}),Te(r)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,n]){let r=.00365956;return this.verticalMode&&(r=-91489e-8),r*this.multiplier*(n-e)}}function rt(t,e){return e==="rtl"?-t:t}class Rr{constructor(e,n,r){this.calculator=e,this.window=n,this.firstDimensionMargin=r}scrollToBookmark(e){const n=this.getBookmarkPosition(e);if(!n)return;const{scrollToData:r}=kn(n,this.firstDimensionMargin);this.window.scrollTo(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount,{verticalMode:o}=this.calculator,i=o?"scrollX":"scrollY";return{dataId:e,exploredCharCount:n,progress:n/r,[i]:this.window[i],lastBookmarkModified:new Date().getTime()}}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return kn(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,r=this.getBookmarkTargetPosByScrollValue(e);if(r)return r;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,r=o=>{const i=e[o];if(!i)return;const a=rt(i,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:i}};return this.calculator.verticalMode?r("scrollX"):r("scrollY")}}function kn(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}function zr(t){const e=(n,r,o,i)=>{if(o<r)return t??o;const a=Math.floor((r+o)/2);return n[a]===i?a:n[a]>i?e(n,r,a-1,i):e(n,a+1,o,i)};return(n,r)=>e(n,0,n.length-1,r)}const Rt=zr(void 0);class $n{constructor(e,n,r,o,i){we(this,"charCount");we(this,"accumulatedCharCount");we(this,"paragraphPos");we(this,"paragraphs");we(this,"paragraphPosToAccCharCount",new Map);this.containerEl=e,this.axis=n,this.direction=r,this.scrollEl=o,this.document=i,this.paragraphs=Wn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=Xn(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),r=rt(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),i=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],u=this.getNodeBoundingRect(l),m=(()=>(this.verticalMode?u.width:u.height)<=0?this.paragraphPos[a-1]||0:rt(this.verticalMode?u.left:u.bottom,this.direction)-r-o+e)();this.paragraphPos[a]=m;const d=i.get(m)||[];i.set(m,d),d.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(i.entries()).map(([a,l])=>[a,Math.max(...l.map(u=>this.accumulatedCharCount[u]))]))}calcExploredCharCount(){return this.getCharCountByScrollPos(this.scrollPos)}getCharCountByScrollPos(e){const n=Rt(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getScrollPosByCharCount(e){const n=Rt(this.accumulatedCharCount,e);return rt(this.paragraphPos[n],this.direction)}getNodeBoundingRect(e){const n=this.document.createRange();return n.selectNode(e),n.getBoundingClientRect()}get scrollPos(){return rt(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}function Lr(t,e,n){const r=Hr(e,n)(t,"scrollLeft");return(o,i,a)=>{if(!Gr(o))return;const l=Nr(o,i,a);r(-l),o.preventDefault()}}function Gr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function Nr(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function Hr(t,e){return(n,r)=>{let o=!1,i=t[r],a=t[r];const l=()=>{o=!0;const u=Math.trunc((i-t[r])/n);if(t[r]!==a){o=!1;return}if(a+=u,t.scrollBy(u,0),Math.abs(u)>0){e(l);return}o=!1};return u=>{o||(i=t[r],a=t[r]),i+=u,o||e(l)}}}class qr{constructor(e,n,r){this.verticalMode=e,this.firstDimensionMargin=n,this.window=r}nextPage(){this.scrollByPercent(.9)}prevPage(){this.scrollByPercent(-.9)}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,r="top",o=1;this.verticalMode&&(n=this.window.innerWidth,r="left",o=-1);const i=n-this.firstDimensionMargin*2;this.window.scrollBy({[r]:i*e*o,behavior:"smooth"})}}const{document:Wr,window:Xr}=Rn;function pn(t){let e,n,r,o,i;return{c(){e=U("div"),r=$(),o=U("div"),this.h()},l(a){e=J(a,"DIV",{class:!0,style:!0}),Q(e).forEach(E),r=ee(a),o=J(a,"DIV",{class:!0,style:!0}),Q(o).forEach(E),this.h()},h(){W(e,"class","fixed z-[5]"),W(e,"style",n=t[21]+": 100%; "+t[20]+": "+t[14]+"px; "+t[19][0]+": 0"),L(e,"inset-y-0",t[2]),L(e,"inset-x-0",!t[2]),F(e,"background-color",t[4]),W(o,"class","fixed z-[5]"),W(o,"style",i=t[21]+": 100%; "+t[20]+": "+t[14]+"px; "+t[19][1]+": 0"),L(o,"inset-y-0",t[2]),L(o,"inset-x-0",!t[2]),F(o,"background-color",t[4])},m(a,l){G(a,e,l),G(a,r,l),G(a,o,l)},p(a,l){l[0]&3686400&&n!==(n=a[21]+": 100%; "+a[20]+": "+a[14]+"px; "+a[19][0]+": 0")&&W(e,"style",n),l[0]&4&&L(e,"inset-y-0",a[2]),l[0]&4&&L(e,"inset-x-0",!a[2]),l[0]&16&&F(e,"background-color",a[4]),l[0]&3686400&&i!==(i=a[21]+": 100%; "+a[20]+": "+a[14]+"px; "+a[19][1]+": 0")&&W(o,"style",i),l[0]&4&&L(o,"inset-y-0",a[2]),l[0]&4&&L(o,"inset-x-0",!a[2]),l[0]&16&&F(o,"background-color",a[4])},d(a){a&&E(e),a&&E(r),a&&E(o)}}}function bn(t){let e,n,r,o;const i=[Kr,jr],a=[];function l(u,c){return u[2]?0:1}return e=l(t),n=a[e]=i[e](t),{c(){n.c(),r=lt()},l(u){n.l(u),r=lt()},m(u,c){a[e].m(u,c),G(u,r,c),o=!0},p(u,c){let m=e;e=l(u),e===m?a[e].p(u,c):(Ge(),X(a[m],1,1,()=>{a[m]=null}),Ne(),n=a[e],n?n.p(u,c):(n=a[e]=i[e](u),n.c()),H(n,1),n.m(r.parentNode,r))},i(u){o||(H(n),o=!0)},o(u){X(n),o=!1},d(u){a[e].d(u),u&&E(r)}}}function jr(t){let e,n,r;return n=new He({props:{icon:Ct}}),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(o){e=J(o,"DIV",{class:!0});var i=Q(e);de(n.$$.fragment,i),i.forEach(E),this.h()},h(){W(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),F(e,"color",t[3]),F(e,"left",t[16]),F(e,"top",`calc(${t[17].top} + 1.5rem)`)},m(o,i){G(o,e,i),me(n,e,null),r=!0},p(o,i){i[0]&8&&F(e,"color",o[3]),i[0]&65536&&F(e,"left",o[16]),i[0]&131072&&F(e,"top",`calc(${o[17].top} + 1.5rem)`)},i(o){r||(H(n.$$.fragment,o),r=!0)},o(o){X(n.$$.fragment,o),r=!1},d(o){o&&E(e),ge(n)}}}function Kr(t){let e,n,r;return n=new He({props:{icon:Ct}}),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(o){e=J(o,"DIV",{class:!0});var i=Q(e);de(n.$$.fragment,i),i.forEach(E),this.h()},h(){W(e,"class","pointer-events-none absolute text-xl opacity-25"),F(e,"color",t[3]),F(e,"right",`calc(${t[17].right} + 1rem)`),F(e,"top",t[16])},m(o,i){G(o,e,i),me(n,e,null),r=!0},p(o,i){i[0]&8&&F(e,"color",o[3]),i[0]&131072&&F(e,"right",`calc(${o[17].right} + 1rem)`),i[0]&65536&&F(e,"top",o[16])},i(o){r||(H(n.$$.fragment,o),r=!0)},o(o){X(n.$$.fragment,o),r=!1},d(o){o&&E(e),ge(n)}}}function Yr(t){let e,n,r=`${t[7]}px`,o=`${t[18]||t[1]}px`,i,a,l,u,c,m;n=new xn({props:{html:t[0]}}),n.$on("load",t[24]);let d=t[14]&&pn(t),g=t[17]&&bn(t);return{c(){e=U("div"),he(n.$$.fragment),i=$(),d&&d.c(),a=$(),g&&g.c(),l=$(),this.h()},l(h){e=J(h,"DIV",{class:!0});var b=Q(e);de(n.$$.fragment,b),b.forEach(E),i=ee(h),d&&d.l(h),a=ee(h),g&&g.l(h),l=ee(h),this.h()},h(){W(e,"class","book-content m-auto svelte-16svyqf"),L(e,"book-content--writing-vertical-rl",t[2]),L(e,"book-content--writing-horizontal-rl",!t[2]),L(e,"book-content--hide-furigana",t[11]),L(e,"book-content--hide-spoiler-image",t[10]),L(e,"book-content--furigana-style-partial",t[12]===Be.Partial),L(e,"book-content--furigana-style-full",t[12]===Be.Full),L(e,"book-content--furigana-style-toggle",t[12]===Be.Toggle),F(e,"color",t[3]),F(e,"font-size",r),F(e,"max-width",!t[2]&&t[13]?`${t[13]}px`:void 0),F(e,"max-height",t[18]?`${t[18]}px`:void 0),F(e,"padding-left",t[2]&&t[14]?`${t[14]}px`:void 0),F(e,"padding-right",t[2]&&t[14]?`${t[14]}px`:void 0),F(e,"padding-top",!t[2]&&t[14]?`${t[14]}px`:void 0),F(e,"padding-bottom",!t[2]&&t[14]?`${t[14]}px`:void 0),F(e,"--font-family-serif",t[8]),F(e,"--font-family-sans-serif",t[9]),F(e,"--book-content-hint-furigana-font-color",t[5]),F(e,"--book-content-hint-furigana-shadow-color",t[6]),F(e,"--book-content-child-height",o)},m(h,b){G(h,e,b),me(n,e,null),t[41](e),G(h,i,b),d&&d.m(h,b),G(h,a,b),g&&g.m(h,b),G(h,l,b),u=!0,c||(m=[Pe(Xr,"scroll",t[23]),Pe(Wr.body,"wheel",t[22],{passive:!1})],c=!0)},p(h,b){const w={};b[0]&1&&(w.html=h[0]),n.$set(w),(!u||b[0]&4)&&L(e,"book-content--writing-vertical-rl",h[2]),(!u||b[0]&4)&&L(e,"book-content--writing-horizontal-rl",!h[2]),(!u||b[0]&2048)&&L(e,"book-content--hide-furigana",h[11]),(!u||b[0]&1024)&&L(e,"book-content--hide-spoiler-image",h[10]),(!u||b[0]&4096)&&L(e,"book-content--furigana-style-partial",h[12]===Be.Partial),(!u||b[0]&4096)&&L(e,"book-content--furigana-style-full",h[12]===Be.Full),(!u||b[0]&4096)&&L(e,"book-content--furigana-style-toggle",h[12]===Be.Toggle),b[0]&8&&F(e,"color",h[3]),b[0]&128&&r!==(r=`${h[7]}px`)&&F(e,"font-size",r),b[0]&8196&&F(e,"max-width",!h[2]&&h[13]?`${h[13]}px`:void 0),b[0]&262144&&F(e,"max-height",h[18]?`${h[18]}px`:void 0),b[0]&16388&&F(e,"padding-left",h[2]&&h[14]?`${h[14]}px`:void 0),b[0]&16388&&F(e,"padding-right",h[2]&&h[14]?`${h[14]}px`:void 0),b[0]&16388&&F(e,"padding-top",!h[2]&&h[14]?`${h[14]}px`:void 0),b[0]&16388&&F(e,"padding-bottom",!h[2]&&h[14]?`${h[14]}px`:void 0),b[0]&256&&F(e,"--font-family-serif",h[8]),b[0]&512&&F(e,"--font-family-sans-serif",h[9]),b[0]&32&&F(e,"--book-content-hint-furigana-font-color",h[5]),b[0]&64&&F(e,"--book-content-hint-furigana-shadow-color",h[6]),b[0]&262146&&o!==(o=`${h[18]||h[1]}px`)&&F(e,"--book-content-child-height",o),h[14]?d?d.p(h,b):(d=pn(h),d.c(),d.m(a.parentNode,a)):d&&(d.d(1),d=null),h[17]?g?(g.p(h,b),b[0]&131072&&H(g,1)):(g=bn(h),g.c(),H(g,1),g.m(l.parentNode,l)):g&&(Ge(),X(g,1,1,()=>{g=null}),Ne())},i(h){u||(H(n.$$.fragment,h),H(g),u=!0)},o(h){X(n.$$.fragment,h),X(g),u=!1},d(h){h&&E(e),ge(n),t[41](null),h&&E(i),d&&d.d(h),h&&E(a),g&&g.d(h),h&&E(l),c=!1,Gt(m)}}}function Ur(t,e,n){let r,o,i,a,l;j(t,at,y=>n(47,l=y));let{htmlContent:u}=e,{width:c}=e,{height:m}=e,{verticalMode:d}=e,{fontColor:g}=e,{backgroundColor:h}=e,{hintFuriganaFontColor:b}=e,{hintFuriganaShadowColor:w}=e,{fontSize:s}=e,{fontFamilyGroupOne:f}=e,{fontFamilyGroupTwo:k}=e,{hideSpoilerImage:B}=e,{hideFurigana:T}=e,{furiganaStyle:q}=e,{secondDimensionMaxValue:O}=e,{firstDimensionMargin:V}=e,{autoPositionOnResize:Z}=e,{autoBookmark:M}=e,{loadingState:N}=e,{multiplier:I}=e,{bookmarkData:R}=e,{exploredCharCount:v}=e,{bookCharCount:A}=e,{autoScroller:z}=e,{bookmarkManager:C}=e,{pageManager:P}=e;const x=Lt();let D,K,re={},ie,fe,be,Se,ke,Ee=0,pe=!1,ve=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem";const Re=Lr(4,document.documentElement,requestAnimationFrame),ze=new Me,Ae=new Me,Ce=new Me,ce=new Map,Ve=new Map;let Oe=0,Ie=!1;nn(()=>{Ce.next(),Ce.complete()}),ie=new Or(I,d,Ce,document),z=ie,bt([ze,Ae]).pipe(Nt(()=>Z),Qt(1),_e(([y,ne])=>d?ne:y),Jn(),Vt(10),Hn(qt),Te(Ce)).subscribe(()=>{if(!K||!be)return;const y=K.getScrollPosByCharCount(Ee);pe=!0,be.scrollTo(y)});function $e(y){y.updateParagraphPos(),n(25,v=y.calcExploredCharCount()),ke&&(ke=!1,R.then(ne=>{!ne||!C||(Ee=ne.exploredCharCount||0,C.scrollToBookmark(ne))}).finally(()=>{M&&Ke(window,"scroll").pipe(Qt(1),Vt(3e3),Te(Ce)).subscribe(()=>{x("bookmark")}),ln.pipe(vt(1),kt(ne=>ne.length?(ne.forEach(We=>{const De=We.reference,Le=document.getElementById(De);Le&&(Oe||(Oe=Number(getComputedStyle(Le)[d?"marginLeft":"marginBottom"].replace(/px$/,""))/2),Ve.set(De,{...We,progress:0}),ce.set(De,Le))}),ce.size?(Ue(),Ke(window,"scroll")):ut):ut),Fr(()=>Wt(Ie?100:500)),Te(Ce)).subscribe(Ue)})),n(37,re={})}function Ue(){const y=[...Ve.entries()];for(let ne=0,{length:We}=y;ne<We;ne+=1){const[De,Le]=y[ne],p=ce.get(De).getBoundingClientRect();Le.progress=d?Math.min(Math.max(p.right+(V||0)-window.innerWidth,0),p.width)/(p.width||1)*100:Math.abs(Math.min(Math.max(p.top-(V||0),-p.height),0))/(p.height||1)*100,Ve.set(De,Le)}Ie=!1,Ot.next(Ve)}function qe(y){d&&!l&&Re(y,s,window.innerWidth)}function et(){requestAnimationFrame(()=>{!K||(n(25,v=K.calcExploredCharCount()),pe||(Ee=v),pe=!1)})}function S(){!D||(n(36,K=new $n(D,d?"vertical":"horizontal",d?"rtl":"ltr",document.documentElement,document)),n(25,v=0),Ee=v,n(26,A=K.charCount),x("contentChange",D))}wt.pipe(Te(Ce)).subscribe(y=>{let ne=document.getElementById(y);if(!ne)return;ne=!y.startsWith(hn)&&ne.closest(`div[id^="${hn}"]`)||ne,Ie=!0;const De=ne.getBoundingClientRect();d?window.scrollBy(-(window.innerWidth-De.right-(V||0)-Oe),0):window.scrollBy(0,De.top-(V||0)-Oe)});function te(y){oe[y?"unshift":"push"](()=>{D=y,n(15,D)})}return t.$$set=y=>{"htmlContent"in y&&n(0,u=y.htmlContent),"width"in y&&n(30,c=y.width),"height"in y&&n(1,m=y.height),"verticalMode"in y&&n(2,d=y.verticalMode),"fontColor"in y&&n(3,g=y.fontColor),"backgroundColor"in y&&n(4,h=y.backgroundColor),"hintFuriganaFontColor"in y&&n(5,b=y.hintFuriganaFontColor),"hintFuriganaShadowColor"in y&&n(6,w=y.hintFuriganaShadowColor),"fontSize"in y&&n(7,s=y.fontSize),"fontFamilyGroupOne"in y&&n(8,f=y.fontFamilyGroupOne),"fontFamilyGroupTwo"in y&&n(9,k=y.fontFamilyGroupTwo),"hideSpoilerImage"in y&&n(10,B=y.hideSpoilerImage),"hideFurigana"in y&&n(11,T=y.hideFurigana),"furiganaStyle"in y&&n(12,q=y.furiganaStyle),"secondDimensionMaxValue"in y&&n(13,O=y.secondDimensionMaxValue),"firstDimensionMargin"in y&&n(14,V=y.firstDimensionMargin),"autoPositionOnResize"in y&&n(31,Z=y.autoPositionOnResize),"autoBookmark"in y&&n(32,M=y.autoBookmark),"loadingState"in y&&n(33,N=y.loadingState),"multiplier"in y&&n(34,I=y.multiplier),"bookmarkData"in y&&n(35,R=y.bookmarkData),"exploredCharCount"in y&&n(25,v=y.exploredCharCount),"bookCharCount"in y&&n(26,A=y.bookCharCount),"autoScroller"in y&&n(27,z=y.autoScroller),"bookmarkManager"in y&&n(28,C=y.bookmarkManager),"pageManager"in y&&n(29,P=y.pageManager)},t.$$.update=()=>{if(t.$$.dirty[0]&4&&n(21,r=d?"height":"width"),t.$$.dirty[0]&4&&n(20,o=d?"width":"height"),t.$$.dirty[0]&4&&n(19,i=d?["left","right"]:["top","bottom"]),t.$$.dirty[0]&1073741824&&ze.next(c),t.$$.dirty[0]&2&&Ae.next(m),t.$$.dirty[0]&8196&&n(18,a=d&&O?O:void 0),t.$$.dirty[0]&106500&&O&&D){const y=Number(getComputedStyle(D)[d?"marginTop":"marginRight"].replace(/px$/,""));n(16,ve=`min(max(calc(${`${y}px - ${ve}`}), ${ve}), ${y?`${y}px`:ve})`)}if(t.$$.dirty[0]&1&&u&&(ke=!0),t.$$.dirty[0]&1073741826|t.$$.dirty[1]&36&&K&&c&&m&&!N){const y=K;requestAnimationFrame(()=>{$e(y)})}t.$$.dirty[0]&4|t.$$.dirty[1]&136&&ie&&(n(38,ie.multiplier=I,ie),n(38,ie.verticalMode=d,ie)),t.$$.dirty[0]&16384|t.$$.dirty[1]&288&&K&&(n(39,fe=K&&new Rr(K,window,V||0)),n(28,C=fe)),t.$$.dirty[1]&336&&re&&(n(17,Se=void 0),R.then(y=>{!y||n(17,Se=fe==null?void 0:fe.getBookmarkBarPosition(y))})),t.$$.dirty[0]&16388|t.$$.dirty[1]&512&&(n(40,be=new qr(d,V,window)),n(29,P=be))},[u,m,d,g,h,b,w,s,f,k,B,T,q,O,V,D,ve,Se,a,i,o,r,qe,et,S,v,A,z,C,P,c,Z,M,N,I,R,K,re,ie,fe,be,te]}class Jr extends Qe{constructor(e){super(),Ze(this,e,Ur,Yr,xe,{htmlContent:0,width:30,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontSize:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,hideSpoilerImage:10,hideFurigana:11,furiganaStyle:12,secondDimensionMaxValue:13,firstDimensionMargin:14,autoPositionOnResize:31,autoBookmark:32,loadingState:33,multiplier:34,bookmarkData:35,exploredCharCount:25,bookCharCount:26,autoScroller:27,bookmarkManager:28,pageManager:29},null,[-1,-1])}}const Qr="px-4 md:px-8";function Zr(t){const e=Array.from(t.getElementsByTagName("img"));return new Ye(n=>{const r=e.filter(i=>i.src).map(xr);if(r.length<=0){n.next(!1),n.complete();return}const o=bt(r).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function xr(t){return t.complete?an(1):Mr(Ke(t,"load"),Ke(t,"error"))}function $r(t,e){const n=ei(t),r=ni(t);return o=>Xt(n(o),ti(o,e),r(o))}function ei(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const r=n.map(o=>zt(o).pipe(Je(()=>wt.next(o.hash.substring(1)))));return Xt(...r)}}function ti(t,e){const n=e===Be.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(i=>n?zt(i).pipe(Je(()=>{i.classList.toggle("reveal-rt")})):zt(i).pipe(vt(1),Je(()=>{i.classList.add("reveal-rt")})));return Xt(...o)}function ni(t){return e=>{const r=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const i=t.createElement("span");return i.classList.add("spoiler-label"),i.setAttribute("aria-hidden","true"),i.innerText="ネタバレ",o.appendChild(i),zt(o).pipe(vt(1),Je(()=>{o.removeChild(i),o.removeAttribute("data-ttu-spoiler-img")}))});return Xt(...r)}}function zt(t){return Ke(t,"click").pipe(Je(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const oi=300,ri=60,eo="none";function dt(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function ii(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function yt(t,e,n,r,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:r.length}}))}function ai(t,e,n,r,o,i=eo){e.style.touchAction=i;let a=[];function l(c){a.push(c),yt(e,t,c,a,"down"),r==null||r(a,c);const m=c.pointerId;function d(f){m===f.pointerId&&(a=ii(f,a),a.length||g(),yt(e,t,f,a,"up"),o==null||o(a,f))}function g(){h(),b(),w(),s()}const h=dt(e,"pointermove",f=>{a=a.map(k=>f.pointerId===k.pointerId?f:k),yt(e,t,f,a,"move"),n==null||n(a,f)}),b=dt(e,"lostpointercapture",f=>{d(f)}),w=dt(e,"pointerup",f=>{d(f)}),s=dt(e,"pointerleave",f=>{a=[],g(),yt(e,t,f,a,"up"),o==null||o(a,f)})}const u=dt(e,"pointerdown",l);return{destroy:()=>{u()}}}function li(t,e={timeframe:oi,minSwipeDistance:ri,touchAction:eo}){const n="swipe";let r,o,i,a;function l(c,m){o=m.clientX,i=m.clientY,r=Date.now(),c.length===1&&(a=m.target)}function u(c,m){if(m.type==="pointerup"&&c.length===0&&Date.now()-r<e.timeframe){const d=m.clientX-o,g=m.clientY-i,h=Math.abs(d),b=Math.abs(g);let w=null;h>=2*b&&h>e.minSwipeDistance?w=d>0?"right":"left":b>=2*h&&b>e.minSwipeDistance&&(w=g>0?"bottom":"top"),w&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:w,target:a}}))}}return ai(n,t,null,l,u,e.touchAction)}class si{constructor(e,n,r,o,i){this.calculator=e,this.pageManager=n,this.sectionReady$=r,this.sectionIndex$=o,this.setIntendedCharCount=i}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const r=this.calculator.getSectionIndexByCharCount(n),o=l=>{const u=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(u,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===r){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount;return{dataId:e,exploredCharCount:n,progress:n/r,lastBookmarkModified:new Date().getTime()}}}class ui{constructor(e,n,r,o,i,a,l,u,c,m,d){we(this,"translateX",0);we(this,"sectionData",new Map);this.contentEl=e,this.scrollEl=n,this.sections=r,this.sectionIndex$=o,this.virtualScrollPos$=i,this.width=a,this.height=l,this.pageGap=u,this.verticalMode=c,this.pageChange$=m,this.sectionRenderComplete$=d,ln.pipe(vt(1)).subscribe(g=>{!g.length||(g.forEach(h=>{this.sectionData.set(h.reference,{...h,progress:0})}),Ot.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",r=this.verticalMode?this.height:this.width,o=r+this.pageGap,i=!0;if(this.translateX){const d=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const g=this.translateX;d(),this.scrollToPos(-g-o,i);return}if(this.nextSection(i)){d();return}return}const a=0,l=this.scrollEl[n],u=this.virtualScrollPos$.getValue(),c=u+o*e,m=Math.ceil(c);if(m<a){if(u!==a){this.scrollToPos(a,i);return}this.prevSection(o,n,r,i);return}if(m>=l){this.nextSection(i);return}this.scrollOrTranslateToPos(c,l,r,i)}scrollTo(e,n){const r=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[r],o,n)}prevSection(e,n,r,o){const i=this.sectionIndex$.getValue()-1;return i<0?!1:(this.updateSectionIndex(i).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,r,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{var r,o;this.scrollToPos(0,e),this.updateSectionData((r=this.sections[n-1])==null?void 0:r.id,100,!1),this.updateSectionData((o=this.sections[n])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,n,r,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/n*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+r<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new Ye(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const r=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),r.unsubscribe()});return this.sectionIndex$.next(e),r})}updateSectionData(e,n,r=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let i=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),u=a.reference===e;u?l.progress=n:i?l.progress=0:l.progress=100,!i&&u&&(i=!0),this.sectionData.set(a.reference,l)}),r&&Ot.next(this.sectionData)}}class fi{constructor(e,n,r,o,i,a,l,u,c){we(this,"charCount");we(this,"sectionAccCharCounts");we(this,"sectionIndex",-1);we(this,"calculator");this.containerEl=e,this.sections=n,this.virtualScrollPos$=r,this.getWidth=o,this.getHeight=i,this.getPageGap=a,this.verticalMode=l,this.scrollEl=u,this.document=c;const m=g=>Wn(g).reduce((b,w)=>b+Xn(w),0);let d=0;this.sectionAccCharCounts=n.map(g=>(d+=m(g),d)),this.charCount=d}updateCurrentSection(e){this.calculator=new $n(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(){const e=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+e)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return Rt(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),r=this.sectionAccCharCounts[this.sectionIndex],o=e-n,i=e===r&&r-n>0;if(o<0||e>r||i)return-1;if(o===0)return 0;const a=Rt(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:u}=this.calculator,c=l[a];if(Number.isNaN(Number(u[a])))return-1;const m=(w,s)=>w>=s?s:l[w]>c?w:m(w+1,s),d=u[m(a+1,l.length-1)],{screenSize:g}=this,h=this.verticalMode?-1:0,b=g*(Math.ceil(d/g)+h);return rt(b,this.calculator.direction)}isCharOnScreen(e){const n=this.getScrollPosByCharCount(e),r=this.virtualScrollPos$.getValue();return n===r}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}}function Cn(t){let e,n,r;return n=new He({props:{icon:or,spin:!0}}),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(o){e=J(o,"DIV",{class:!0});var i=Q(e);de(n.$$.fragment,i),i.forEach(E),this.h()},h(){W(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),F(e,"color",t[4]),F(e,"background-color",t[5])},m(o,i){G(o,e,i),me(n,e,null),r=!0},p(o,i){i[0]&16&&F(e,"color",o[4]),i[0]&32&&F(e,"background-color",o[5])},i(o){r||(H(n.$$.fragment,o),r=!0)},o(o){X(n.$$.fragment,o),r=!1},d(o){o&&E(e),ge(n)}}}function _n(t){let e,n,r;return n=new He({props:{icon:Ct}}),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(o){e=J(o,"DIV",{class:!0});var i=Q(e);de(n.$$.fragment,i),i.forEach(E),this.h()},h(){W(e,"class","fixed top-3 right-3 text-xl opacity-25"),F(e,"color",t[4])},m(o,i){G(o,e,i),me(n,e,null),r=!0},p(o,i){i[0]&16&&F(e,"color",o[4])},i(o){r||(H(n.$$.fragment,o),r=!0)},o(o){X(n.$$.fragment,o),r=!1},d(o){o&&E(e),ge(n)}}}function ci(t){let e,n,r,o=`${t[8]}px`,i=`${t[1]}px`,a=`${t[2]}px`,l=`${t[3]?t[1]:(t[1]+it)/t[20]-it}px`,u,c,m,d,g,h;r=new xn({props:{html:t[19]}}),r.$on("load",t[21]);let b=!t[18]&&Cn(t),w=t[0]&&_n(t);return{c(){e=U("div"),n=U("div"),he(r.$$.fragment),u=$(),b&&b.c(),c=$(),w&&w.c(),m=lt(),this.h()},l(s){e=J(s,"DIV",{class:!0});var f=Q(e);n=J(f,"DIV",{class:!0});var k=Q(n);de(r.$$.fragment,k),k.forEach(E),f.forEach(E),u=ee(s),b&&b.l(s),c=ee(s),w&&w.l(s),m=lt(),this.h()},h(){W(n,"class","book-content-container svelte-gdq9ru"),W(e,"class","book-content m-auto svelte-gdq9ru"),L(e,"book-content--avoid-page-break",t[14]),L(e,"book-content--writing-vertical-rl",t[3]),L(e,"book-content--writing-horizontal-rl",!t[3]),L(e,"book-content--hide-furigana",t[12]),L(e,"book-content--hide-spoiler-image",t[11]),L(e,"book-content--furigana-style-partial",t[13]===Be.Partial),L(e,"book-content--furigana-style-full",t[13]===Be.Full),L(e,"book-content--furigana-style-toggle",t[13]===Be.Toggle),F(e,"color",t[4]),F(e,"font-size",o),F(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0),F(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0),F(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0),F(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0),F(e,"max-width",t[1]?`${t[1]}px`:void 0),F(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0),F(e,"--font-family-serif",t[9]),F(e,"--font-family-sans-serif",t[10]),F(e,"--book-content-hint-furigana-font-color",t[6]),F(e,"--book-content-hint-furigana-shadow-color",t[7]),F(e,"--book-content-child-width",i),F(e,"--book-content-child-height",a),F(e,"--book-content-child-column-width",!t[3]&&t[20]===1?`${t[1]}px`:""),F(e,"--book-content-column-count",t[20]),F(e,"--book-content-image-max-width",l)},m(s,f){G(s,e,f),Y(e,n),me(r,n,null),t[37](n),t[38](e),G(s,u,f),b&&b.m(s,f),G(s,c,f),w&&w.m(s,f),G(s,m,f),d=!0,g||(h=[Pe(window,"keydown",t[23]),on(li.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),Pe(e,"swipe",t[22])],g=!0)},p(s,f){const k={};f[0]&524288&&(k.html=s[19]),r.$set(k),(!d||f[0]&16384)&&L(e,"book-content--avoid-page-break",s[14]),(!d||f[0]&8)&&L(e,"book-content--writing-vertical-rl",s[3]),(!d||f[0]&8)&&L(e,"book-content--writing-horizontal-rl",!s[3]),(!d||f[0]&4096)&&L(e,"book-content--hide-furigana",s[12]),(!d||f[0]&2048)&&L(e,"book-content--hide-spoiler-image",s[11]),(!d||f[0]&8192)&&L(e,"book-content--furigana-style-partial",s[13]===Be.Partial),(!d||f[0]&8192)&&L(e,"book-content--furigana-style-full",s[13]===Be.Full),(!d||f[0]&8192)&&L(e,"book-content--furigana-style-toggle",s[13]===Be.Toggle),f[0]&16&&F(e,"color",s[4]),f[0]&256&&o!==(o=`${s[8]}px`)&&F(e,"font-size",o),f[0]&32776&&F(e,"padding-top",!s[3]&&s[15]?`${s[15]}px`:void 0),f[0]&32776&&F(e,"padding-bottom",!s[3]&&s[15]?`${s[15]}px`:void 0),f[0]&32776&&F(e,"padding-left",s[3]&&s[15]?`${s[15]}px`:void 0),f[0]&32776&&F(e,"padding-right",s[3]&&s[15]?`${s[15]}px`:void 0),f[0]&2&&F(e,"max-width",s[1]?`${s[1]}px`:void 0),f[0]&12&&F(e,"max-height",s[3]&&s[2]?`${s[2]}px`:void 0),f[0]&512&&F(e,"--font-family-serif",s[9]),f[0]&1024&&F(e,"--font-family-sans-serif",s[10]),f[0]&64&&F(e,"--book-content-hint-furigana-font-color",s[6]),f[0]&128&&F(e,"--book-content-hint-furigana-shadow-color",s[7]),f[0]&2&&i!==(i=`${s[1]}px`)&&F(e,"--book-content-child-width",i),f[0]&4&&a!==(a=`${s[2]}px`)&&F(e,"--book-content-child-height",a),f[0]&1048586&&F(e,"--book-content-child-column-width",!s[3]&&s[20]===1?`${s[1]}px`:""),f[0]&1048576&&F(e,"--book-content-column-count",s[20]),f[0]&1048586&&l!==(l=`${s[3]?s[1]:(s[1]+it)/s[20]-it}px`)&&F(e,"--book-content-image-max-width",l),s[18]?b&&(Ge(),X(b,1,1,()=>{b=null}),Ne()):b?(b.p(s,f),f[0]&262144&&H(b,1)):(b=Cn(s),b.c(),H(b,1),b.m(c.parentNode,c)),s[0]?w?(w.p(s,f),f[0]&1&&H(w,1)):(w=_n(s),w.c(),H(w,1),w.m(m.parentNode,m)):w&&(Ge(),X(w,1,1,()=>{w=null}),Ne())},i(s){d||(H(r.$$.fragment,s),H(b),H(w),d=!0)},o(s){X(r.$$.fragment,s),X(b),X(w),d=!1},d(s){s&&E(e),ge(r),t[37](null),t[38](null),s&&E(u),b&&b.d(s),s&&E(c),w&&w.d(s),s&&E(m),g=!1,Gt(h)}}}const vn="overflow-hidden",it=20;function hi(t,e,n){let r,o;j(t,at,S=>n(42,o=S));let{htmlContent:i}=e,{width:a}=e,{height:l}=e,{verticalMode:u}=e,{fontColor:c}=e,{backgroundColor:m}=e,{hintFuriganaFontColor:d}=e,{hintFuriganaShadowColor:g}=e,{fontSize:h}=e,{fontFamilyGroupOne:b}=e,{fontFamilyGroupTwo:w}=e,{hideSpoilerImage:s}=e,{hideFurigana:f}=e,{furiganaStyle:k}=e,{loadingState:B}=e,{bookmarkData:T}=e,{pageManager:q}=e,{bookmarkManager:O}=e,{exploredCharCount:V}=e,{bookCharCount:Z}=e,{isBookmarkScreen:M=!1}=e,{avoidPageBreak:N=!0}=e,{pageColumns:I}=e,{firstDimensionMargin:R}=e,{autoBookmark:v=!1}=e;const A=Lt();let z,C,P,x=[],D,K,re,ie=!1,fe="",be=!0,Se=0;const ke=new Me,Ee=new Me,pe=new It(-1),ve=new Me,Re=new It(0),ze=new Me,Ae=new Me,Ce=pe.pipe(_e(S=>{var te;return((te=x[S])==null?void 0:te.innerHTML)||""})),ce=new Me;nn(()=>{document.body.classList.remove(vn),ce.next(),ce.complete()}),bt([ke,Ee]).pipe(Qt(1),kt(()=>Ae.pipe(vt(1))),Te(ce)).subscribe(()=>{if(!P||!D)return;const S=P.getScrollPosByCharCount(Se);S<0||D.scrollTo(S,!1)}),ve.pipe(Te(ce)).subscribe(S=>{!P||(n(26,V=P.calcExploredCharCount()),S&&(Se=V),T.then(Ie))}),v&&ve.pipe(Vt(3e3),Te(ce)).subscribe(S=>{S&&A("bookmark")}),Ce.pipe(Jn(),Te(ce)).subscribe(()=>{n(18,ie=!1)}),Ce.pipe(Te(ce)).subscribe(S=>{const te=(y,ne)=>{if(ne===0){y();return}requestAnimationFrame(()=>te(y,ne-1))};te(()=>{n(19,fe=S)},2)}),mt(()=>Ke(document.body,"wheel",{passive:!0})).pipe(Tr(50),Te(ce)).subscribe(S=>{if(!o){let te=(S.deltaX<0?-1:1)*(u?-1:1);S.deltaX||(te=S.deltaY<0?-1:1),D==null||D.flipPage(te)}});function Ve(){if(be){be=!1;return}!z||(n(33,P=new fi(z,x,Re,()=>a,()=>l,()=>it,u,z,document)),n(26,V=0),Se=0,n(27,Z=P.charCount),P.updateCurrentSection(pe.getValue()),A("contentChange",z))}function Oe(S){S.updateParagraphPos(),n(26,V=S.calcExploredCharCount()),Ae.next(S),T.then(Ie),re&&(re=!1,T.then(te=>{!te||!O||O.scrollToBookmark(te)})),n(18,ie=!0)}function Ie(S){const te=S==null?void 0:S.exploredCharCount;!P||!te||n(0,M=P.isCharOnScreen(te))}function $e(S){if(!D||o||S.detail.direction!=="left"&&S.detail.direction!=="right")return;const te=S.detail.direction==="left",y=u?!te:te;D.flipPage(y?1:-1)}function Ue(S){if(!(!D||o))switch(S.code){case"ArrowLeft":D[u?"nextPage":"prevPage"]();break;case"ArrowRight":D[u?"prevPage":"nextPage"]();break;case"ArrowUp":D.prevPage();break;case"ArrowDown":D.nextPage();break}}wt.pipe(Te(ce)).subscribe(S=>{const te=x.findIndex(y=>y.id===S||y.querySelector(`[id="${S}"]`));te>-1&&(pe.next(te),D==null||D.scrollTo(0,!0))});function qe(S){oe[S?"unshift":"push"](()=>{C=S,n(17,C)})}function et(S){oe[S?"unshift":"push"](()=>{z=S,n(16,z)})}return t.$$set=S=>{"htmlContent"in S&&n(28,i=S.htmlContent),"width"in S&&n(1,a=S.width),"height"in S&&n(2,l=S.height),"verticalMode"in S&&n(3,u=S.verticalMode),"fontColor"in S&&n(4,c=S.fontColor),"backgroundColor"in S&&n(5,m=S.backgroundColor),"hintFuriganaFontColor"in S&&n(6,d=S.hintFuriganaFontColor),"hintFuriganaShadowColor"in S&&n(7,g=S.hintFuriganaShadowColor),"fontSize"in S&&n(8,h=S.fontSize),"fontFamilyGroupOne"in S&&n(9,b=S.fontFamilyGroupOne),"fontFamilyGroupTwo"in S&&n(10,w=S.fontFamilyGroupTwo),"hideSpoilerImage"in S&&n(11,s=S.hideSpoilerImage),"hideFurigana"in S&&n(12,f=S.hideFurigana),"furiganaStyle"in S&&n(13,k=S.furiganaStyle),"loadingState"in S&&n(29,B=S.loadingState),"bookmarkData"in S&&n(30,T=S.bookmarkData),"pageManager"in S&&n(24,q=S.pageManager),"bookmarkManager"in S&&n(25,O=S.bookmarkManager),"exploredCharCount"in S&&n(26,V=S.exploredCharCount),"bookCharCount"in S&&n(27,Z=S.bookCharCount),"isBookmarkScreen"in S&&n(0,M=S.isBookmarkScreen),"avoidPageBreak"in S&&n(14,N=S.avoidPageBreak),"pageColumns"in S&&n(31,I=S.pageColumns),"firstDimensionMargin"in S&&n(15,R=S.firstDimensionMargin),"autoBookmark"in S&&n(32,v=S.autoBookmark)},t.$$.update=()=>{if(t.$$.dirty[0]&1073741824&&T.then(Ie),t.$$.dirty[0]&2&&a&&ke.next(a),t.$$.dirty[0]&4&&l&&Ee.next(l),t.$$.dirty[0]&10|t.$$.dirty[1]&1&&n(20,r=u?1:I||Math.ceil(a/1e3)),t.$$.dirty[0]&268435456&&i&&(re=!0),t.$$.dirty[0]&268435456){const S=document.createElement("div");S.innerHTML=i,n(34,x=Array.from(S.children)),pe.next(0)}if(t.$$.dirty[0]&196622|t.$$.dirty[1]&24&&C&&z&&x&&(n(35,D=new ui(C,z,x,pe,Re,a,l,it,u,ve,ze)),n(24,q=D)),t.$$.dirty[0]&536870918|t.$$.dirty[1]&4&&P&&a&&l&&!B){const S=P;requestAnimationFrame(()=>{Oe(S)})}t.$$.dirty[0]&536870912|t.$$.dirty[1]&4&&P&&!B&&ze.next(pe.getValue()),t.$$.dirty[1]&52&&P&&D&&(n(36,K=new si(P,D,Ae,pe,S=>Se=S)),n(25,O=K))},document.body.classList.add(vn),[M,a,l,u,c,m,d,g,h,b,w,s,f,k,N,R,z,C,ie,fe,r,Ve,$e,Ue,q,O,V,Z,i,B,T,I,v,P,x,D,K,qe,et]}class di extends Qe{constructor(e){super(),Ze(this,e,hi,ci,xe,{htmlContent:28,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,loadingState:29,bookmarkData:30,pageManager:24,bookmarkManager:25,exploredCharCount:26,bookCharCount:27,isBookmarkScreen:0,avoidPageBreak:14,pageColumns:31,firstDimensionMargin:15,autoBookmark:32},null,[-1,-1])}}function mi(t){let e,n,r,o,i,a,l,u;function c(s){t[48](s)}function m(s){t[49](s)}function d(s){t[50](s)}function g(s){t[51](s)}function h(s){t[52](s)}function b(s){t[53](s)}let w={htmlContent:t[7],width:t[28]??0,height:t[29]??0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],loadingState:t[30]??!0,avoidPageBreak:t[22],pageColumns:t[23],autoBookmark:t[24],firstDimensionMargin:t[20]};return t[0]!==void 0&&(w.exploredCharCount=t[0]),t[1]!==void 0&&(w.bookCharCount=t[1]),t[6]!==void 0&&(w.isBookmarkScreen=t[6]),t[2]!==void 0&&(w.bookmarkData=t[2]),t[4]!==void 0&&(w.bookmarkManager=t[4]),t[5]!==void 0&&(w.pageManager=t[5]),e=new di({props:w}),oe.push(()=>se(e,"exploredCharCount",c,t[0])),oe.push(()=>se(e,"bookCharCount",m,t[1])),oe.push(()=>se(e,"isBookmarkScreen",d,t[6])),oe.push(()=>se(e,"bookmarkData",g,t[2])),oe.push(()=>se(e,"bookmarkManager",h,t[4])),oe.push(()=>se(e,"pageManager",b,t[5])),e.$on("contentChange",t[54]),e.$on("bookmark",t[55]),{c(){he(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,f){me(e,s,f),u=!0},p(s,f){const k={};f[0]&128&&(k.htmlContent=s[7]),f[0]&268435456&&(k.width=s[28]??0),f[0]&536870912&&(k.height=s[29]??0),f[0]&256&&(k.verticalMode=s[8]),f[0]&512&&(k.fontColor=s[9]),f[0]&1024&&(k.backgroundColor=s[10]),f[0]&2048&&(k.hintFuriganaFontColor=s[11]),f[0]&4096&&(k.hintFuriganaShadowColor=s[12]),f[0]&8192&&(k.fontSize=s[13]),f[0]&16384&&(k.fontFamilyGroupOne=s[14]),f[0]&32768&&(k.fontFamilyGroupTwo=s[15]),f[0]&65536&&(k.hideSpoilerImage=s[16]),f[0]&131072&&(k.hideFurigana=s[17]),f[0]&262144&&(k.furiganaStyle=s[18]),f[0]&1073741824&&(k.loadingState=s[30]??!0),f[0]&4194304&&(k.avoidPageBreak=s[22]),f[0]&8388608&&(k.pageColumns=s[23]),f[0]&16777216&&(k.autoBookmark=s[24]),f[0]&1048576&&(k.firstDimensionMargin=s[20]),!n&&f[0]&1&&(n=!0,k.exploredCharCount=s[0],ue(()=>n=!1)),!r&&f[0]&2&&(r=!0,k.bookCharCount=s[1],ue(()=>r=!1)),!o&&f[0]&64&&(o=!0,k.isBookmarkScreen=s[6],ue(()=>o=!1)),!i&&f[0]&4&&(i=!0,k.bookmarkData=s[2],ue(()=>i=!1)),!a&&f[0]&16&&(a=!0,k.bookmarkManager=s[4],ue(()=>a=!1)),!l&&f[0]&32&&(l=!0,k.pageManager=s[5],ue(()=>l=!1)),e.$set(k)},i(s){u||(H(e.$$.fragment,s),u=!0)},o(s){X(e.$$.fragment,s),u=!1},d(s){ge(e,s)}}}function gi(t){let e,n,r,o,i,a,l,u;function c(s){t[40](s)}function m(s){t[41](s)}function d(s){t[42](s)}function g(s){t[43](s)}function h(s){t[44](s)}function b(s){t[45](s)}let w={htmlContent:t[7],width:t[28]??0,height:t[29]??0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],secondDimensionMaxValue:t[19],firstDimensionMargin:t[20],autoPositionOnResize:t[21],autoBookmark:t[24],multiplier:t[26],loadingState:t[30]??!0};return t[0]!==void 0&&(w.exploredCharCount=t[0]),t[1]!==void 0&&(w.bookCharCount=t[1]),t[2]!==void 0&&(w.bookmarkData=t[2]),t[3]!==void 0&&(w.autoScroller=t[3]),t[4]!==void 0&&(w.bookmarkManager=t[4]),t[5]!==void 0&&(w.pageManager=t[5]),e=new Jr({props:w}),oe.push(()=>se(e,"exploredCharCount",c,t[0])),oe.push(()=>se(e,"bookCharCount",m,t[1])),oe.push(()=>se(e,"bookmarkData",d,t[2])),oe.push(()=>se(e,"autoScroller",g,t[3])),oe.push(()=>se(e,"bookmarkManager",h,t[4])),oe.push(()=>se(e,"pageManager",b,t[5])),e.$on("contentChange",t[46]),e.$on("bookmark",t[47]),{c(){he(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,f){me(e,s,f),u=!0},p(s,f){const k={};f[0]&128&&(k.htmlContent=s[7]),f[0]&268435456&&(k.width=s[28]??0),f[0]&536870912&&(k.height=s[29]??0),f[0]&256&&(k.verticalMode=s[8]),f[0]&512&&(k.fontColor=s[9]),f[0]&1024&&(k.backgroundColor=s[10]),f[0]&2048&&(k.hintFuriganaFontColor=s[11]),f[0]&4096&&(k.hintFuriganaShadowColor=s[12]),f[0]&8192&&(k.fontSize=s[13]),f[0]&16384&&(k.fontFamilyGroupOne=s[14]),f[0]&32768&&(k.fontFamilyGroupTwo=s[15]),f[0]&65536&&(k.hideSpoilerImage=s[16]),f[0]&131072&&(k.hideFurigana=s[17]),f[0]&262144&&(k.furiganaStyle=s[18]),f[0]&524288&&(k.secondDimensionMaxValue=s[19]),f[0]&1048576&&(k.firstDimensionMargin=s[20]),f[0]&2097152&&(k.autoPositionOnResize=s[21]),f[0]&16777216&&(k.autoBookmark=s[24]),f[0]&67108864&&(k.multiplier=s[26]),f[0]&1073741824&&(k.loadingState=s[30]??!0),!n&&f[0]&1&&(n=!0,k.exploredCharCount=s[0],ue(()=>n=!1)),!r&&f[0]&2&&(r=!0,k.bookCharCount=s[1],ue(()=>r=!1)),!o&&f[0]&4&&(o=!0,k.bookmarkData=s[2],ue(()=>o=!1)),!i&&f[0]&8&&(i=!0,k.autoScroller=s[3],ue(()=>i=!1)),!a&&f[0]&16&&(a=!0,k.bookmarkManager=s[4],ue(()=>a=!1)),!l&&f[0]&32&&(l=!0,k.pageManager=s[5],ue(()=>l=!1)),e.$set(k)},i(s){u||(H(e.$$.fragment,s),u=!0)},o(s){X(e.$$.fragment,s),u=!1},d(s){ge(e,s)}}}function ki(t){let e,n,r,o,i=(t[31]??"")+"",a,l;const u=[gi,mi],c=[];function m(d,g){return d[25]===Et.Continuous?0:1}return n=m(t),r=c[n]=u[n](t),{c(){e=U("div"),r.c(),o=$(),a=ae(i),this.h()},l(d){e=J(d,"DIV",{class:!0});var g=Q(e);r.l(g),g.forEach(E),o=ee(d),a=le(d,i),this.h()},h(){W(e,"class",Qr+" py-8")},m(d,g){G(d,e,g),c[n].m(e,null),t[56](e),G(d,o,g),G(d,a,g),l=!0},p(d,g){let h=n;n=m(d),n===h?c[n].p(d,g):(Ge(),X(c[h],1,1,()=>{c[h]=null}),Ne(),r=c[n],r?r.p(d,g):(r=c[n]=u[n](d),r.c()),H(r,1),r.m(e,null)),(!l||g[1]&1)&&i!==(i=(d[31]??"")+"")&&Fe(a,i)},i(d){l||(H(r),l=!0)},o(d){X(r),l=!1},d(d){d&&E(e),c[n].d(),t[56](null),d&&E(o),d&&E(a)}}}function Mt(t){return Number(t.replace(/px$/,""))}function pi(t,e,n){let r,o,i,a,l,u,{htmlContent:c}=e,{width:m}=e,{height:d}=e,{verticalMode:g}=e,{fontColor:h}=e,{backgroundColor:b}=e,{hintFuriganaFontColor:w}=e,{hintFuriganaShadowColor:s}=e,{fontSize:f}=e,{fontFamilyGroupOne:k}=e,{fontFamilyGroupTwo:B}=e,{hideSpoilerImage:T}=e,{hideFurigana:q}=e,{furiganaStyle:O}=e,{secondDimensionMaxValue:V}=e,{firstDimensionMargin:Z}=e,{autoPositionOnResize:M}=e,{avoidPageBreak:N}=e,{pageColumns:I}=e,{autoBookmark:R}=e,{viewMode:v}=e,{exploredCharCount:A}=e,{bookCharCount:z}=e,{multiplier:C}=e,{bookmarkData:P}=e,{autoScroller:x}=e,{bookmarkManager:D}=e,{pageManager:K}=e,{isBookmarkScreen:re}=e;const ie=new Me,fe=new Me,be=er(null);j(t,be,p=>n(27,o=p));const Se=bt([be.pipe(Nt(p=>!!p)),bt([ie,fe]).pipe(Zt(0))]).pipe(Vt(0,qt),_e(([p])=>getComputedStyle(p)),xt({refCount:!0,bufferSize:1})),ke=new yo(1),Ee=Se.pipe(_e(p=>ze(m-Mt(p.paddingLeft)-Mt(p.paddingRight))));j(t,Ee,p=>n(28,i=p));const pe=Se.pipe(_e(p=>Ae(d-Mt(p.paddingTop)-Mt(p.paddingBottom)-r)));j(t,pe,p=>n(29,a=p));const ve=mt(()=>an(document)).pipe(Ft(p=>{const jt=$r(p,O);return ke.pipe(Ft(Kt=>jt(Kt)))}),ot());j(t,ve,p=>n(31,u=p));const Re=ke.pipe(Ft(p=>Zr(p)),$t());j(t,Re,p=>n(30,l=p));function ze(p){return Et.Paginated===v&&!g&&V?Math.min(V,p):p}function Ae(p){return Et.Paginated===v&&g&&V?Math.min(V,p):p}function Ce(p){A=p,n(0,A)}function ce(p){z=p,n(1,z)}function Ve(p){P=p,n(2,P)}function Oe(p){x=p,n(3,x)}function Ie(p){D=p,n(4,D)}function $e(p){K=p,n(5,K)}const Ue=p=>ke.next(p.detail);function qe(p){sn.call(this,t,p)}function et(p){A=p,n(0,A)}function S(p){z=p,n(1,z)}function te(p){re=p,n(6,re)}function y(p){P=p,n(2,P)}function ne(p){D=p,n(4,D)}function We(p){K=p,n(5,K)}const De=p=>ke.next(p.detail);function Le(p){sn.call(this,t,p)}function St(p){oe[p?"unshift":"push"](()=>{o=p,be.set(o)})}return t.$$set=p=>{"htmlContent"in p&&n(7,c=p.htmlContent),"width"in p&&n(38,m=p.width),"height"in p&&n(39,d=p.height),"verticalMode"in p&&n(8,g=p.verticalMode),"fontColor"in p&&n(9,h=p.fontColor),"backgroundColor"in p&&n(10,b=p.backgroundColor),"hintFuriganaFontColor"in p&&n(11,w=p.hintFuriganaFontColor),"hintFuriganaShadowColor"in p&&n(12,s=p.hintFuriganaShadowColor),"fontSize"in p&&n(13,f=p.fontSize),"fontFamilyGroupOne"in p&&n(14,k=p.fontFamilyGroupOne),"fontFamilyGroupTwo"in p&&n(15,B=p.fontFamilyGroupTwo),"hideSpoilerImage"in p&&n(16,T=p.hideSpoilerImage),"hideFurigana"in p&&n(17,q=p.hideFurigana),"furiganaStyle"in p&&n(18,O=p.furiganaStyle),"secondDimensionMaxValue"in p&&n(19,V=p.secondDimensionMaxValue),"firstDimensionMargin"in p&&n(20,Z=p.firstDimensionMargin),"autoPositionOnResize"in p&&n(21,M=p.autoPositionOnResize),"avoidPageBreak"in p&&n(22,N=p.avoidPageBreak),"pageColumns"in p&&n(23,I=p.pageColumns),"autoBookmark"in p&&n(24,R=p.autoBookmark),"viewMode"in p&&n(25,v=p.viewMode),"exploredCharCount"in p&&n(0,A=p.exploredCharCount),"bookCharCount"in p&&n(1,z=p.bookCharCount),"multiplier"in p&&n(26,C=p.multiplier),"bookmarkData"in p&&n(2,P=p.bookmarkData),"autoScroller"in p&&n(3,x=p.autoScroller),"bookmarkManager"in p&&n(4,D=p.bookmarkManager),"pageManager"in p&&n(5,K=p.pageManager),"isBookmarkScreen"in p&&n(6,re=p.isBookmarkScreen)},t.$$.update=()=>{t.$$.dirty[0]&34603264&&(r=Z&&Et.Paginated===v&&!g?Z*2:0),t.$$.dirty[1]&128&&ie.next(m),t.$$.dirty[1]&256&&fe.next(d)},[A,z,P,x,D,K,re,c,g,h,b,w,s,f,k,B,T,q,O,V,Z,M,N,I,R,v,C,o,i,a,l,u,be,ke,Ee,pe,ve,Re,m,d,Ce,ce,Ve,Oe,Ie,$e,Ue,qe,et,S,te,y,ne,We,De,Le,St]}class bi extends Qe{constructor(e){super(),Ze(this,e,pi,ki,xe,{htmlContent:7,width:38,height:39,verticalMode:8,fontColor:9,backgroundColor:10,hintFuriganaFontColor:11,hintFuriganaShadowColor:12,fontSize:13,fontFamilyGroupOne:14,fontFamilyGroupTwo:15,hideSpoilerImage:16,hideFurigana:17,furiganaStyle:18,secondDimensionMaxValue:19,firstDimensionMargin:20,autoPositionOnResize:21,avoidPageBreak:22,pageColumns:23,autoBookmark:24,viewMode:25,exploredCharCount:0,bookCharCount:1,multiplier:26,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6},null,[-1,-1,-1])}}function Ci(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function _i(t,e,n){let{styleSheet:r}=e,o;return zn(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),nn(()=>{o&&document.head.removeChild(o)}),t.$$set=i=>{"styleSheet"in i&&n(0,r=i.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&Ci(o,r)},[r,o]}class vi extends Qe{constructor(e){super(),Ze(this,e,_i,null,xe,{styleSheet:0})}}function wn(t){let e,n,r,o,i;return n=new He({props:{icon:ir}}),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(a){e=J(a,"DIV",{class:!0,role:!0});var l=Q(e);de(n.$$.fragment,l),l.forEach(E),this.h()},h(){W(e,"class",rn),W(e,"role","button")},m(a,l){G(a,e,l),me(n,e,null),r=!0,o||(i=Pe(e,"click",t[5]),o=!0)},p:st,i(a){r||(H(n.$$.fragment,a),r=!0)},o(a){X(n.$$.fragment,a),r=!1},d(a){a&&E(e),ge(n),o=!1,i()}}}function Sn(t){let e,n,r,o,i;return n=new He({props:{icon:ar}}),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(a){e=J(a,"DIV",{role:!0,class:!0});var l=Q(e);de(n.$$.fragment,l),l.forEach(E),this.h()},h(){W(e,"role","button"),W(e,"class",rn)},m(a,l){G(a,e,l),me(n,e,null),r=!0,o||(i=Pe(e,"click",t[7]),o=!0)},p:st,i(a){r||(H(n.$$.fragment,a),r=!0)},o(a){X(n.$$.fragment,a),r=!1},d(a){a&&E(e),ge(n),o=!1,i()}}}function wi(t){let e,n,r,o,i,a,l,u,c,m,d,g,h,b,w,s,f=t[0]&&wn(t);i=new He({props:{icon:t[3]?Ct:dn}});let k=t[2]&&Sn(t);return h=new rr({props:{items:[Tt.SETTINGS,Tt.MANAGE]}}),h.$on("action",t[8]),{c(){e=U("div"),n=U("div"),f&&f.c(),r=$(),o=U("div"),he(i.$$.fragment),a=$(),l=U("div"),u=ae(t[1]),c=ae("x"),m=$(),d=U("div"),k&&k.c(),g=$(),he(h.$$.fragment),this.h()},l(B){e=J(B,"DIV",{class:!0});var T=Q(e);n=J(T,"DIV",{class:!0});var q=Q(n);f&&f.l(q),r=ee(q),o=J(q,"DIV",{class:!0,role:!0});var O=Q(o);de(i.$$.fragment,O),O.forEach(E),a=ee(q),l=J(q,"DIV",{class:!0});var V=Q(l);u=le(V,t[1]),c=le(V,"x"),V.forEach(E),q.forEach(E),m=ee(T),d=J(T,"DIV",{class:!0});var Z=Q(d);k&&k.l(Z),g=ee(Z),de(h.$$.fragment,Z),Z.forEach(E),T.forEach(E),this.h()},h(){W(o,"class",rn),W(o,"role","button"),W(l,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg"),W(n,"class","flex transform-gpu "+Mo),W(d,"class","flex transform-gpu "+Po),W(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+Fo)},m(B,T){G(B,e,T),Y(e,n),f&&f.m(n,null),Y(n,r),Y(n,o),me(i,o,null),Y(n,a),Y(n,l),Y(l,u),Y(l,c),Y(e,m),Y(e,d),k&&k.m(d,null),Y(d,g),me(h,d,null),b=!0,w||(s=Pe(o,"click",t[6]),w=!0)},p(B,[T]){B[0]?f?(f.p(B,T),T&1&&H(f,1)):(f=wn(B),f.c(),H(f,1),f.m(n,r)):f&&(Ge(),X(f,1,1,()=>{f=null}),Ne());const q={};T&8&&(q.icon=B[3]?Ct:dn),i.$set(q),(!b||T&2)&&Fe(u,B[1]),B[2]?k?(k.p(B,T),T&4&&H(k,1)):(k=Sn(B),k.c(),H(k,1),k.m(d,g)):k&&(Ge(),X(k,1,1,()=>{k=null}),Ne())},i(B){b||(H(f),H(i.$$.fragment,B),H(k),H(h.$$.fragment,B),b=!0)},o(B){X(f),X(i.$$.fragment,B),X(k),X(h.$$.fragment,B),b=!1},d(B){B&&E(e),f&&f.d(),ge(i),k&&k.d(),ge(h),w=!1,s()}}}function Si(t,e,n){let{hasChapterData:r}=e,{autoScrollMultiplier:o}=e,{showFullscreenButton:i}=e,{isBookmarkScreen:a}=e;const l=Lt(),u=()=>l("tocClick"),c=()=>l("bookmarkClick"),m=()=>l("fullscreenClick"),d=({detail:g})=>{g===Tt.SETTINGS.label?l("settingsClick"):g===Tt.MANAGE.label&&l("bookManagerClick")};return t.$$set=g=>{"hasChapterData"in g&&n(0,r=g.hasChapterData),"autoScrollMultiplier"in g&&n(1,o=g.autoScrollMultiplier),"showFullscreenButton"in g&&n(2,i=g.showFullscreenButton),"isBookmarkScreen"in g&&n(3,a=g.isBookmarkScreen)},[r,o,i,a,l,u,c,m,d]}class yi extends Qe{constructor(e){super(),Ze(this,e,Si,wi,xe,{hasChapterData:0,autoScrollMultiplier:1,showFullscreenButton:2,isBookmarkScreen:3})}}function yn(t,e,n){const r=t.slice();return r[16]=e[n],r}function Mn(t,e){let n,r,o=e[16].label+"",i,a,l,u,c=e[16].startCharacter+"",m,d,g,h;function b(){return e[13](e[16])}return{key:t,first:null,c(){n=U("div"),r=U("div"),i=ae(o),l=$(),u=U("div"),m=ae(c),d=$(),this.h()},l(w){n=J(w,"DIV",{class:!0});var s=Q(n);r=J(s,"DIV",{id:!0,class:!0});var f=Q(r);i=le(f,o),f.forEach(E),l=ee(s),u=J(s,"DIV",{});var k=Q(u);m=le(k,c),k.forEach(E),d=ee(s),s.forEach(E),this.h()},h(){W(r,"id",a=`for${e[16].reference}`),W(r,"class","mr-4 cursor-pointer"),L(r,"opacity-30",e[16].progress===100&&e[16]!==e[2]),L(r,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),L(r,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),L(u,"opacity-30",e[16].progress===100&&e[16]!==e[2]),W(n,"class","my-6 flex justify-between"),this.first=n},m(w,s){G(w,n,s),Y(n,r),Y(r,i),Y(n,l),Y(n,u),Y(u,m),Y(n,d),g||(h=Pe(r,"click",b),g=!0)},p(w,s){e=w,s&2&&o!==(o=e[16].label+"")&&Fe(i,o),s&2&&a!==(a=`for${e[16].reference}`)&&W(r,"id",a),s&6&&L(r,"opacity-30",e[16].progress===100&&e[16]!==e[2]),s&6&&L(r,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),s&6&&L(r,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),s&2&&c!==(c=e[16].startCharacter+"")&&Fe(m,c),s&6&&L(u,"opacity-30",e[16].progress===100&&e[16]!==e[2])},d(w){w&&E(n),g=!1,h()}}}function Mi(t){let e,n,r,o,i,a,l,u,c,m,d,g,h=[],b=new Map,w,s,f,k,B,T,q,O,V,Z;m=new He({props:{icon:lr}});let M=t[1];const N=I=>I[16].reference;for(let I=0;I<M.length;I+=1){let R=yn(t,M,I),v=N(R);b.set(v,h[I]=Mn(v,R))}return k=new He({props:{icon:sr}}),q=new He({props:{icon:ur}}),{c(){e=U("div"),n=U("div"),r=ae("Chapter Progress: "),o=ae(t[3]),i=ae(" ("),a=ae(t[4]),l=ae("%)"),u=$(),c=U("div"),he(m.$$.fragment),d=$(),g=U("div");for(let I=0;I<h.length;I+=1)h[I].c();w=$(),s=U("div"),f=U("div"),he(k.$$.fragment),B=$(),T=U("div"),he(q.$$.fragment),this.h()},l(I){e=J(I,"DIV",{class:!0});var R=Q(e);n=J(R,"DIV",{});var v=Q(n);r=le(v,"Chapter Progress: "),o=le(v,t[3]),i=le(v," ("),a=le(v,t[4]),l=le(v,"%)"),v.forEach(E),u=ee(R),c=J(R,"DIV",{class:!0});var A=Q(c);de(m.$$.fragment,A),A.forEach(E),R.forEach(E),d=ee(I),g=J(I,"DIV",{class:!0});var z=Q(g);for(let D=0;D<h.length;D+=1)h[D].l(z);z.forEach(E),w=ee(I),s=J(I,"DIV",{class:!0});var C=Q(s);f=J(C,"DIV",{class:!0});var P=Q(f);de(k.$$.fragment,P),P.forEach(E),B=ee(C),T=J(C,"DIV",{class:!0});var x=Q(T);de(q.$$.fragment,x),x.forEach(E),C.forEach(E),this.h()},h(){W(c,"class","flex cursor-pointer items-end md:items-center"),W(e,"class","flex justify-between p-4"),W(g,"class","flex-1 overflow-auto p-4"),W(f,"class","cursor-pointer"),L(f,"opacity-30",!t[6]),W(T,"class","cursor-pointer"),L(T,"opacity-30",!t[5]),W(s,"class","flex justify-between px-4 py-6")},m(I,R){G(I,e,R),Y(e,n),Y(n,r),Y(n,o),Y(n,i),Y(n,a),Y(n,l),Y(e,u),Y(e,c),me(m,c,null),G(I,d,R),G(I,g,R);for(let v=0;v<h.length;v+=1)h[v].m(g,null);G(I,w,R),G(I,s,R),Y(s,f),me(k,f,null),Y(s,B),Y(s,T),me(q,T,null),O=!0,V||(Z=[Pe(c,"click",t[9]),Pe(f,"click",t[14]),Pe(T,"click",t[15])],V=!0)},p(I,[R]){(!O||R&8)&&Fe(o,I[3]),(!O||R&16)&&Fe(a,I[4]),R&262&&(M=I[1],h=mo(h,R,N,1,I,M,b,g,go,Mn,null,yn)),(!O||R&64)&&L(f,"opacity-30",!I[6]),(!O||R&32)&&L(T,"opacity-30",!I[5])},i(I){O||(H(m.$$.fragment,I),H(k.$$.fragment,I),H(q.$$.fragment,I),O=!0)},o(I){X(m.$$.fragment,I),X(k.$$.fragment,I),X(q.$$.fragment,I),O=!1},d(I){I&&E(e),ge(m),I&&E(d),I&&E(g);for(let R=0;R<h.length;R+=1)h[R].d();I&&E(w),I&&E(s),ge(k),ge(q),V=!1,Gt(Z)}}}function Pi(t,e){const[n,r]=e.reduce((o,i,a)=>(o[0]+=t[a]*i,o[1]+=i,o),[0,0]);return n/r}function Pn(t){!t||(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView())}function Fi(t,e,n){let r,o,{sectionData:i=[]}=e,{exploredCharCount:a=0}=e,{verticalMode:l}=e,u=[],c,m=-1,d="0/0",g="0.00";zn(()=>{cn.dialogs$.next([{component:"<div/>"}]),c&&Pn(document.getElementById(`for${c.reference}`))});function h(B,T){if(B){const q=u[m+T];b(q.reference,!1)}}function b(B,T=!1){wt.next(B),T&&w()}function w(){at.next(!1),cn.dialogs$.next([])}const s=B=>b(B.reference,!0),f=()=>h(r,l?1:-1),k=()=>h(o,l?-1:1);return t.$$set=B=>{"sectionData"in B&&n(10,i=B.sectionData),"exploredCharCount"in B&&n(11,a=B.exploredCharCount),"verticalMode"in B&&n(0,l=B.verticalMode)},t.$$.update=()=>{if(t.$$.dirty&5120&&i){const[B,T,q]=Zn(i),O=i.filter(V=>V.reference===q||V.parentChapter===q);n(4,g=Pi(O.map(V=>V.progress),O.map(V=>V.charactersWeight)).toFixed(2)),n(1,u=B),n(12,m=T),n(2,c=B[m])}if(t.$$.dirty&4099&&n(6,r=l?m<u.length-1:!!m),t.$$.dirty&4099&&n(5,o=l?!!m:m<u.length-1),t.$$.dirty&2052&&c){Pn(document.getElementById(`for${c.reference}`));const B=c.characters;n(3,d=`${Math.min(Math.max(a-c.startCharacter,0),B)} / ${B}`)}},[l,u,c,d,g,o,r,h,b,w,i,a,m,s,f,k]}class Ei extends Qe{constructor(e){super(),Ze(this,e,Fi,Mi,xe,{sectionData:10,exploredCharCount:11,verticalMode:0})}}class Di{constructor(e){we(this,"fallbackSpec");this.fallbackSpec=Fn(e)}get fullscreenEnabled(){return this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled")??!1}get fullscreenElement(){return this.fallbackSpec("fullscreenElement","webkitFullscreenElement")??null}async requestFullscreen(e,n){const r=Fn(e)("requestFullscreen","webkitRequestFullscreen");!r||await r(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Fn(t){return(e,n)=>En(t,e)??En(t,n)}function En(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const Dt=new Di(document);function Bi(t,e){return Ii(t).pipe(_e(n=>{const r=e.createElement("div");return r.innerHTML=n,Ti(r),Ai(r),Vi(r,e),Oi(r),r.innerHTML}))}function Ii(t){return new Ye(e=>{const{blobs:n}=t;let{elementHtml:r}=t;const o=[];return Object.entries(n).forEach(([i,a])=>{const l=URL.createObjectURL(a);o.push(l),r=r.replaceAll(nr(i),l).replaceAll(`ttu:${i}`,l)}),e.next(r),()=>{o.forEach(i=>URL.revokeObjectURL(i))}})}function Ti(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:jn(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function Ai(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Vi(t,e){const n=()=>{let o=[...t.children];const i=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return i>0&&i<o.length&&(o=o.slice(i)),o},r=(o,i)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||i).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(i=>!jn(i)).forEach(i=>r(i,o)),Array.from(o.getElementsByTagName("svg")).filter(i=>i.getElementsByTagName("image").length).forEach(i=>r(i,o))})}function Oi(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Ri=to;function to(t,e,n){t instanceof RegExp&&(t=Dn(t,n)),e instanceof RegExp&&(e=Dn(e,n));const r=no(t,e,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+e.length)}}function Dn(t,e){const n=e.match(t);return n?n[0]:null}to.range=no;function no(t,e,n){let r,o,i,a,l,u=n.indexOf(t),c=n.indexOf(e,u+1),m=u;if(u>=0&&c>0){if(t===e)return[u,c];for(r=[],i=n.length;m>=0&&!l;)m===u?(r.push(m),u=n.indexOf(t,m+1)):r.length===1?l=[r.pop(),c]:(o=r.pop(),o<i&&(i=o,a=c),c=n.indexOf(e,m+1)),m=u<c&&u>=0?u:c;r.length&&(l=[i,a])}return l}function zi(t,e={}){const r=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function i(v){throw new Error(`CSS parse error: ${v}`)}function a(v){const A=v.exec(t);if(A)return t=t.slice(A[0].length),A}function l(){return a(/^{\s*/)}function u(){return a(/^}/)}function c(){a(/^\s*/)}function m(){if(c(),t[0]!=="/"||t[1]!=="*")return;let v=2;for(;t[v]&&(t[v]!=="*"||t[v+1]!=="/");)v++;if(!t[v])return i("end of comment is missing");const A=t.slice(2,v);return t=t.slice(v+2),{type:"comment",comment:A}}function d(){const v=[];let A;for(;A=m();)v.push(A);return r.removeComments?[]:v}function g(){for(c();t[0]==="}";)i("extra closing bracket");const v=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(v)return v[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(A){return A.replace(/,/g,"‌")}).split(/\s*(?![^(]*\)),\s*/).map(function(A){return A.replace(/\u200C/g,",")})}function h(){if(t[0]==="@")return N();a(/^([;\s]*)+/);const v=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let A=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!A)return;if(A=A[0].trim(),!a(/^:\s*/))return i("property missing ':'");const z=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),C={type:"declaration",property:A.replace(v,""),value:z?z[0].replace(v,"").trim():""};return a(/^[;\s]*/),C}function b(){if(!l())return i("missing '{'");let v,A=d();for(;v=h();)A.push(v),A=A.concat(d());return u()?A:i("missing '}'")}function w(){c();const v=[];let A;for(;A=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)v.push(A[1]),a(/^,\s*/);if(v.length)return{type:"keyframe",values:v,declarations:b()}}function s(){let v=a(/^@([-\w]+)?keyframes\s*/);if(!v)return;const A=v[1];if(v=a(/^([-\w]+)\s*/),!v)return i("@keyframes missing name");const z=v[1];if(!l())return i("@keyframes missing '{'");let C,P=d();for(;C=w();)P.push(C),P=P.concat(d());return u()?{type:"keyframes",name:z,vendor:A,keyframes:P}:i("@keyframes missing '}'")}function f(){if(a(/^@page */))return{type:"page",selectors:g()||[],declarations:b()}}function k(){const v=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(v)return{type:"page-margin-box",name:`${v[1]}-${v[2]}`+(v[3]?`-${v[3]}`:""),declarations:b()}}function B(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:b()}}function T(){const v=a(/^@supports *([^{]+)/);if(v)return{type:"supports",supports:v[1].trim(),rules:R()}}function q(){if(a(/^@host\s*/))return{type:"host",rules:R()}}function O(){const v=a(/^@media([^{]+)*/);if(v)return{type:"media",media:(v[1]||"").trim(),rules:R()}}function V(){const v=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(v)return{type:"custom-media",name:v[1].trim(),media:v[2].trim()}}function Z(){const v=a(/^@([-\w]+)?document *([^{]+)/);if(v)return{type:"document",document:v[2].trim(),vendor:v[1]?v[1].trim():null,rules:R()}}function M(){const v=a(/^@(import|charset|namespace)\s*([^;]+);/);if(v)return{type:v[1],name:v[2].trim()}}function N(){if(c(),t[0]==="@"){const v=M()||B()||O()||s()||T()||Z()||V()||q()||f()||k();if(v&&!r.preserveStatic){let A=!1;return v.declarations?A=v.declarations.some(z=>/var\(/.test(z.value)):A=(v.keyframes||v.rules||[]).some(C=>(C.declarations||[]).some(P=>/var\(/.test(P.value))),A?v:{}}return v}}function I(){if(!r.preserveStatic){const z=Ri("{","}",t);if(z){const C=/:(?:root|host)(?![.:#(])/.test(z.pre)&&/--\S*\s*:/.test(z.body),P=/var\(/.test(z.body);if(!C&&!P)return t=t.slice(z.end+1),{}}}const v=g()||[],A=r.preserveStatic?b():b().filter(z=>{const C=v.some(x=>/:(?:root|host)(?![.:#(])/.test(x))&&/^--\S/.test(z.property),P=/var\(/.test(z.value);return C||P});return v.length||i("selector missing"),{type:"rule",selectors:v,declarations:A}}function R(v){if(!v&&!l())return i("missing '{'");let A,z=d();for(;t.length&&(v||t[0]!=="}")&&(A=N()||I());)A.type&&z.push(A),z=z.concat(d());return!v&&!u()?i("missing '}'"):z}return{type:"stylesheet",stylesheet:{rules:R(!0),errors:o}}}function Li(t,e="",n){const r={charset(i){return"@charset "+i.name+";"},comment(i){return i.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+i.comment+"*/":""},"custom-media"(i){return"@custom-media "+i.name+" "+i.media+";"},declaration(i){return i.property+":"+i.value+";"},document(i){return"@"+(i.vendor||"")+"document "+i.document+"{"+o(i.rules)+"}"},"font-face"(i){return"@font-face{"+o(i.declarations)+"}"},host(i){return"@host{"+o(i.rules)+"}"},import(i){return"@import "+i.name+";"},keyframe(i){return i.values.join(",")+"{"+o(i.declarations)+"}"},keyframes(i){return"@"+(i.vendor||"")+"keyframes "+i.name+"{"+o(i.keyframes)+"}"},media(i){return"@media "+i.media+"{"+o(i.rules)+"}"},namespace(i){return"@namespace "+i.name+";"},page(i){return"@page "+(i.selectors.length?i.selectors.join(", "):"")+"{"+o(i.declarations)+"}"},"page-margin-box"(i){return"@"+i.name+"{"+o(i.declarations)+"}"},rule(i){const a=i.declarations;if(a.length)return i.selectors.join(",")+"{"+o(a)+"}"},supports(i){return"@supports "+i.supports+"{"+o(i.rules)+"}"}};function o(i){let a="";for(let l=0;l<i.length;l++){const u=i[l];n&&n(u);const c=r[u.type](u);c&&(a+=c,c.length&&u.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}const Gi=/\s?html\s?/gi,Ni=/\s?body\s?/gi;function Hi(t,e){const r=zi(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(i=>Gi.test(i)||Ni.test(i)));return r.forEach(o=>{const i={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new ji(o.declarations,i);o.declarations.forEach(l=>{Ut(i,Wi(l)),Ut(i,Xi(l)),Ut(i,a.convert(l))}),Object.entries(i).forEach(([l,u])=>{o.declarations.push({type:"declaration",property:l,value:u})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),r.push(Ki()),r.forEach(o=>{o.selectors=qi(o.selectors,e)}),Li({stylesheet:{rules:r},type:"stylesheet"})}function qi(t,e){return t.map(n=>`${e} ${n}`)}function Ut(t,e){return e&&(t[e.key]=e.value),t}function Wi(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function Xi(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class ji{constructor(e,n){we(this,"hasLineBreakDefined");this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function Ki(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}function Yi(t,e,n){return Bi(t,n).pipe(_e(r=>({htmlContent:r,styleSheet:Hi(t,e)})))}function Ui(t){return new Ye(e=>t.subscribe(n=>{e.next(n)}))}function Pt(t=Do){return e=>t?e:Eo}function Bn(t,e,n){return r=>new Ye(o=>{const i=t();return r.pipe(Hn(qt),Dr(()=>n(i))).subscribe({next:a=>{e(a,i),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}function Ji(t,e,n,r,o,i,a,l,u){switch(e[t.code]){case Xe.BOOKMARK:return n(),!0;case Xe.JUMP_TO_BOOKMARK:return r(),!0;case Xe.AUTO_SCROLL_TOGGLE:return i==null||i.toggle(),!0;case Xe.AUTO_SCROLL_INCREASE:return o(1),!0;case Xe.AUTO_SCROLL_DECREASE:return o(-1),!0;case Xe.NEXT_PAGE:return a==null||a.nextPage(),!0;case Xe.PREV_PAGE:return a==null||a.prevPage(),!0;case Xe.PREV_CHAPTER:return u(l?1:-1),!0;case Xe.NEXT_CHAPTER:return u(l?-1:1),!0;default:return!1}}const{document:Jt,window:Qi}=Rn;function In(t){var d;let e,n,r,o,i,a,l,u;function c(g){t[54](g)}let m={hasChapterData:!!((d=t[10])!=null&&d.length),showFullscreenButton:Dt.fullscreenEnabled,autoScrollMultiplier:t[14]};return t[5]!==void 0&&(m.isBookmarkScreen=t[5]),n=new yi({props:m}),oe.push(()=>se(n,"isBookmarkScreen",c,t[5])),n.$on("tocClick",t[55]),n.$on("fullscreenClick",t[52]),n.$on("bookmarkClick",t[50]),n.$on("bookManagerClick",t[51]),n.$on("settingsClick",t[50]),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(g){e=J(g,"DIV",{class:!0});var h=Q(e);de(n.$$.fragment,h),h.forEach(E),this.h()},h(){W(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(g,h){G(g,e,h),me(n,e,null),a=!0,l||(u=on(o=Kn.call(null,e,t[56])),l=!0)},p(g,h){var w;t=g;const b={};h[0]&1024&&(b.hasChapterData=!!((w=t[10])!=null&&w.length)),h[0]&16384&&(b.autoScrollMultiplier=t[14]),!r&&h[0]&32&&(r=!0,b.isBookmarkScreen=t[5],ue(()=>r=!1)),n.$set(b),o&&po(o.update)&&h[0]&16&&o.update.call(null,t[56])},i(g){a||(H(n.$$.fragment,g),g&&Ln(()=>{i||(i=un(e,tn,{y:-300,easing:en},!0)),i.run(1)}),a=!0)},o(g){X(n.$$.fragment,g),g&&(i||(i=un(e,tn,{y:-300,easing:en},!1)),i.run(0)),a=!1},d(g){g&&E(e),ge(n),g&&i&&i.end(),l=!1,u()}}}function Zi(t){let e=(t[36]??"")+"",n;return{c(){n=ae(e)},l(r){n=le(r,e)},m(r,o){G(r,n,o)},p(r,o){o[1]&32&&e!==(e=(r[36]??"")+"")&&Fe(n,e)},i:st,o:st,d(r){r&&E(n)}}}function xi(t){var v,A,z;let e,n,r,o,i,a,l,u,c,m,d,g=(t[33]??"")+"",h,b,w=(t[34]??"")+"",s,f,k=(t[35]??"")+"",B,T;e=new vi({props:{styleSheet:t[15].styleSheet}});function q(C){t[57](C)}function O(C){t[58](C)}function V(C){t[59](C)}function Z(C){t[60](C)}function M(C){t[61](C)}function N(C){t[62](C)}function I(C){t[63](C)}let R={htmlContent:t[15].htmlContent,width:t[16]??0,height:t[17]??0,verticalMode:t[11],fontColor:(v=t[18])==null?void 0:v.fontColor,backgroundColor:t[19],hintFuriganaFontColor:(A=t[18])==null?void 0:A.hintFuriganaFontColor,hintFuriganaShadowColor:(z=t[18])==null?void 0:z.hintFuriganaShadowColor,fontSize:t[20],fontFamilyGroupOne:t[21],fontFamilyGroupTwo:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],viewMode:t[26],secondDimensionMaxValue:t[27],firstDimensionMargin:t[28],autoPositionOnResize:t[29],avoidPageBreak:t[30],pageColumns:t[31],autoBookmark:t[32],multiplier:t[14]};return t[0]!==void 0&&(R.exploredCharCount=t[0]),t[1]!==void 0&&(R.bookCharCount=t[1]),t[5]!==void 0&&(R.isBookmarkScreen=t[5]),t[9]!==void 0&&(R.bookmarkData=t[9]),t[2]!==void 0&&(R.autoScroller=t[2]),t[7]!==void 0&&(R.bookmarkManager=t[7]),t[8]!==void 0&&(R.pageManager=t[8]),r=new bi({props:R}),oe.push(()=>se(r,"exploredCharCount",q,t[0])),oe.push(()=>se(r,"bookCharCount",O,t[1])),oe.push(()=>se(r,"isBookmarkScreen",V,t[5])),oe.push(()=>se(r,"bookmarkData",Z,t[9])),oe.push(()=>se(r,"autoScroller",M,t[2])),oe.push(()=>se(r,"bookmarkManager",N,t[7])),oe.push(()=>se(r,"pageManager",I,t[8])),r.$on("bookmark",t[50]),{c(){he(e.$$.fragment),n=$(),he(r.$$.fragment),d=$(),h=ae(g),b=$(),s=ae(w),f=$(),B=ae(k)},l(C){de(e.$$.fragment,C),n=ee(C),de(r.$$.fragment,C),d=ee(C),h=le(C,g),b=ee(C),s=le(C,w),f=ee(C),B=le(C,k)},m(C,P){me(e,C,P),G(C,n,P),me(r,C,P),G(C,d,P),G(C,h,P),G(C,b,P),G(C,s,P),G(C,f,P),G(C,B,P),T=!0},p(C,P){var K,re,ie;const x={};P[0]&32768&&(x.styleSheet=C[15].styleSheet),e.$set(x);const D={};P[0]&32768&&(D.htmlContent=C[15].htmlContent),P[0]&65536&&(D.width=C[16]??0),P[0]&131072&&(D.height=C[17]??0),P[0]&2048&&(D.verticalMode=C[11]),P[0]&262144&&(D.fontColor=(K=C[18])==null?void 0:K.fontColor),P[0]&524288&&(D.backgroundColor=C[19]),P[0]&262144&&(D.hintFuriganaFontColor=(re=C[18])==null?void 0:re.hintFuriganaFontColor),P[0]&262144&&(D.hintFuriganaShadowColor=(ie=C[18])==null?void 0:ie.hintFuriganaShadowColor),P[0]&1048576&&(D.fontSize=C[20]),P[0]&2097152&&(D.fontFamilyGroupOne=C[21]),P[0]&4194304&&(D.fontFamilyGroupTwo=C[22]),P[0]&8388608&&(D.hideSpoilerImage=C[23]),P[0]&16777216&&(D.hideFurigana=C[24]),P[0]&33554432&&(D.furiganaStyle=C[25]),P[0]&67108864&&(D.viewMode=C[26]),P[0]&134217728&&(D.secondDimensionMaxValue=C[27]),P[0]&268435456&&(D.firstDimensionMargin=C[28]),P[0]&536870912&&(D.autoPositionOnResize=C[29]),P[0]&1073741824&&(D.avoidPageBreak=C[30]),P[1]&1&&(D.pageColumns=C[31]),P[1]&2&&(D.autoBookmark=C[32]),P[0]&16384&&(D.multiplier=C[14]),!o&&P[0]&1&&(o=!0,D.exploredCharCount=C[0],ue(()=>o=!1)),!i&&P[0]&2&&(i=!0,D.bookCharCount=C[1],ue(()=>i=!1)),!a&&P[0]&32&&(a=!0,D.isBookmarkScreen=C[5],ue(()=>a=!1)),!l&&P[0]&512&&(l=!0,D.bookmarkData=C[9],ue(()=>l=!1)),!u&&P[0]&4&&(u=!0,D.autoScroller=C[2],ue(()=>u=!1)),!c&&P[0]&128&&(c=!0,D.bookmarkManager=C[7],ue(()=>c=!1)),!m&&P[0]&256&&(m=!0,D.pageManager=C[8],ue(()=>m=!1)),r.$set(D),(!T||P[1]&4)&&g!==(g=(C[33]??"")+"")&&Fe(h,g),(!T||P[1]&8)&&w!==(w=(C[34]??"")+"")&&Fe(s,w),(!T||P[1]&16)&&k!==(k=(C[35]??"")+"")&&Fe(B,k)},i(C){T||(H(e.$$.fragment,C),H(r.$$.fragment,C),T=!0)},o(C){X(e.$$.fragment,C),X(r.$$.fragment,C),T=!1},d(C){ge(e,C),C&&E(n),ge(r,C),C&&E(d),C&&E(h),C&&E(b),C&&E(s),C&&E(f),C&&E(B)}}}function Tn(t){let e,n,r,o,i,a;return n=new Ei({props:{sectionData:t[10],verticalMode:t[11],exploredCharCount:t[0]}}),{c(){e=U("div"),he(n.$$.fragment),this.h()},l(l){e=J(l,"DIV",{class:!0});var u=Q(e);de(n.$$.fragment,u),u.forEach(E),this.h()},h(){var l;W(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),F(e,"color",(l=t[18])==null?void 0:l.fontColor),F(e,"background-color",t[19])},m(l,u){G(l,e,u),me(n,e,null),o=!0,i||(a=on(Kn.call(null,e,t[64])),i=!0)},p(l,u){var m;t=l;const c={};u[0]&1024&&(c.sectionData=t[10]),u[0]&2048&&(c.verticalMode=t[11]),u[0]&1&&(c.exploredCharCount=t[0]),n.$set(c),u[0]&262144&&F(e,"color",(m=t[18])==null?void 0:m.fontColor),u[0]&524288&&F(e,"background-color",t[19])},i(l){o||(H(n.$$.fragment,l),l&&(r||Ln(()=>{r=bo(e,tn,{x:-100,duration:100,easing:en}),r.start()})),o=!0)},o(l){X(n.$$.fragment,l),o=!1},d(l){l&&E(e),ge(n),i=!1,a()}}}function An(t){let e,n,r,o,i,a=(t[0]/t[1]*100).toFixed(2)+"",l,u;return{c(){e=U("div"),n=ae(t[0]),r=ae(" / "),o=ae(t[1]),i=ae(" ("),l=ae(a),u=ae("%)"),this.h()},l(c){e=J(c,"DIV",{class:!0});var m=Q(e);n=le(m,t[0]),r=le(m," / "),o=le(m,t[1]),i=le(m," ("),l=le(m,a),u=le(m,"%)"),m.forEach(E),this.h()},h(){var c;W(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),F(e,"color",(c=t[18])==null?void 0:c.tooltipTextFontColor)},m(c,m){G(c,e,m),Y(e,n),Y(e,r),Y(e,o),Y(e,i),Y(e,l),Y(e,u)},p(c,m){var d;m[0]&1&&Fe(n,c[0]),m[0]&2&&Fe(o,c[1]),m[0]&3&&a!==(a=(c[0]/c[1]*100).toFixed(2)+"")&&Fe(l,a),m[0]&262144&&F(e,"color",(d=c[18])==null?void 0:d.tooltipTextFontColor)},d(c){c&&E(e)}}}function $i(t){var Z;let e,n,r=(t[13]??"")+"",o,i,a,l,u,c,m,d,g,h,b,w,s,f;Jt.title=e=fn(((Z=t[12])==null?void 0:Z.title)??"");let k=t[4]&&In(t);const B=[xi,Zi],T=[];function q(M,N){return M[15]?0:1}c=q(t),m=T[c]=B[c](t);let O=t[3]&&Tn(t),V=t[6]&&t[1]&&An(t);return{c(){n=$(),o=ae(r),i=$(),a=U("button"),l=$(),k&&k.c(),u=$(),m.c(),d=$(),O&&O.c(),g=$(),V&&V.c(),h=$(),b=U("button"),this.h()},l(M){ko("svelte-rnuhm6",Jt.head).forEach(E),n=ee(M),o=le(M,r),i=ee(M),a=J(M,"BUTTON",{class:!0}),Q(a).forEach(E),l=ee(M),k&&k.l(M),u=ee(M),m.l(M),d=ee(M),O&&O.l(M),g=ee(M),V&&V.l(M),h=ee(M),b=J(M,"BUTTON",{class:!0}),Q(b).forEach(E),this.h()},h(){W(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),W(b,"class","fixed inset-x-0 bottom-0 z-10 h-8 w-full cursor-pointer")},m(M,N){G(M,n,N),G(M,o,N),G(M,i,N),G(M,a,N),G(M,l,N),k&&k.m(M,N),G(M,u,N),T[c].m(M,N),G(M,d,N),O&&O.m(M,N),G(M,g,N),V&&V.m(M,N),G(M,h,N),G(M,b,N),w=!0,s||(f=[Pe(Qi,"keydown",t[49]),Pe(a,"click",t[53]),Pe(b,"click",t[65])],s=!0)},p(M,N){var R;(!w||N[0]&4096)&&e!==(e=fn(((R=M[12])==null?void 0:R.title)??""))&&(Jt.title=e),(!w||N[0]&8192)&&r!==(r=(M[13]??"")+"")&&Fe(o,r),M[4]?k?(k.p(M,N),N[0]&16&&H(k,1)):(k=In(M),k.c(),H(k,1),k.m(u.parentNode,u)):k&&(Ge(),X(k,1,1,()=>{k=null}),Ne());let I=c;c=q(M),c===I?T[c].p(M,N):(Ge(),X(T[I],1,1,()=>{T[I]=null}),Ne(),m=T[c],m?m.p(M,N):(m=T[c]=B[c](M),m.c()),H(m,1),m.m(d.parentNode,d)),M[3]?O?(O.p(M,N),N[0]&8&&H(O,1)):(O=Tn(M),O.c(),H(O,1),O.m(g.parentNode,g)):O&&(Ge(),X(O,1,1,()=>{O=null}),Ne()),M[6]&&M[1]?V?V.p(M,N):(V=An(M),V.c(),V.m(h.parentNode,h)):V&&(V.d(1),V=null)},i(M){w||(H(k),H(m),H(O),w=!0)},o(M){X(k),X(m),X(O),w=!1},d(M){M&&E(n),M&&E(o),M&&E(i),M&&E(a),M&&E(l),k&&k.d(M),M&&E(u),T[c].d(M),M&&E(d),O&&O.d(M),M&&E(g),V&&V.d(M),M&&E(h),M&&E(b),s=!1,Gt(f)}}}const Vn="background-color",On="writing-mode";function ea(t,e,n){let r,o,i,a,l,u,c,m,d,g,h,b,w,s,f,k,B,T,q,O,V,Z,M,N,I,R,v,A;j(t,Ro,_=>n(11,o=_)),j(t,at,_=>n(3,i=_)),j(t,Yt,_=>n(14,u=_)),j(t,zo,_=>n(20,b=_)),j(t,Lo,_=>n(21,w=_)),j(t,Go,_=>n(22,s=_)),j(t,No,_=>n(23,f=_)),j(t,Ho,_=>n(24,k=_)),j(t,qo,_=>n(25,B=_)),j(t,Wo,_=>n(26,T=_)),j(t,Xo,_=>n(27,q=_)),j(t,jo,_=>n(28,O=_)),j(t,Ko,_=>n(29,V=_)),j(t,Yo,_=>n(30,Z=_)),j(t,Uo,_=>n(31,M=_)),j(t,Jo,_=>n(32,N=_));let z=!0,C=!1,P=!0,x=0,D=0,K,re,ie,fe=Promise.resolve(void 0);const be=Wt(2500).pipe(Je(()=>n(4,z=!1)),ot());j(t,be,_=>n(13,l=_));const Se=mt(()=>Ui(Qo)).pipe(_e(_=>Number(_.url.searchParams.get("id"))),xt({refCount:!0,bufferSize:1})),ke=Se.pipe(kt(_=>ht.getData(_)),$t());j(t,ke,_=>n(12,a=_));const Ee=ke.pipe(Je(_=>{_||Vo("/manage")}),ot());j(t,Ee,_=>n(36,A=_));const pe=ke.pipe(Je(_=>{!_||n(9,fe=ht.getBookmark(_.id))}),ot());j(t,pe,_=>n(33,I=_));const ve=ke.pipe(kt(_=>_?(_.lastBookOpen=new Date().getTime(),Bo(Io.BROWSER,window).then(ye=>ht.upsertData(_,ye)).catch(()=>{}),ln.next(_.sections||[]),Yi(_,".book-content",document)):ut),xt({refCount:!0,bufferSize:1}));j(t,ve,_=>n(15,c=_));const Re=mt(()=>visualViewport?Ke(visualViewport,"resize"):an()).pipe($t()),ze=Re.pipe(Zt(0),_e(()=>(visualViewport==null?void 0:visualViewport.width)||0),Pt());j(t,ze,_=>n(16,m=_));const Ae=Re.pipe(Zt(0),_e(()=>(visualViewport==null?void 0:visualViewport.height)||0),Pt());j(t,Ae,_=>n(17,d=_));const Ce=To.pipe(_e(_=>fr.get(_)),Nt(_=>!!_));j(t,Ce,_=>n(18,g=_));const ce=Ce.pipe(_e(_=>_.backgroundColor));j(t,ce,_=>n(19,h=_));const Ve=ce.pipe(Bn(()=>document.body,(_,ye)=>ye.style.setProperty(Vn,_),_=>_.style.removeProperty(Vn)),ot(),Pt());j(t,Ve,_=>n(34,R=_));const Oe=Ao.pipe(Bn(()=>document.documentElement,(_,ye)=>ye.style.setProperty(On,_),_=>_.style.removeProperty(On)),ot(),Pt());j(t,Oe,_=>n(35,v=_));const Ie=mt(()=>Ot).pipe(_e(_=>[..._.values()]));j(t,Ie,_=>n(10,r=_));function $e(_){!Ji(_,Oo.getValue(),qe,et,ct=>Yt.next(Yt.getValue()+ct),K,ie,o,y)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),_.preventDefault())}function Ue(){let _;return Se.subscribe(ye=>_=ye).unsubscribe(),_}async function qe(){const _=Ue();if(!_||!re)return;const ye=re.formatBookmarkData(_);await ht.putBookmark(ye),n(9,fe=Promise.resolve(ye))}async function et(){const _=await fe;!_||!re||re.scrollToBookmark(_)}function S(){ht.deleteLastItem(),qe()}function te(){if(!Dt.fullscreenElement){Dt.requestFullscreen(document.documentElement);return}Dt.exitFullscreen()}function y(_){if(!(r!=null&&r.length))return;const[ye,ct]=Zn(r);!ct&&_===-1||_===1&&ct===ye.length-1||wt.next(ye[ct+_].reference)}const ne=()=>n(4,z=!0);function We(_){C=_,n(5,C)}const De=()=>{n(4,z=!1),at.next(!0)},Le=()=>n(4,z=!1);function St(_){x=_,n(0,x)}function p(_){D=_,n(1,D)}function jt(_){C=_,n(5,C)}function Kt(_){fe=_,n(9,fe)}function oo(_){K=_,n(2,K)}function ro(_){re=_,n(7,re)}function io(_){ie=_,n(8,ie)}const ao=()=>at.next(!1),lo=()=>n(6,P=!P);return t.$$.update=()=>{t.$$.dirty[0]&12&&i&&(K==null||K.off()),t.$$.dirty[0]&3&&D&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{exploredCharCount:x}})),t.$$.dirty[0]&2&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{bookCharCount:D}}))},[x,D,K,i,z,C,P,re,ie,fe,r,o,a,l,u,c,m,d,g,h,b,w,s,f,k,B,T,q,O,V,Z,M,N,I,R,v,A,be,ke,Ee,pe,ve,ze,Ae,Ce,ce,Ve,Oe,Ie,$e,qe,S,te,ne,We,De,Le,St,p,jt,Kt,oo,ro,io,ao,lo]}class ua extends Qe{constructor(e){super(),Ze(this,e,ea,$i,xe,{},null,[-1,-1,-1])}}export{ua as default};
