var ir=Object.defineProperty;var rr=(n,e,t)=>e in n?ir(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var et=(n,e,t)=>(rr(n,typeof e!="symbol"?e+"":e,t),t);import{S as Et,i as Dt,a as Ft,W as ar,e as Ht,X as lr,d as G,n as Bt,j as E,a2 as wn,k as sr,l as Q,A as Pe,b as ae,m as Z,p as x,B as ve,c as le,q as U,a8 as q,r as M,C as ye,O as me,h as j,x as rt,f as Y,g as at,D as Re,T as St,E as W,$ as Hn,U as Gn,y as ne,H as oe,a5 as Wn,a9 as Yo,u as _e,v as we,w as Ue,aa as ao,ab as ce,ac as he,o as Jo,Z as Qo,_ as Zo,G as ur,M as xo,a1 as lo,a0 as fr,ad as cr,t as hr}from"../chunks/index.a1b1e1bc.js";import{k as dr,l as $o,n as ei,o as gr,q as hn,r as At,s as mr,v as pr,w as kr,x as ht,y as Pt,B as gn,z as Sn,A as zt,m as Ke,C as $t,D as ti,F as it,u as ni,E as Ut,G as oi,H as jn,I as mn,J as ii,K as so,t as _t,L as ri,c as Xn,N as ai,O as br,P as Ot,Q as Cr,R as On,S as Ln,T as _r,U as Vn,V as Tt,W as qn,X as wr,Y as Sr,Z as Pr,f as wt,_ as li,i as vr,a as tt,$ as yr,a0 as si,a1 as Rr,a2 as Mr,a3 as bt,a4 as ln,a5 as sn,a6 as Xt,M as Ct,a7 as Er,a8 as Dr,a9 as uo,j as En,aa as Fr,ab as Tr,p as fo,ac as Br,ad as Dn,ae as zn,af as Nn,ag as Ir,ah as Ar,ai as Or,aj as Lr,ak as Vr,al as zr,g as Nr,am as Hr,an as Fn,ao as Tn,h as Gr,ap as Wr,aq as jr,ar as Xr,as as qr,at as Kr,au as Ur,av as Yr,aw as Jr,ax as Qr,ay as Zr,az as xr,aA as co}from"../chunks/store.16eecc84.js";import{p as $r}from"../chunks/stores.78f67f71.js";import{f as ho,g as go}from"../chunks/format-page-title.f8574fd6.js";import{F as st,f as Kn,a as Jt,b as ea,c as ta,d as na,e as oa,g as ia,h as ra}from"../chunks/fa.5e0f40b0.js";import{t as ui,k as pn,l as Qt,_ as en,u as aa,O as vt,i as It,n as la,h as sa,a as nt,m as mt,v as Bn}from"../chunks/error-handler.2c73d00e.js";import{i as fi}from"../chunks/fonts.37c28be2.js";import{m as ua,t as ct,c as Zt,f as mo}from"../chunks/index.84794016.js";import{r as Mt,M as fa,m as qe,P as ca,c as ci}from"../chunks/merged-header-icon.bb3cbc13.js";import{a as ha}from"../chunks/theme-option.4e279c0f.js";var Yt={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,i=Yt.delegate;i&&(e=i.requestAnimationFrame,t=i.cancelAnimationFrame);var o=e(function(r){t=void 0,n(r)});return new ui(function(){return t==null?void 0:t(o)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Yt.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,pn([],Qt(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Yt.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,pn([],Qt(n)))},delegate:void 0},da=function(n){en(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e}(ui),kn={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var o=kn.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,pn([n,e],Qt(t))):setInterval.apply(void 0,pn([n,e],Qt(t)))},clearInterval:function(n){var e=kn.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},hi=function(n){en(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o.pending=!1,o}return e.prototype.schedule=function(t,i){var o;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,i)),this.pending=!0,this.delay=i,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,i),this},e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),kn.setInterval(t.flush.bind(t,this),o)},e.prototype.recycleAsyncId=function(t,i,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return i;i!=null&&kn.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(t,i);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var o=!1,r;try{this.work(t)}catch(a){o=!0,r=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,o=t.scheduler,r=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,aa(r,this),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(da),po=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=dr.now,n}(),di=function(n){en(e,n);function e(t,i){i===void 0&&(i=po.now);var o=n.call(this,t,i)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var o;this._active=!0;do if(o=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,o){for(;t=i.shift();)t.unsubscribe();throw o}},e}(po),tn=new di(hi),ga=tn,ma=function(n){en(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o}return e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),o!==null&&o>0?n.prototype.requestAsyncId.call(this,t,i,o):(t.actions.push(this),t._scheduled||(t._scheduled=Yt.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,i,o){var r;if(o===void 0&&(o=0),o!=null?o>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,i,o);var a=t.actions;i!=null&&((r=a[a.length-1])===null||r===void 0?void 0:r.id)!==i&&(Yt.cancelAnimationFrame(i),t._scheduled=void 0)},e}(hi),pa=function(n){en(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var o=this.actions,r;t=t||o.shift();do if(r=t.execute(t.state,t.delay))break;while((t=o[0])&&t.id===i&&o.shift());if(this._active=!1,r){for(;(t=o[0])&&t.id===i&&o.shift();)t.unsubscribe();throw r}},e}(di),Pn=new pa(ma),Gt=new vt(function(n){return n.complete()});function Un(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=$o(n);return ei(n,t)}function ka(n){return n instanceof Date&&!isNaN(n)}var ba=["addListener","removeListener"],Ca=["addEventListener","removeEventListener"],_a=["on","off"];function lt(n,e,t,i){if(It(t)&&(i=t,t=void 0),i)return lt(n,e,t).pipe(ua(i));var o=Qt(Pa(n)?Ca.map(function(l){return function(s){return n[l](e,s,t)}}):wa(n)?ba.map(ko(n,e)):Sa(n)?_a.map(ko(n,e)):[],2),r=o[0],a=o[1];if(!r&&gr(n))return hn(function(l){return lt(l,e,t)})(At(n));if(!r)throw new TypeError("Invalid event target");return new vt(function(l){var s=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];return l.next(1<f.length?f:f[0])};return r(s),function(){return a(s)}})}function ko(n,e){return function(t){return function(i){return n[t](e,i)}}}function wa(n){return It(n.addListener)&&It(n.removeListener)}function Sa(n){return It(n.on)&&It(n.off)}function Pa(n){return It(n.addEventListener)&&It(n.removeEventListener)}function nn(n,e,t){n===void 0&&(n=0),t===void 0&&(t=ga);var i=-1;return e!=null&&(mr(e)?t=e:i=e),new vt(function(o){var r=ka(n)?+n-t.now():n;r<0&&(r=0);var a=0;return t.schedule(function(){o.closed||(o.next(a++),0<=i?this.schedule(void 0,i):o.complete())},r)})}function va(n,e){return n===void 0&&(n=0),e===void 0&&(e=tn),n<0&&(n=0),nn(n,n,e)}function on(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=$o(n),i=pr(n,1/0),o=n;return o.length?o.length===1?At(o[0]):kr(i)(ei(o,t)):Gt}var ya=Array.isArray;function Ra(n){return n.length===1&&ya(n[0])?n[0]:n}function Ma(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=Ra(n),n.length===1?At(n[0]):new vt(Ea(n))}function Ea(n){return function(e){for(var t=[],i=function(r){t.push(At(n[r]).subscribe(ht(e,function(a){if(t){for(var l=0;l<t.length;l++)l!==r&&t[l].unsubscribe();t=null}e.next(a)})))},o=0;t&&!e.closed&&o<n.length;o++)i(o)}}function Da(n){return Pt(function(e,t){var i=!1,o=null,r=null,a=!1,l=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var f=o;o=null,t.next(f)}a&&t.complete()},s=function(){r=null,a&&t.complete()};e.subscribe(ht(t,function(f){i=!0,o=f,r||At(n(f)).subscribe(r=ht(t,l,s))},function(){a=!0,(!i||!r||r.closed)&&t.complete()}))})}function Fa(n,e){return e===void 0&&(e=tn),Da(function(){return nn(n,e)})}function Ta(n){return Pt(function(e,t){var i=!1,o=null,r=null,a=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var l=o;o=null,t.next(l)}};e.subscribe(ht(t,function(l){r==null||r.unsubscribe(),i=!0,o=l,r=ht(t,a,la),At(n(l)).subscribe(r)},function(){a(),t.complete()},void 0,function(){o=r=null}))})}function xt(n,e){return e===void 0&&(e=tn),Pt(function(t,i){var o=null,r=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var f=r;r=null,i.next(f)}};function s(){var f=a+n,d=e.now();if(d<f){o=this.schedule(void 0,f-d),i.add(o);return}l()}t.subscribe(ht(i,function(f){r=f,a=e.now(),o||(o=e.schedule(s,n),i.add(o))},function(){l(),i.complete()},void 0,function(){r=o=null}))})}function Wt(n){return n<=0?function(){return Gt}:Pt(function(e,t){var i=0;e.subscribe(ht(t,function(o){++i<=n&&(t.next(o),n<=i&&t.complete())}))})}function gi(n,e){return e===void 0&&(e=sa),n=n??Ba,Pt(function(t,i){var o,r=!0;t.subscribe(ht(i,function(a){var l=e(a);(r||!n(o,l))&&(r=!1,o=l,i.next(a))}))})}function Ba(n,e){return n===e}function Ia(n){return Pt(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function Aa(){return Pt(function(n,e){var t,i=!1;n.subscribe(ht(e,function(o){var r=t;t=o,i&&e.next([r,o]),i=!0}))})}function Oa(n,e){return e===void 0&&(e=!1),Pt(function(t,i){var o=0;t.subscribe(ht(i,function(r){var a=n(r,o++);(a||e)&&i.next(r),!a&&i.complete()}))})}var mi={leading:!0,trailing:!1};function La(n,e){return e===void 0&&(e=mi),Pt(function(t,i){var o=e.leading,r=e.trailing,a=!1,l=null,s=null,f=!1,d=function(){s==null||s.unsubscribe(),s=null,r&&(y(),f&&i.complete())},S=function(){s=null,f&&i.complete()},p=function(w){return s=At(n(w)).subscribe(ht(i,d,S))},y=function(){if(a){a=!1;var w=l;l=null,i.next(w),!f&&p(w)}};t.subscribe(ht(i,function(w){a=!0,l=w,!(s&&!s.closed)&&(o?y():p(w))},function(){f=!0,!(r&&a&&s&&!s.closed)&&i.complete()}))})}function Va(n,e,t){e===void 0&&(e=tn),t===void 0&&(t=mi);var i=nn(n,e);return La(function(){return i},t)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */const Yn=new gn([]),bn=new nt,rn=new nt,Nt=new nt;function pi(n){const e=n.filter(r=>!r.parentChapter);let t=n.find(r=>r.progress<100);t||(t=n[n.length-1]);const i=t.parentChapter||t.reference,o=e.findIndex(r=>r.reference===i);return[e,o,i]}function za(n){let e,t;return{c(){e=new ar(!1),t=Ht(),this.h()},l(i){e=lr(i,!1),t=Ht(),this.h()},h(){e.a=t},m(i,o){e.m(n[0],i,o),G(i,t,o)},p(i,[o]){o&1&&e.p(i[0])},i:Bt,o:Bt,d(i){i&&E(t),i&&e.d()}}}function Na(n,e,t){let{html:i}=e;const o=wn();return sr(()=>{o("load")}),n.$$set=r=>{"html"in r&&t(0,i=r.html)},[i]}class ki extends Et{constructor(e){super(),Dt(this,e,Na,za,Ft,{html:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function Ha(n,e){var o;const t=(o=document.elementFromPoint(n,e))==null?void 0:o.closest("p");if(!t)return;const i=Sn(t);if(i.length)return{range:Jn(i[0]),parent:t}}function Jn(n,e=0,t=0){const i=new Range;return i.setStart(n,e),i.setEnd(n,t),i}function Ga(n,e){var a,l,s;const t=(a=n.getSelection())!=null&&a.toString().trim()?(l=n.getSelection())==null?void 0:l.getRangeAt(0):void 0;let i;if(t?i=t:i=e,!i)return;const o=(s=i.endContainer.parentElement)==null?void 0:s.closest("p");if(!o)return;const r=Sn(o);if(r.length)return Jn(r[0])}function bo(n,e){const t=n.createRange();return t.selectNode(e),t.getBoundingClientRect()}function bi(n,e=250){var t;(t=n.getSelection())==null||t.removeAllRanges(),setTimeout(()=>{var i;(i=n.getSelection())==null||i.addRange(new Range)},e)}function Ci(n,e,t,i){const o=Math.min(Math.max(i,0),t?n.innerWidth/4:n.innerHeight/4),r=e.getBoundingClientRect(),a=t?o:r.left,l=t?n.innerWidth-o:r.right,s=t?r.top:o,f=t?r.bottom:n.innerHeight-o,d=Number(getComputedStyle(e).lineHeight.replace(/px$/,""));return{elLeftReferencePoint:a,elRightReferencePoint:l,elTopReferencePoint:s,elBottomReferencePoint:f,firstDimensionMargin:o,pointGap:d}}function Kt(n,e,t,i=0){if(!n)return;const o=`animate-[pulse_${t}s_cubic-bezier(0.4,0,0.6,1)_${i?"1":"infinite"}]`;n.classList[e](o),i&&setTimeout(()=>n.classList.remove(o),i)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class Wa{constructor(e,t,i,o,r=Pn){et(this,"enabled$",new gn(!1));this.multiplier=e,this.verticalMode=t,this.enabled$.pipe(zt(a=>{if(!a)return Gt;let l=0;return va(0,r).pipe(Ke(()=>Date.now()),Aa(),Ke(s=>this.calcNewPos(s)),Ke(s=>{l+=s;const f=Math.trunc(l);return l-=f,f}),$t(s=>s!==0))}),ct(i)).subscribe(a=>{let l="top";t&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,t]){let i=.00365956;return this.verticalMode&&(i=-91489e-8),i*this.multiplier*(t-e)}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function Lt(n,e){return e==="rtl"?-n:n}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class ja{constructor(e,t,i){this.calculator=e,this.window=t,this.firstDimensionMargin=i}scrollToBookmark(e,t=0){const i=this.getBookmarkPosition(e);if(!i)return;const{scrollToData:o}=Co(i,this.firstDimensionMargin),r=this.calculator.verticalMode?"left":"top";o.left!==void 0&&r==="left"?o.left+=t:o.top!==void 0&&r==="top"&&(o.top-=t),this.window.scrollTo(o)}formatBookmarkData(e,t=0){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount,{verticalMode:r}=this.calculator,a=r?"scrollX":"scrollY";return{dataId:e,exploredCharCount:i,progress:i/o,[a]:this.window[a],lastBookmarkModified:new Date().getTime()}}formatBookmarkDataByRange(e){return this.formatBookmarkData(e)}getBookmarkBarPosition(e){const t=this.getBookmarkPosition(e);if(t)return Co(t,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:t}=this.calculator,i=this.getBookmarkTargetPosByScrollValue(e);if(i)return i;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return t?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:t}=e,i=o=>{const r=e[o];if(!r)return;const a=Lt(r,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===t)return{[o]:r}};return this.calculator.verticalMode?i("scrollX"):i("scrollY")}}function Co(n,e){return"scrollX"in n?{scrollToData:{left:n.scrollX},bookmarkPosData:{right:`${-n.scrollX+e}px`}}:{scrollToData:{top:n.scrollY},bookmarkPosData:{top:`${n.scrollY+e}px`}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function _i(n){const e=(t,i,o,r)=>{if(o<i)return n??o;const a=Math.floor((i+o)/2);return t[a]===r?a:t[a]>r?e(t,i,a-1,r):e(t,a+1,o,r)};return(t,i)=>e(t,0,t.length-1,i)}function Xa(){const n=(e,t,i,o)=>{if(i<t)return-1;const r=Math.floor((t+i)/2);return o.intersectsNode(e[r])?r:o.comparePoint(e[r],0)>0?n(e,t,r-1,o):n(e,r+1,i,o)};return(e,t)=>n(e,0,e.length-1,t)}const qa=Xa(),Ka=_i(-1),Cn=_i(void 0);/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class wi{constructor(e,t,i,o,r){et(this,"charCount");et(this,"accumulatedCharCount");et(this,"paragraphPos");et(this,"paragraphs");et(this,"paragraphPosToAccCharCount",new Map);this.containerEl=e,this.axis=t,this.direction=i,this.scrollEl=o,this.document=r,this.paragraphs=Sn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=ti(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const t=this.scrollEl.getBoundingClientRect(),i=Lt(this.verticalMode?t.right:t.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),r=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=bo(this.document,l),d=(()=>(this.verticalMode?s.width:s.height)<=0?this.paragraphPos[a-1]||0:Lt(this.verticalMode?s.left:s.bottom,this.direction)-i-o+e)();this.paragraphPos[a]=d;const S=r.get(d)||[];r.set(d,S),S.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(r.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(e=0){return this.getCharCountByScrollPos(this.scrollPos+e)}getCharCountByScrollPos(e){const t=Cn(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[t])||0}getBookMarkPosForSection(e,t){const i=Math.max(0,Ka(this.accumulatedCharCount,t-e));let o=i,r=this.processSectionBookmarkIteration(i,e,t);if(!r){for(let a=i+1,{length:l}=this.accumulatedCharCount;a<l;a+=1)if(r=this.processSectionBookmarkIteration(a,e,t),r){o=a;break}}return{bookmarkPos:r,node:r?this.paragraphs[o]:void 0,isFirstNode:o===0}}getScrollPosByCharCount(e){const t=Cn(this.accumulatedCharCount,e);return Lt(this.paragraphPos[t],this.direction)||0}getCharCountToPoint(e){const t=Math.max(0,qa(this.paragraphs,e));return this.accumulatedCharCount[t-1]||0}processSectionBookmarkIteration(e,t,i){const o=this.accumulatedCharCount[e]+t;let r;if(o>i){let a=this.paragraphs[e];a.parentElement&&(a=a.parentElement.closest("p")||a.parentElement);const{top:l,right:s,left:f}=bo(this.document,a);r=this.axis==="horizontal"?{left:s}:{top:l,left:f}}return r}get scrollPos(){return Lt(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function Ua(n,e,t){const i=Qa(e,t)(n,"scrollLeft");return(o,r,a)=>{if(!Ya(o))return;const l=Ja(o,r,a);i(-l),o.preventDefault()}}function Ya(n){return!(!n.deltaY||n.deltaX||n.altKey||n.shiftKey||n.ctrlKey||n.metaKey)}function Ja(n,e,t){switch(n.deltaMode){case 0:return n.deltaY;case 1:return n.deltaY*e*1.75;default:return n.deltaY*t}}function Qa(n,e){return(t,i)=>{let o=!1,r=n[i],a=n[i];const l=()=>{o=!0;const s=Math.trunc((r-n[i])/t);if(n[i]!==a){o=!1;return}if(a+=s,n.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(r=n[i],a=n[i]),r+=s,o||e(l)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class Za{constructor(e,t,i){this.verticalMode=e,this.firstDimensionMargin=t,this.window=i}nextPage(){this.scrollByPercent(.95)}prevPage(){this.scrollByPercent(-.95)}updateSectionDataByOffset(){}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let t=this.window.innerHeight,i="top",o=1;this.verticalMode&&(t=this.window.innerWidth,i="left",o=-1);const r=t-this.firstDimensionMargin*2;this.window.scrollBy({[i]:r*e*o,behavior:"smooth"})}}const{document:_o,window:xa}=Gn;function wo(n){let e,t,i,o,r;return{c(){e=Q("div"),i=ae(),o=Q("div"),this.h()},l(a){e=Z(a,"DIV",{class:!0,style:!0}),x(e).forEach(E),i=le(a),o=Z(a,"DIV",{class:!0,style:!0}),x(o).forEach(E),this.h()},h(){U(e,"class","fixed z-[5]"),U(e,"style",t=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][0]+": 0"),q(e,"inset-y-0",n[2]),q(e,"inset-x-0",!n[2]),M(e,"background-color",n[4]),U(o,"class","fixed z-[5]"),U(o,"style",r=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][1]+": 0"),q(o,"inset-y-0",n[2]),q(o,"inset-x-0",!n[2]),M(o,"background-color",n[4])},m(a,l){G(a,e,l),G(a,i,l),G(a,o,l)},p(a,l){l[0]&14712832&&t!==(t=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][0]+": 0")&&U(e,"style",t),l[0]&4&&q(e,"inset-y-0",a[2]),l[0]&4&&q(e,"inset-x-0",!a[2]),l[0]&16&&M(e,"background-color",a[4]),l[0]&14712832&&r!==(r=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][1]+": 0")&&U(o,"style",r),l[0]&4&&q(o,"inset-y-0",a[2]),l[0]&4&&q(o,"inset-x-0",!a[2]),l[0]&16&&M(o,"background-color",a[4])},d(a){a&&E(e),a&&E(i),a&&E(o)}}}function So(n){let e,t,i,o;const r=[el,$a],a=[];function l(s,f){return s[2]?0:1}return e=l(n),t=a[e]=r[e](n),{c(){t.c(),i=Ht()},l(s){t.l(s),i=Ht()},m(s,f){a[e].m(s,f),G(s,i,f),o=!0},p(s,f){let d=e;e=l(s),e===d?a[e].p(s,f):(rt(),Y(a[d],1,1,()=>{a[d]=null}),at(),t=a[e],t?t.p(s,f):(t=a[e]=r[e](s),t.c()),j(t,1),t.m(i.parentNode,i))},i(s){o||(j(t),o=!0)},o(s){Y(t),o=!1},d(s){a[e].d(s),s&&E(i)}}}function $a(n){let e,t,i;return t=new st({props:{icon:Jt}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);ve(t.$$.fragment,r),r.forEach(E),this.h()},h(){U(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),M(e,"color",n[3]),M(e,"left",n[17]),M(e,"top",`calc(${n[19].top} + 1.5rem)`)},m(o,r){G(o,e,r),ye(t,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&131072&&M(e,"left",o[17]),r[0]&524288&&M(e,"top",`calc(${o[19].top} + 1.5rem)`)},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&E(e),Re(t)}}}function el(n){let e,t,i;return t=new st({props:{icon:Jt}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);ve(t.$$.fragment,r),r.forEach(E),this.h()},h(){U(e,"class","pointer-events-none absolute text-xl opacity-25"),M(e,"color",n[3]),M(e,"right",`calc(${n[19].right} + 1rem)`),M(e,"top",n[17])},m(o,r){G(o,e,r),ye(t,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&524288&&M(e,"right",`calc(${o[19].right} + 1rem)`),r[0]&131072&&M(e,"top",o[17])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&E(e),Re(t)}}}function Po(n){let e,t,i;return t=new st({props:{icon:Kn,spin:!0}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);ve(t.$$.fragment,r),r.forEach(E),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),M(e,"color",n[3]),M(e,"background-color",n[4])},m(o,r){G(o,e,r),ye(t,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&16&&M(e,"background-color",o[4])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&E(e),Re(t)}}}function tl(n){let e,t,i=`${n[9]}px`,o=`${n[20]||n[1]}px`,r,a,l,s,f,d,S;t=new ki({props:{html:n[0]}}),t.$on("load",n[27]);let p=n[15]&&wo(n),y=n[19]&&So(n),w=!n[18]&&Po(n);return{c(){e=Q("div"),Pe(t.$$.fragment),r=ae(),p&&p.c(),a=ae(),y&&y.c(),l=ae(),w&&w.c(),s=ae(),this.h()},l(u){e=Z(u,"DIV",{class:!0});var k=x(e);ve(t.$$.fragment,k),k.forEach(E),r=le(u),p&&p.l(u),a=le(u),y&&y.l(u),l=le(u),w&&w.l(u),s=le(u),this.h()},h(){U(e,"class","book-content m-auto svelte-1ouz3ba"),q(e,"book-content--writing-vertical-rl",n[2]),q(e,"book-content--writing-horizontal-rl",!n[2]),q(e,"book-content--hide-furigana",n[12]),q(e,"book-content--hide-spoiler-image",n[11]),q(e,"book-content--furigana-style-partial",n[13]===it.Partial),q(e,"book-content--furigana-style-full",n[13]===it.Full),q(e,"book-content--furigana-style-toggle",n[13]===it.Toggle),M(e,"color",n[3]),M(e,"font-size",i),M(e,"line-height",n[10]),M(e,"max-width",!n[2]&&n[14]?`${n[14]}px`:void 0),M(e,"max-height",n[20]?`${n[20]}px`:void 0),M(e,"padding-left",n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"padding-right",n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"padding-top",!n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"padding-bottom",!n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"--font-family-serif",n[7]),M(e,"--font-family-sans-serif",n[8]),M(e,"--book-content-hint-furigana-font-color",n[5]),M(e,"--book-content-hint-furigana-shadow-color",n[6]),M(e,"--book-content-child-height",o)},m(u,k){G(u,e,k),ye(t,e,null),n[49](e),G(u,r,k),p&&p.m(u,k),G(u,a,k),y&&y.m(u,k),G(u,l,k),w&&w.m(u,k),G(u,s,k),f=!0,d||(S=[me(xa,"scroll",n[26]),me(_o.body,"wheel",n[25],{passive:!1}),me(_o.body,"mousedown",n[50])],d=!0)},p(u,k){const g={};k[0]&1&&(g.html=u[0]),t.$set(g),(!f||k[0]&4)&&q(e,"book-content--writing-vertical-rl",u[2]),(!f||k[0]&4)&&q(e,"book-content--writing-horizontal-rl",!u[2]),(!f||k[0]&4096)&&q(e,"book-content--hide-furigana",u[12]),(!f||k[0]&2048)&&q(e,"book-content--hide-spoiler-image",u[11]),(!f||k[0]&8192)&&q(e,"book-content--furigana-style-partial",u[13]===it.Partial),(!f||k[0]&8192)&&q(e,"book-content--furigana-style-full",u[13]===it.Full),(!f||k[0]&8192)&&q(e,"book-content--furigana-style-toggle",u[13]===it.Toggle),k[0]&8&&M(e,"color",u[3]),k[0]&512&&i!==(i=`${u[9]}px`)&&M(e,"font-size",i),k[0]&1024&&M(e,"line-height",u[10]),k[0]&16388&&M(e,"max-width",!u[2]&&u[14]?`${u[14]}px`:void 0),k[0]&1048576&&M(e,"max-height",u[20]?`${u[20]}px`:void 0),k[0]&32772&&M(e,"padding-left",u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&32772&&M(e,"padding-right",u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&32772&&M(e,"padding-top",!u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&32772&&M(e,"padding-bottom",!u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&128&&M(e,"--font-family-serif",u[7]),k[0]&256&&M(e,"--font-family-sans-serif",u[8]),k[0]&32&&M(e,"--book-content-hint-furigana-font-color",u[5]),k[0]&64&&M(e,"--book-content-hint-furigana-shadow-color",u[6]),k[0]&1048578&&o!==(o=`${u[20]||u[1]}px`)&&M(e,"--book-content-child-height",o),u[15]?p?p.p(u,k):(p=wo(u),p.c(),p.m(a.parentNode,a)):p&&(p.d(1),p=null),u[19]?y?(y.p(u,k),k[0]&524288&&j(y,1)):(y=So(u),y.c(),j(y,1),y.m(l.parentNode,l)):y&&(rt(),Y(y,1,1,()=>{y=null}),at()),u[18]?w&&(rt(),Y(w,1,1,()=>{w=null}),at()):w?(w.p(u,k),k[0]&262144&&j(w,1)):(w=Po(u),w.c(),j(w,1),w.m(s.parentNode,s))},i(u){f||(j(t.$$.fragment,u),j(y),j(w),f=!0)},o(u){Y(t.$$.fragment,u),Y(y),Y(w),f=!1},d(u){u&&E(e),Re(t),n[49](null),u&&E(r),p&&p.d(u),u&&E(a),y&&y.d(u),u&&E(l),w&&w.d(u),u&&E(s),d=!1,St(S)}}}function nl(n,e,t){let i,o,r,a,l,s,f,d,S;W(n,ni,P=>t(57,l=P)),W(n,Ut,P=>t(58,s=P)),W(n,oi,P=>t(24,f=P)),W(n,Nt,P=>t(59,d=P)),W(n,jn,P=>t(48,S=P));let{htmlContent:p}=e,{width:y}=e,{height:w}=e,{verticalMode:u}=e,{fontColor:k}=e,{backgroundColor:g}=e,{hintFuriganaFontColor:D}=e,{hintFuriganaShadowColor:O}=e,{fontFamilyGroupOne:R}=e,{fontFamilyGroupTwo:v}=e,{fontSize:N}=e,{lineHeight:K}=e,{hideSpoilerImage:F}=e,{hideFurigana:B}=e,{furiganaStyle:V}=e,{secondDimensionMaxValue:T}=e,{firstDimensionMargin:I}=e,{autoPositionOnResize:_}=e,{autoBookmark:z}=e,{loadingState:b}=e,{multiplier:A}=e,{bookmarkData:$}=e,{exploredCharCount:se}=e,{bookCharCount:ke}=e,{autoScroller:Ve}=e,{bookmarkManager:Me}=e,{pageManager:Se}=e,{customReadingPoint:Ie}=e,{customReadingPointLeft:ze}=e,{customReadingPointTop:de}=e,{customReadingPointScrollOffset:ie}=e;const re=wn();let Te=!1,J,ee,Ne={},Ee,De,C,L,He,X=0,Be=!1,be=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem",Ae=!1;const dt=Ua(4,document.documentElement,requestAnimationFrame),Ye=new nt,Ce=new nt,pe=new nt,Je=new Map,Qe=new Map;let ge=0,ut=!1;Hn(()=>{pe.next(),pe.complete()}),Ee=new Wa(A,u,pe,document),Ve=Ee,Zt([Ye,Ce]).pipe($t(()=>_),mn(1),Ke(([P,ue])=>u?ue:P),gi(),xt(10),ii(Pn),ct(pe)).subscribe(()=>{if(!ee||!C)return;const P=ee.getScrollPosByCharCount(X)+(u?ie:-ie);Be=!0,C.scrollTo(P)});function Ge(){if(!S||!J)return;const{elLeftReferencePoint:P,elTopReferencePoint:ue,elRightReferencePoint:We,elBottomReferencePoint:Oe,firstDimensionMargin:m,pointGap:te}=Ci(window,J,u,I);if(u){t(34,de=ue),t(33,ze=Math.min(Math.max(m+(We-P)*(Ie/100)-2,P+te),We-2)),t(35,ie=window.innerWidth-m-ze);return}t(34,de=Math.min(Math.max(m+(Oe-ue)*(Ie/100),m),Oe-te*1.5)),t(33,ze=P),t(35,ie=de-m)}function pt(P){P.updateParagraphPos(),Ge(),t(28,se=P.calcExploredCharCount(ie)),He&&(He=!1,$.then(ue=>{!ue||!Me||(X=ue.exploredCharCount||0,Me.scrollToBookmark(ue,ie))}).finally(()=>{z&&lt(window,"scroll").pipe(mn(1),xt(3e3),ct(pe)).subscribe(()=>{re("bookmark")}),Yn.pipe(Wt(1),zt(ue=>ue.length?(ue.forEach(We=>{const Oe=We.reference,m=document.getElementById(Oe);m&&(ge||(ge=Number(getComputedStyle(m)[u?"marginLeft":"marginBottom"].replace(/px$/,""))/2),Qe.set(Oe,{...We,progress:0}),Je.set(Oe,m))}),Je.size?(je(),lt(window,"scroll")):Gt):Gt),Ta(()=>nn(ut?100:500)),ct(pe)).subscribe(je)})),t(44,Ne={}),t(18,Te=!0)}function je(){const P=[...Qe.entries()];for(let ue=0,{length:We}=P;ue<We;ue+=1){const[Oe,m]=P[ue],h=Je.get(Oe).getBoundingClientRect();m.progress=u?Math.min(Math.max(h.right+(I||0)-window.innerWidth+ie,0),h.width)/(h.width||1)*100:Math.abs(Math.min(Math.max(h.top-(I||0)-ie,-h.height),0))/(h.height||1)*100,Qe.set(Oe,m)}ut=!1,bn.next(Qe)}function Ze(P){u&&!d&&!f&&!s&&dt(P,N,window.innerWidth)}function Xe(){requestAnimationFrame(()=>{ee&&(t(28,se=ee.calcExploredCharCount(ie)),!Be&&se&&(X=se),Be=!1)})}function gt(){if(!J)return;t(43,ee=new wi(J,u?"vertical":"horizontal",u?"rtl":"ltr",document.documentElement,document)),t(28,se=0),X=se,t(29,ke=ee.charCount);let P=!1;try{P=document.fonts.check(`${N}px ${R||"Noto Serif JP"}`)}catch(ue){mt.error(`Error checking Font Load: ${ue.message}`),P=!0}if(P)re("contentChange",J);else if(!Ae){Ae=!0;const ue=fi(R,l)?3e4:1e4,We=setTimeout(()=>{mt.error(`Error loading primary Font: ${R}`),re("contentChange",J)},ue);document.fonts.addEventListener("loadingdone",()=>{clearTimeout(We),re("contentChange",J)})}}rn.pipe(ct(pe)).subscribe(P=>{let ue=document.getElementById(P);if(!ue)return;ue=!P.startsWith(so)&&ue.closest(`div[id^="${so}"]`)||ue,ut=!0;const Oe=ue.getBoundingClientRect();u?window.scrollBy(-(window.innerWidth-Oe.right-(I||0)-ie-(!ie||ie&&ge>ie?ge:0)),0):window.scrollBy(0,Oe.top-(I||0)-ie-(!ie||ie&&ge>ie?ge:0))});function Fe(P){ne[P?"unshift":"push"](()=>{J=P,t(16,J)})}const kt=P=>{f&&P.button===1&&P.preventDefault()};return n.$$set=P=>{"htmlContent"in P&&t(0,p=P.htmlContent),"width"in P&&t(36,y=P.width),"height"in P&&t(1,w=P.height),"verticalMode"in P&&t(2,u=P.verticalMode),"fontColor"in P&&t(3,k=P.fontColor),"backgroundColor"in P&&t(4,g=P.backgroundColor),"hintFuriganaFontColor"in P&&t(5,D=P.hintFuriganaFontColor),"hintFuriganaShadowColor"in P&&t(6,O=P.hintFuriganaShadowColor),"fontFamilyGroupOne"in P&&t(7,R=P.fontFamilyGroupOne),"fontFamilyGroupTwo"in P&&t(8,v=P.fontFamilyGroupTwo),"fontSize"in P&&t(9,N=P.fontSize),"lineHeight"in P&&t(10,K=P.lineHeight),"hideSpoilerImage"in P&&t(11,F=P.hideSpoilerImage),"hideFurigana"in P&&t(12,B=P.hideFurigana),"furiganaStyle"in P&&t(13,V=P.furiganaStyle),"secondDimensionMaxValue"in P&&t(14,T=P.secondDimensionMaxValue),"firstDimensionMargin"in P&&t(15,I=P.firstDimensionMargin),"autoPositionOnResize"in P&&t(37,_=P.autoPositionOnResize),"autoBookmark"in P&&t(38,z=P.autoBookmark),"loadingState"in P&&t(39,b=P.loadingState),"multiplier"in P&&t(40,A=P.multiplier),"bookmarkData"in P&&t(41,$=P.bookmarkData),"exploredCharCount"in P&&t(28,se=P.exploredCharCount),"bookCharCount"in P&&t(29,ke=P.bookCharCount),"autoScroller"in P&&t(30,Ve=P.autoScroller),"bookmarkManager"in P&&t(31,Me=P.bookmarkManager),"pageManager"in P&&t(32,Se=P.pageManager),"customReadingPoint"in P&&t(42,Ie=P.customReadingPoint),"customReadingPointLeft"in P&&t(33,ze=P.customReadingPointLeft),"customReadingPointTop"in P&&t(34,de=P.customReadingPointTop),"customReadingPointScrollOffset"in P&&t(35,ie=P.customReadingPointScrollOffset)},n.$$.update=()=>{if(n.$$.dirty[0]&4&&t(23,i=u?"height":"width"),n.$$.dirty[0]&4&&t(22,o=u?"width":"height"),n.$$.dirty[0]&4&&t(21,r=u?["left","right"]:["top","bottom"]),n.$$.dirty[1]&32&&Ye.next(y),n.$$.dirty[0]&2&&Ce.next(w),n.$$.dirty[0]&16388&&t(20,a=u&&T?T:void 0),n.$$.dirty[0]&212996&&T&&J){const P=Number(getComputedStyle(J)[u?"marginTop":"marginRight"].replace(/px$/,""));t(17,be=`min(max(calc(${`${P}px - ${be}`}), ${be}), ${P?`${P}px`:be})`)}if(n.$$.dirty[0]&1&&p&&(He=!0),n.$$.dirty[0]&2|n.$$.dirty[1]&4384&&ee&&y&&w&&!b){const P=ee;requestAnimationFrame(()=>{pt(P)})}n.$$.dirty[0]&4|n.$$.dirty[1]&16896&&Ee&&(t(45,Ee.multiplier=A,Ee),t(45,Ee.verticalMode=u,Ee)),n.$$.dirty[0]&32768|n.$$.dirty[1]&36864&&ee&&(t(46,De=ee&&new ja(ee,window,I||0)),t(31,Me=De)),n.$$.dirty[1]&41984&&Ne&&(t(19,L=void 0),$.then(P=>{P&&t(19,L=De==null?void 0:De.getBookmarkBarPosition(P))})),n.$$.dirty[0]&32772|n.$$.dirty[1]&65536&&(t(47,C=new Za(u,I,window)),t(32,Se=C)),n.$$.dirty[0]&65536|n.$$.dirty[1]&133120&&S&&J&&Number.isFinite(Ie)&&(Ge(),Xe(),je())},[p,w,u,k,g,D,O,R,v,N,K,F,B,V,T,I,J,be,Te,L,a,r,o,i,f,Ze,Xe,gt,se,ke,Ve,Me,Se,ze,de,ie,y,_,z,b,A,$,Ie,ee,Ne,Ee,De,C,S,Fe,kt]}class ol extends Et{constructor(e){super(),Dt(this,e,nl,tl,Ft,{htmlContent:0,width:36,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontFamilyGroupOne:7,fontFamilyGroupTwo:8,fontSize:9,lineHeight:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:37,autoBookmark:38,loadingState:39,multiplier:40,bookmarkData:41,exploredCharCount:28,bookCharCount:29,autoScroller:30,bookmarkManager:31,pageManager:32,customReadingPoint:42,customReadingPointLeft:33,customReadingPointTop:34,customReadingPointScrollOffset:35},null,[-1,-1,-1])}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */const il="px-4 md:px-8";/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function rl(n){const e=Array.from(n.getElementsByTagName("img"));return new vt(t=>{const i=e.filter(r=>r.src).map(al);if(i.length<=0){t.next(!1),t.complete();return}const o=Zt(i).subscribe(()=>{t.next(!1),t.complete()});return t.next(!0),o})}function al(n){return n.complete?Un(1):Ma(lt(n,"load"),lt(n,"error"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function ll(n,e){const t=sl(n),i=fl(n);return o=>on(t(o),ul(o,e),i(o))}function sl(n){return e=>{const t=Array.from(e.getElementsByTagName("a"));t.forEach(o=>{o.href=n.location.pathname+o.hash});const i=t.map(o=>_n(o).pipe(_t(()=>rn.next(o.hash.substring(1)))));return on(...i)}}function ul(n,e){const t=e===it.Toggle,o=Array.from(n.getElementsByTagName("ruby")).map(r=>t?_n(r).pipe(_t(()=>{r.classList.toggle("reveal-rt")})):_n(r).pipe(Wt(1),_t(()=>{r.classList.add("reveal-rt")})));return on(...o)}function fl(n){return e=>{const i=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const r=n.createElement("span");return r.classList.add("spoiler-label"),r.setAttribute("aria-hidden","true"),r.innerText="SPOILER",o.appendChild(r),_n(o).pipe(Wt(1),_t(()=>{o.removeChild(r),o.removeAttribute("data-ttu-spoiler-img")}))});return on(...i)}}function _n(n){return lt(n,"click").pipe(_t(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const cl=300,hl=60,Si="none";function qt(n,e,t){return n.addEventListener(e,t),()=>n.removeEventListener(e,t)}function dl(n,e){return e.filter(t=>n.pointerId!==t.pointerId)}function un(n,e,t,i,o){n.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:t,pointersCount:i.length}}))}function gl(n,e,t,i,o,r=Si){e.style.touchAction=r;let a=[];function l(f){a.push(f),un(e,n,f,a,"down"),i==null||i(a,f);const d=f.pointerId;function S(g){d===g.pointerId&&(a=dl(g,a),a.length||p(),un(e,n,g,a,"up"),o==null||o(a,g))}function p(){y(),w(),u(),k()}const y=qt(e,"pointermove",g=>{a=a.map(D=>g.pointerId===D.pointerId?g:D),un(e,n,g,a,"move"),t==null||t(a,g)}),w=qt(e,"lostpointercapture",g=>{S(g)}),u=qt(e,"pointerup",g=>{S(g)}),k=qt(e,"pointerleave",g=>{a=[],p(),un(e,n,g,a,"up"),o==null||o(a,g)})}const s=qt(e,"pointerdown",l);return{destroy:()=>{s()}}}function ml(n,e={timeframe:cl,minSwipeDistance:hl,touchAction:Si}){const t="swipe";let i,o,r,a;function l(f,d){o=d.clientX,r=d.clientY,i=Date.now(),f.length===1&&(a=d.target)}function s(f,d){if(d.type==="pointerup"&&f.length===0&&Date.now()-i<e.timeframe){const S=d.clientX-o,p=d.clientY-r,y=Math.abs(S),w=Math.abs(p);let u=null;y>=2*w&&y>e.minSwipeDistance?u=S>0?"right":"left":w>=2*y&&w>e.minSwipeDistance&&(u=p>0?"bottom":"top"),u&&n.dispatchEvent(new CustomEvent(t,{detail:{direction:u,target:a}}))}}return gl(t,n,null,l,s,e.touchAction)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class pl{constructor(e,t,i,o,r){this.calculator=e,this.pageManager=t,this.sectionReady$=i,this.sectionIndex$=o,this.setIntendedCharCount=r}scrollToBookmark(e){const t=e.exploredCharCount;if(!t)return;const i=this.calculator.getSectionIndexByCharCount(t),o=l=>{const s=l.getScrollPosByCharCount(t);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(t)};if(this.sectionIndex$.getValue()===i){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(i)}formatBookmarkData(e){return this.formatBookmarkDataByRange(e,void 0)}formatBookmarkDataByRange(e,t){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount;return{dataId:e,exploredCharCount:i,progress:i/o,lastBookmarkModified:new Date().getTime()}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class kl{constructor(e,t,i,o,r,a,l,s,f,d,S){et(this,"translateX",0);et(this,"sectionData",new Map);this.contentEl=e,this.scrollEl=t,this.sections=i,this.sectionIndex$=o,this.virtualScrollPos$=r,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=f,this.pageChange$=d,this.sectionRenderComplete$=S,Yn.pipe(Wt(1)).subscribe(p=>{p.length&&(p.forEach(y=>{this.sectionData.set(y.reference,{...y,progress:0})}),bn.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}updateSectionDataByOffset(e=0){var o,r;const t=this.verticalMode?this.height:this.width,i=this.virtualScrollPos$.getValue()/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100;if(e){const l=(this.virtualScrollPos$.getValue()+t+this.pageGap)/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100-i;this.updateSectionData((o=this.sections[this.sectionIndex$.getValue()])==null?void 0:o.id,i+l*e)}else this.updateSectionData((r=this.sections[this.sectionIndex$.getValue()])==null?void 0:r.id,i)}flipPage(e){const t=this.verticalMode?"scrollHeight":"scrollWidth",i=this.verticalMode?this.height:this.width,o=i+this.pageGap,r=!0;if(this.translateX){const S=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const p=this.translateX;S(),this.scrollToPos(-p-o,r);return}if(this.nextSection(r)){S();return}return}const a=0,l=this.scrollEl[t],s=this.virtualScrollPos$.getValue(),f=s+o*e,d=Math.ceil(f);if(d<a){if(s!==a){this.scrollToPos(a,r);return}this.prevSection(o,t,i,r);return}if(d>=l){this.nextSection(r);return}this.scrollOrTranslateToPos(f,l,i,r)}scrollTo(e,t){const i=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[i],o,t)}prevSection(e,t,i,o){const r=this.sectionIndex$.getValue()-1;return r<0?!1:(this.updateSectionIndex(r).subscribe(()=>{const a=this.scrollEl[t];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,i,o)}),!0)}nextSection(e){const t=this.sectionIndex$.getValue()+1;return t>=this.sections.length?!1:(this.updateSectionIndex(t).subscribe(()=>{var i,o;this.scrollToPos(0,e),this.updateSectionData((i=this.sections[t-1])==null?void 0:i.id,100,!1),this.updateSectionData((o=this.sections[t])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,t,i,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/t*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+i<=t){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,t){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(t)}translateXToPos(e,t){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(t)}updateSectionIndex(e){return new vt(t=>{if(this.sectionIndex$.getValue()===e){t.next(),t.complete();return}const i=this.sectionRenderComplete$.subscribe(o=>{o===e&&t.next(),t.complete(),i.unsubscribe()});return this.sectionIndex$.next(e),i})}updateSectionData(e,t,i=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let r=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=t:r?l.progress=0:l.progress=100,!r&&s&&(r=!0),this.sectionData.set(a.reference,l)}),i&&bn.next(this.sectionData)}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class bl{constructor(e,t,i,o,r,a,l,s,f){et(this,"charCount");et(this,"sectionAccCharCounts");et(this,"sectionIndex",-1);et(this,"calculator");this.containerEl=e,this.sections=t,this.virtualScrollPos$=i,this.getWidth=o,this.getHeight=r,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=f;const d=p=>Sn(p).reduce((w,u)=>w+ti(u),0);let S=0;this.sectionAccCharCounts=t.map(p=>(S+=d(p),S)),this.charCount=S}updateCurrentSection(e){this.calculator=new wi(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){this.calculator&&this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(e){if(e&&this.calculator)return this.getSectionStartCount()+this.calculator.getCharCountToPoint(e);const t=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+t)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const t=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+t}getSectionIndexByCharCount(e){return Cn(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const t=this.getSectionStartCount(),i=this.sectionAccCharCounts[this.sectionIndex],o=e-t,r=e===i&&i-t>0;if(o<0||e>i||r)return-1;if(o===0)return 0;const a=Cn(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,f=l[a];if(Number.isNaN(Number(s[a])))return-1;const d=(u,k)=>u>=k?k:l[u]>f?u:d(u+1,k),S=s[d(a+1,l.length-1)],{screenSize:p}=this,y=this.verticalMode?-1:0,w=p*(Math.ceil(S/p)+y);return Lt(w,this.calculator.direction)}checkBookmarkOnScreen(e){const t=this.getScrollPosByCharCount(e),i=this.virtualScrollPos$.getValue();return t===i&&this.calculator?{isBookmarkScreen:!0,...this.calculator.getBookMarkPosForSection(this.getSectionStartCount(),e)}:{isBookmarkScreen:t===i,bookmarkPos:void 0,node:void 0,isFirstNode:!0}}getOffsetToRange(e,t){if(!e)return 0;const i=e.getBoundingClientRect();if(this.verticalMode)return 1-i.left/this.screenSizeMirrored;const o=Math.floor(100/t),r=Math.floor(this.screenSize/t),a=o*i.bottom/this.screenSizeMirrored;let l=a,s=0;for(let f=0;f<this.screenSize&&i.right>=f;f+=r)l=s*o+a,s+=1;return l/100}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}get screenSizeMirrored(){return(this.verticalMode?this.getWidth():this.getHeight())+this.getPageGap()}}const{window:Cl}=Gn;function vo(n){let e,t,i;return t=new st({props:{icon:Kn,spin:!0}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);ve(t.$$.fragment,r),r.forEach(E),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),M(e,"color",n[4]),M(e,"background-color",n[5])},m(o,r){G(o,e,r),ye(t,e,null),i=!0},p(o,r){r[0]&16&&M(e,"color",o[4]),r[0]&32&&M(e,"background-color",o[5])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&E(e),Re(t)}}}function yo(n){let e,t,i;return t=new st({props:{icon:Jt}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);ve(t.$$.fragment,r),r.forEach(E),this.h()},h(){U(e,"class","fixed h-3 w-3 text-base opacity-25 sm:text-xl"),M(e,"color",n[4]),M(e,"top",n[21]),M(e,"left",n[22]),M(e,"right",n[23])},m(o,r){G(o,e,r),ye(t,e,null),i=!0},p(o,r){r[0]&16&&M(e,"color",o[4]),r[0]&2097152&&M(e,"top",o[21]),r[0]&4194304&&M(e,"left",o[22]),r[0]&8388608&&M(e,"right",o[23])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&E(e),Re(t)}}}function _l(n){let e,t,i,o,r=`${n[10]}px`,a=`${n[1]}px`,l=`${n[2]}px`,s=`${n[3]?n[1]:(n[1]+Vt)/n[24]-Vt}px`,f,d,S,p,y,w;i=new ki({props:{html:n[20]}}),i.$on("load",n[26]);let u=!n[19]&&vo(n),k=n[0]&&yo(n);return{c(){e=Q("div"),t=Q("div"),Pe(i.$$.fragment),f=ae(),u&&u.c(),d=ae(),k&&k.c(),S=Ht(),this.h()},l(g){e=Z(g,"DIV",{class:!0});var D=x(e);t=Z(D,"DIV",{class:!0});var O=x(t);ve(i.$$.fragment,O),O.forEach(E),D.forEach(E),f=le(g),u&&u.l(g),d=le(g),k&&k.l(g),S=Ht(),this.h()},h(){U(t,"class","book-content-container svelte-u9j5ct"),U(e,"class","book-content m-auto svelte-u9j5ct"),q(e,"book-content--avoid-page-break",n[15]),q(e,"book-content--writing-vertical-rl",n[3]),q(e,"book-content--writing-horizontal-rl",!n[3]),q(e,"book-content--hide-furigana",n[13]),q(e,"book-content--hide-spoiler-image",n[12]),q(e,"book-content--furigana-style-partial",n[14]===it.Partial),q(e,"book-content--furigana-style-full",n[14]===it.Full),q(e,"book-content--furigana-style-toggle",n[14]===it.Toggle),M(e,"color",n[4]),M(e,"font-size",r),M(e,"line-height",n[11]),M(e,"padding-top",!n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"padding-bottom",!n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"padding-left",n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"padding-right",n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"max-width",n[1]?`${n[1]}px`:void 0),M(e,"max-height",n[3]&&n[2]?`${n[2]}px`:void 0),M(e,"--font-family-serif",n[8]),M(e,"--font-family-sans-serif",n[9]),M(e,"--book-content-hint-furigana-font-color",n[6]),M(e,"--book-content-hint-furigana-shadow-color",n[7]),M(e,"--book-content-child-width",a),M(e,"--book-content-child-height",l),M(e,"--book-content-child-column-width",!n[3]&&n[24]===1?`${n[1]}px`:""),M(e,"--book-content-column-count",n[24]),M(e,"--book-content-image-max-width",s)},m(g,D){G(g,e,D),oe(e,t),ye(i,t,null),n[44](t),n[45](e),G(g,f,D),u&&u.m(g,D),G(g,d,D),k&&k.m(g,D),G(g,S,D),p=!0,y||(w=[me(Cl,"keydown",n[28]),Wn(o=ml.call(null,e,{timeframe:500,minSwipeDistance:n[25],touchAction:"pan-y"})),me(e,"swipe",n[27])],y=!0)},p(g,D){const O={};D[0]&1048576&&(O.html=g[20]),i.$set(O),o&&Yo(o.update)&&D[0]&33554432&&o.update.call(null,{timeframe:500,minSwipeDistance:g[25],touchAction:"pan-y"}),(!p||D[0]&32768)&&q(e,"book-content--avoid-page-break",g[15]),(!p||D[0]&8)&&q(e,"book-content--writing-vertical-rl",g[3]),(!p||D[0]&8)&&q(e,"book-content--writing-horizontal-rl",!g[3]),(!p||D[0]&8192)&&q(e,"book-content--hide-furigana",g[13]),(!p||D[0]&4096)&&q(e,"book-content--hide-spoiler-image",g[12]),(!p||D[0]&16384)&&q(e,"book-content--furigana-style-partial",g[14]===it.Partial),(!p||D[0]&16384)&&q(e,"book-content--furigana-style-full",g[14]===it.Full),(!p||D[0]&16384)&&q(e,"book-content--furigana-style-toggle",g[14]===it.Toggle),D[0]&16&&M(e,"color",g[4]),D[0]&1024&&r!==(r=`${g[10]}px`)&&M(e,"font-size",r),D[0]&2048&&M(e,"line-height",g[11]),D[0]&65544&&M(e,"padding-top",!g[3]&&g[16]?`${g[16]}px`:void 0),D[0]&65544&&M(e,"padding-bottom",!g[3]&&g[16]?`${g[16]}px`:void 0),D[0]&65544&&M(e,"padding-left",g[3]&&g[16]?`${g[16]}px`:void 0),D[0]&65544&&M(e,"padding-right",g[3]&&g[16]?`${g[16]}px`:void 0),D[0]&2&&M(e,"max-width",g[1]?`${g[1]}px`:void 0),D[0]&12&&M(e,"max-height",g[3]&&g[2]?`${g[2]}px`:void 0),D[0]&256&&M(e,"--font-family-serif",g[8]),D[0]&512&&M(e,"--font-family-sans-serif",g[9]),D[0]&64&&M(e,"--book-content-hint-furigana-font-color",g[6]),D[0]&128&&M(e,"--book-content-hint-furigana-shadow-color",g[7]),D[0]&2&&a!==(a=`${g[1]}px`)&&M(e,"--book-content-child-width",a),D[0]&4&&l!==(l=`${g[2]}px`)&&M(e,"--book-content-child-height",l),D[0]&16777226&&M(e,"--book-content-child-column-width",!g[3]&&g[24]===1?`${g[1]}px`:""),D[0]&16777216&&M(e,"--book-content-column-count",g[24]),D[0]&16777226&&s!==(s=`${g[3]?g[1]:(g[1]+Vt)/g[24]-Vt}px`)&&M(e,"--book-content-image-max-width",s),g[19]?u&&(rt(),Y(u,1,1,()=>{u=null}),at()):u?(u.p(g,D),D[0]&524288&&j(u,1)):(u=vo(g),u.c(),j(u,1),u.m(d.parentNode,d)),g[0]?k?(k.p(g,D),D[0]&1&&j(k,1)):(k=yo(g),k.c(),j(k,1),k.m(S.parentNode,S)):k&&(rt(),Y(k,1,1,()=>{k=null}),at())},i(g){p||(j(i.$$.fragment,g),j(u),j(k),p=!0)},o(g){Y(i.$$.fragment,g),Y(u),Y(k),p=!1},d(g){g&&E(e),Re(i),n[44](null),n[45](null),g&&E(f),u&&u.d(g),g&&E(d),k&&k.d(g),g&&E(S),y=!1,St(w)}}}const Ro="overflow-hidden",Vt=40;function wl(n,e,t){let i,o,r,a,l,s,f,d,S;W(n,Ut,m=>t(51,o=m)),W(n,Nt,m=>t(52,r=m)),W(n,ri,m=>t(53,a=m)),W(n,Xn,m=>t(54,l=m)),W(n,ni,m=>t(55,s=m)),W(n,oi,m=>t(56,f=m)),W(n,ai,m=>t(57,d=m)),W(n,br,m=>t(25,S=m));let{htmlContent:p}=e,{width:y}=e,{height:w}=e,{verticalMode:u}=e,{fontColor:k}=e,{backgroundColor:g}=e,{hintFuriganaFontColor:D}=e,{hintFuriganaShadowColor:O}=e,{fontFamilyGroupOne:R}=e,{fontFamilyGroupTwo:v}=e,{fontSize:N}=e,{lineHeight:K}=e,{hideSpoilerImage:F}=e,{hideFurigana:B}=e,{furiganaStyle:V}=e,{loadingState:T}=e,{bookmarkData:I}=e,{pageManager:_}=e,{bookmarkManager:z}=e,{exploredCharCount:b}=e,{bookCharCount:A}=e,{isBookmarkScreen:$=!1}=e,{avoidPageBreak:se=!0}=e,{pageColumns:ke}=e,{firstDimensionMargin:Ve}=e,{autoBookmark:Me=!1}=e,{customReadingPointRange:Se}=e,{showCustomReadingPoint:Ie}=e;const ze=wn();let de,ie,re,Te=[],J,ee,Ne,Ee=!1,De="",C=!0,L=0,He=!1,X,Be,be,Ae=!1;const dt=new nt,Ye=new nt,Ce=new gn(-1),pe=new nt,Je=new gn(0),Qe=new nt,ge=new nt,ut=Ce.pipe(Ke(m=>{var te;return((te=Te[m])==null?void 0:te.innerHTML)||""})),Ge=new nt;Hn(()=>{document.body.classList.remove(Ro),Ge.next(),Ge.complete()}),Zt([dt,Ye]).pipe(mn(1),zt(()=>ge.pipe(Wt(1))),ct(Ge)).subscribe(()=>{if(!re||!J)return;const m=re.getScrollPosByCharCount(L);m<0||J.scrollTo(m,!1)}),pe.pipe(ct(Ge)).subscribe(m=>{var te;re&&(t(34,Ie=!1),Kt((te=Se==null?void 0:Se.endContainer)==null?void 0:te.parentElement,"remove",1),t(29,Se=void 0),t(32,b=re.calcExploredCharCount(Se)),m&&(L=b,d&&bi(window)),I.then(Fe))}),Me&&pe.pipe(xt(3e3),ct(Ge)).subscribe(m=>{m&&ze("bookmark")}),ut.pipe(gi(),ct(Ge)).subscribe(()=>{t(19,Ee=!1)}),ut.pipe(ct(Ge)).subscribe(m=>{const te=(h,ft)=>{if(ft===0){h();return}requestAnimationFrame(()=>te(h,ft-1))};te(()=>{t(20,De=m)},2)}),Ot(()=>lt(document.body,"wheel",{passive:!0})).pipe($t(()=>!f&&!o),Va(50),ct(Ge)).subscribe(m=>{if(!r){let te=(m.deltaX<0?-1:1)*(u?-1:1);m.deltaX||(te=m.deltaY<0?-1:1),J==null||J.flipPage(te)}});function pt(m){re&&(t(32,b=re.calcExploredCharCount(m)),L=b,je(m))}function je(m){!J||!re||J.updateSectionDataByOffset(re.getOffsetToRange(m,i))}function Ze(){if(C){C=!1;return}if(!de)return;t(40,re=new bl(de,Te,Je,()=>y,()=>w,()=>Vt,u,de,document)),t(32,b=0),L=0,t(33,A=re.charCount);let m=!1;try{m=document.fonts.check(`${N}px ${R||"Noto Serif JP"}`)}catch(te){mt.error(`Error checking Font Load: ${te.message}`),m=!0}if(m)Xe();else if(!Ae){Ae=!0;const te=fi(R,s)?3e4:1e4,h=setTimeout(()=>{mt.error(`Error loading primary Font: ${R}`),Xe()},te);document.fonts.addEventListener("loadingdone",()=>{clearTimeout(h),Xe()})}}function Xe(){re&&(re.updateCurrentSection(Ce.getValue()),ze("contentChange",de))}function gt(m){m.updateParagraphPos(),t(32,b=m.calcExploredCharCount(Se)),ge.next(m),I.then(Fe),Ne&&(Ne=!1,I.then(te=>{!te||!z||(t(32,b=te.exploredCharCount||0),z.scrollToBookmark(te))})),t(19,Ee=!0)}function Fe(m){const te=m==null?void 0:m.exploredCharCount;if(!re||!te)return;const h=re.checkBookmarkOnScreen(te);if(de&&h.isBookmarkScreen){const ft=Number(getComputedStyle(de)[u?"marginTop":"marginRight"].replace(/px$/,""));h.bookmarkPos?u?(t(21,X=ft?`${ft}px`:"0.5rem"),t(22,Be=`${h.bookmarkPos.left}px`),t(23,be=void 0)):(t(21,X=`${h.bookmarkPos.top}px`),t(23,be=void 0),t(22,Be=h.bookmarkPos.left>0?`calc(${h.bookmarkPos.left}px - ${l?"15":"20"}px)`:`calc(${Math.max(l?15:20,ft)}px)`)):kt(ft)}else kt(0);h.isBookmarkScreen&&m.exploredCharCount&&(h.node&&!He&&!h.isFirstNode?je(Jn(h.node)):h.isFirstNode&&je(void 0),t(32,b=He?b:m.exploredCharCount),L=b,He=!0),t(0,$=h.isBookmarkScreen)}function kt(m){u?(t(21,X=m?`${m}px`:"0.5rem"),t(22,Be=a?`${y-a}px`:void 0),t(23,be=a?void 0:"0.75rem")):(t(21,X=a?`${a}px`:"0.5rem"),t(22,Be=m?`calc(${m}px + 0.75rem)`:"0.75rem"),t(23,be=void 0))}function P(m){if(!J||r||o||m.detail.direction!=="left"&&m.detail.direction!=="right")return;const te=m.detail.direction==="left",h=u?!te:te;J.flipPage(h?1:-1)}function ue(m){if(!(!J||r||o))switch(m.code){case"ArrowLeft":J[u?"nextPage":"prevPage"]();break;case"ArrowRight":J[u?"prevPage":"nextPage"]();break;case"ArrowUp":J.prevPage();break;case"ArrowDown":J.nextPage();break}}rn.pipe(ct(Ge)).subscribe(m=>{const te=Te.findIndex(h=>h.id===m||h.querySelector(`[id="${m}"]`));te>-1&&(Ce.next(te),J==null||J.scrollTo(0,!0))});function We(m){ne[m?"unshift":"push"](()=>{ie=m,t(18,ie)})}function Oe(m){ne[m?"unshift":"push"](()=>{de=m,t(17,de)})}return n.$$set=m=>{"htmlContent"in m&&t(35,p=m.htmlContent),"width"in m&&t(1,y=m.width),"height"in m&&t(2,w=m.height),"verticalMode"in m&&t(3,u=m.verticalMode),"fontColor"in m&&t(4,k=m.fontColor),"backgroundColor"in m&&t(5,g=m.backgroundColor),"hintFuriganaFontColor"in m&&t(6,D=m.hintFuriganaFontColor),"hintFuriganaShadowColor"in m&&t(7,O=m.hintFuriganaShadowColor),"fontFamilyGroupOne"in m&&t(8,R=m.fontFamilyGroupOne),"fontFamilyGroupTwo"in m&&t(9,v=m.fontFamilyGroupTwo),"fontSize"in m&&t(10,N=m.fontSize),"lineHeight"in m&&t(11,K=m.lineHeight),"hideSpoilerImage"in m&&t(12,F=m.hideSpoilerImage),"hideFurigana"in m&&t(13,B=m.hideFurigana),"furiganaStyle"in m&&t(14,V=m.furiganaStyle),"loadingState"in m&&t(36,T=m.loadingState),"bookmarkData"in m&&t(37,I=m.bookmarkData),"pageManager"in m&&t(30,_=m.pageManager),"bookmarkManager"in m&&t(31,z=m.bookmarkManager),"exploredCharCount"in m&&t(32,b=m.exploredCharCount),"bookCharCount"in m&&t(33,A=m.bookCharCount),"isBookmarkScreen"in m&&t(0,$=m.isBookmarkScreen),"avoidPageBreak"in m&&t(15,se=m.avoidPageBreak),"pageColumns"in m&&t(38,ke=m.pageColumns),"firstDimensionMargin"in m&&t(16,Ve=m.firstDimensionMargin),"autoBookmark"in m&&t(39,Me=m.autoBookmark),"customReadingPointRange"in m&&t(29,Se=m.customReadingPointRange),"showCustomReadingPoint"in m&&t(34,Ie=m.showCustomReadingPoint)},n.$$.update=()=>{if(n.$$.dirty[1]&64&&I.then(m=>{He=!1,Fe(m)}),n.$$.dirty[0]&2&&y&&dt.next(y),n.$$.dirty[0]&4&&w&&Ye.next(w),n.$$.dirty[0]&10|n.$$.dirty[1]&128&&t(24,i=u?1:ke||Math.ceil(y/1e3)),n.$$.dirty[1]&16&&p&&(Ne=!0),n.$$.dirty[1]&16){const m=document.createElement("div");m.innerHTML=p,t(41,Te=Array.from(m.children)),Ce.next(0)}if(n.$$.dirty[0]&393230|n.$$.dirty[1]&3072&&ie&&de&&Te&&(t(42,J=new kl(ie,de,Te,Ce,Je,y,w,Vt,u,pe,Qe)),t(30,_=J)),n.$$.dirty[0]&6|n.$$.dirty[1]&544&&re&&y&&w&&!T){const m=re;requestAnimationFrame(()=>{gt(m)})}n.$$.dirty[1]&544&&re&&!T&&Qe.next(Ce.getValue()),n.$$.dirty[1]&6656&&re&&J&&(t(43,ee=new pl(re,J,ge,Ce,m=>L=m)),t(31,z=ee)),n.$$.dirty[0]&536870912&&pt(Se)},document.body.classList.add(Ro),[$,y,w,u,k,g,D,O,R,v,N,K,F,B,V,se,Ve,de,ie,Ee,De,X,Be,be,i,S,Ze,P,ue,Se,_,z,b,A,Ie,p,T,I,ke,Me,re,Te,J,ee,We,Oe]}class Sl extends Et{constructor(e){super(),Dt(this,e,wl,_l,Ft,{htmlContent:35,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,fontSize:10,lineHeight:11,hideSpoilerImage:12,hideFurigana:13,furiganaStyle:14,loadingState:36,bookmarkData:37,pageManager:30,bookmarkManager:31,exploredCharCount:32,bookCharCount:33,isBookmarkScreen:0,avoidPageBreak:15,pageColumns:38,firstDimensionMargin:16,autoBookmark:39,customReadingPointRange:29,showCustomReadingPoint:34},null,[-1,-1,-1])}}function Pl(n){let e,t,i,o,r,a,l,s,f,d;function S(R){n[59](R)}function p(R){n[60](R)}function y(R){n[61](R)}function w(R){n[62](R)}function u(R){n[63](R)}function k(R){n[64](R)}function g(R){n[65](R)}function D(R){n[66](R)}let O={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],loadingState:n[37]??!0,avoidPageBreak:n[29],pageColumns:n[30],autoBookmark:n[31],firstDimensionMargin:n[27]};return n[0]!==void 0&&(O.exploredCharCount=n[0]),n[1]!==void 0&&(O.bookCharCount=n[1]),n[6]!==void 0&&(O.isBookmarkScreen=n[6]),n[2]!==void 0&&(O.bookmarkData=n[2]),n[4]!==void 0&&(O.bookmarkManager=n[4]),n[5]!==void 0&&(O.pageManager=n[5]),n[11]!==void 0&&(O.customReadingPointRange=n[11]),n[12]!==void 0&&(O.showCustomReadingPoint=n[12]),e=new Sl({props:O}),ne.push(()=>ce(e,"exploredCharCount",S)),ne.push(()=>ce(e,"bookCharCount",p)),ne.push(()=>ce(e,"isBookmarkScreen",y)),ne.push(()=>ce(e,"bookmarkData",w)),ne.push(()=>ce(e,"bookmarkManager",u)),ne.push(()=>ce(e,"pageManager",k)),ne.push(()=>ce(e,"customReadingPointRange",g)),ne.push(()=>ce(e,"showCustomReadingPoint",D)),e.$on("contentChange",n[67]),e.$on("bookmark",n[68]),{c(){Pe(e.$$.fragment)},l(R){ve(e.$$.fragment,R)},m(R,v){ye(e,R,v),d=!0},p(R,v){const N={};v[0]&8192&&(N.htmlContent=R[13]),v[1]&16&&(N.width=R[35]??0),v[1]&32&&(N.height=R[36]??0),v[0]&16384&&(N.verticalMode=R[14]),v[0]&32768&&(N.fontColor=R[15]),v[0]&65536&&(N.backgroundColor=R[16]),v[0]&131072&&(N.hintFuriganaFontColor=R[17]),v[0]&262144&&(N.hintFuriganaShadowColor=R[18]),v[0]&524288&&(N.fontFamilyGroupOne=R[19]),v[0]&1048576&&(N.fontFamilyGroupTwo=R[20]),v[0]&2097152&&(N.fontSize=R[21]),v[0]&4194304&&(N.lineHeight=R[22]),v[0]&8388608&&(N.hideSpoilerImage=R[23]),v[0]&16777216&&(N.hideFurigana=R[24]),v[0]&33554432&&(N.furiganaStyle=R[25]),v[1]&64&&(N.loadingState=R[37]??!0),v[0]&536870912&&(N.avoidPageBreak=R[29]),v[0]&1073741824&&(N.pageColumns=R[30]),v[1]&1&&(N.autoBookmark=R[31]),v[0]&134217728&&(N.firstDimensionMargin=R[27]),!t&&v[0]&1&&(t=!0,N.exploredCharCount=R[0],he(()=>t=!1)),!i&&v[0]&2&&(i=!0,N.bookCharCount=R[1],he(()=>i=!1)),!o&&v[0]&64&&(o=!0,N.isBookmarkScreen=R[6],he(()=>o=!1)),!r&&v[0]&4&&(r=!0,N.bookmarkData=R[2],he(()=>r=!1)),!a&&v[0]&16&&(a=!0,N.bookmarkManager=R[4],he(()=>a=!1)),!l&&v[0]&32&&(l=!0,N.pageManager=R[5],he(()=>l=!1)),!s&&v[0]&2048&&(s=!0,N.customReadingPointRange=R[11],he(()=>s=!1)),!f&&v[0]&4096&&(f=!0,N.showCustomReadingPoint=R[12],he(()=>f=!1)),e.$set(N)},i(R){d||(j(e.$$.fragment,R),d=!0)},o(R){Y(e.$$.fragment,R),d=!1},d(R){Re(e,R)}}}function vl(n){let e,t,i,o,r,a,l,s,f,d,S,p;function y(F){n[47](F)}function w(F){n[48](F)}function u(F){n[49](F)}function k(F){n[50](F)}function g(F){n[51](F)}function D(F){n[52](F)}function O(F){n[53](F)}function R(F){n[54](F)}function v(F){n[55](F)}function N(F){n[56](F)}let K={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],secondDimensionMaxValue:n[26],firstDimensionMargin:n[27],autoPositionOnResize:n[28],autoBookmark:n[31],multiplier:n[33],loadingState:n[37]??!0};return n[0]!==void 0&&(K.exploredCharCount=n[0]),n[1]!==void 0&&(K.bookCharCount=n[1]),n[2]!==void 0&&(K.bookmarkData=n[2]),n[3]!==void 0&&(K.autoScroller=n[3]),n[4]!==void 0&&(K.bookmarkManager=n[4]),n[5]!==void 0&&(K.pageManager=n[5]),n[7]!==void 0&&(K.customReadingPoint=n[7]),n[8]!==void 0&&(K.customReadingPointTop=n[8]),n[9]!==void 0&&(K.customReadingPointLeft=n[9]),n[10]!==void 0&&(K.customReadingPointScrollOffset=n[10]),e=new ol({props:K}),ne.push(()=>ce(e,"exploredCharCount",y)),ne.push(()=>ce(e,"bookCharCount",w)),ne.push(()=>ce(e,"bookmarkData",u)),ne.push(()=>ce(e,"autoScroller",k)),ne.push(()=>ce(e,"bookmarkManager",g)),ne.push(()=>ce(e,"pageManager",D)),ne.push(()=>ce(e,"customReadingPoint",O)),ne.push(()=>ce(e,"customReadingPointTop",R)),ne.push(()=>ce(e,"customReadingPointLeft",v)),ne.push(()=>ce(e,"customReadingPointScrollOffset",N)),e.$on("contentChange",n[57]),e.$on("bookmark",n[58]),{c(){Pe(e.$$.fragment)},l(F){ve(e.$$.fragment,F)},m(F,B){ye(e,F,B),p=!0},p(F,B){const V={};B[0]&8192&&(V.htmlContent=F[13]),B[1]&16&&(V.width=F[35]??0),B[1]&32&&(V.height=F[36]??0),B[0]&16384&&(V.verticalMode=F[14]),B[0]&32768&&(V.fontColor=F[15]),B[0]&65536&&(V.backgroundColor=F[16]),B[0]&131072&&(V.hintFuriganaFontColor=F[17]),B[0]&262144&&(V.hintFuriganaShadowColor=F[18]),B[0]&524288&&(V.fontFamilyGroupOne=F[19]),B[0]&1048576&&(V.fontFamilyGroupTwo=F[20]),B[0]&2097152&&(V.fontSize=F[21]),B[0]&4194304&&(V.lineHeight=F[22]),B[0]&8388608&&(V.hideSpoilerImage=F[23]),B[0]&16777216&&(V.hideFurigana=F[24]),B[0]&33554432&&(V.furiganaStyle=F[25]),B[0]&67108864&&(V.secondDimensionMaxValue=F[26]),B[0]&134217728&&(V.firstDimensionMargin=F[27]),B[0]&268435456&&(V.autoPositionOnResize=F[28]),B[1]&1&&(V.autoBookmark=F[31]),B[1]&4&&(V.multiplier=F[33]),B[1]&64&&(V.loadingState=F[37]??!0),!t&&B[0]&1&&(t=!0,V.exploredCharCount=F[0],he(()=>t=!1)),!i&&B[0]&2&&(i=!0,V.bookCharCount=F[1],he(()=>i=!1)),!o&&B[0]&4&&(o=!0,V.bookmarkData=F[2],he(()=>o=!1)),!r&&B[0]&8&&(r=!0,V.autoScroller=F[3],he(()=>r=!1)),!a&&B[0]&16&&(a=!0,V.bookmarkManager=F[4],he(()=>a=!1)),!l&&B[0]&32&&(l=!0,V.pageManager=F[5],he(()=>l=!1)),!s&&B[0]&128&&(s=!0,V.customReadingPoint=F[7],he(()=>s=!1)),!f&&B[0]&256&&(f=!0,V.customReadingPointTop=F[8],he(()=>f=!1)),!d&&B[0]&512&&(d=!0,V.customReadingPointLeft=F[9],he(()=>d=!1)),!S&&B[0]&1024&&(S=!0,V.customReadingPointScrollOffset=F[10],he(()=>S=!1)),e.$set(V)},i(F){p||(j(e.$$.fragment,F),p=!0)},o(F){Y(e.$$.fragment,F),p=!1},d(F){Re(e,F)}}}function yl(n){let e,t,i,o,r=(n[38]??"")+"",a,l;const s=[vl,Pl],f=[];function d(S,p){return S[32]===Tt.Continuous?0:1}return t=d(n),i=f[t]=s[t](n),{c(){e=Q("div"),i.c(),o=ae(),a=_e(r),this.h()},l(S){e=Z(S,"DIV",{class:!0});var p=x(e);i.l(p),p.forEach(E),o=le(S),a=we(S,r),this.h()},h(){U(e,"class",il+" py-8")},m(S,p){G(S,e,p),f[t].m(e,null),n[69](e),G(S,o,p),G(S,a,p),l=!0},p(S,p){let y=t;t=d(S),t===y?f[t].p(S,p):(rt(),Y(f[y],1,1,()=>{f[y]=null}),at(),i=f[t],i?i.p(S,p):(i=f[t]=s[t](S),i.c()),j(i,1),i.m(e,null)),(!l||p[1]&128)&&r!==(r=(S[38]??"")+"")&&Ue(a,r)},i(S){l||(j(i),l=!0)},o(S){Y(i),l=!1},d(S){S&&E(e),f[t].d(),n[69](null),S&&E(o),S&&E(a)}}}function fn(n){return Number(n.replace(/px$/,""))}function Rl(n,e,t){let i,o,r,a,l,s,{htmlContent:f}=e,{width:d}=e,{height:S}=e,{verticalMode:p}=e,{fontColor:y}=e,{backgroundColor:w}=e,{hintFuriganaFontColor:u}=e,{hintFuriganaShadowColor:k}=e,{fontFamilyGroupOne:g}=e,{fontFamilyGroupTwo:D}=e,{fontSize:O}=e,{lineHeight:R}=e,{hideSpoilerImage:v}=e,{hideFurigana:N}=e,{furiganaStyle:K}=e,{secondDimensionMaxValue:F}=e,{firstDimensionMargin:B}=e,{autoPositionOnResize:V}=e,{avoidPageBreak:T}=e,{pageColumns:I}=e,{autoBookmark:_}=e,{viewMode:z}=e,{exploredCharCount:b}=e,{bookCharCount:A}=e,{multiplier:$}=e,{bookmarkData:se}=e,{autoScroller:ke}=e,{bookmarkManager:Ve}=e,{pageManager:Me}=e,{isBookmarkScreen:Se}=e,{customReadingPoint:Ie}=e,{customReadingPointTop:ze}=e,{customReadingPointLeft:de}=e,{customReadingPointScrollOffset:ie}=e,{customReadingPointRange:re}=e,{showCustomReadingPoint:Te}=e;const J=new nt,ee=new nt,Ne=Cr(null);W(n,Ne,h=>t(34,o=h));const Ee=Zt([Ne.pipe($t(h=>!!h)),Zt([J,ee]).pipe(On(0))]).pipe(xt(0,Pn),Ke(([h])=>getComputedStyle(h)),Ln({refCount:!0,bufferSize:1})),De=new _r(1),C=Ee.pipe(Ke(h=>Be(d-fn(h.paddingLeft)-fn(h.paddingRight))));W(n,C,h=>t(35,r=h));const L=Ee.pipe(Ke(h=>be(S-fn(h.paddingTop)-fn(h.paddingBottom)-i)));W(n,L,h=>t(36,a=h));const He=Ot(()=>Un(document)).pipe(hn(h=>{const ft=ll(h,K);return De.pipe(hn(an=>ft(an)))}),Mt());W(n,He,h=>t(38,s=h));const X=De.pipe(hn(h=>rl(h)),Vn());W(n,X,h=>t(37,l=h));function Be(h){return Tt.Paginated===z&&!p&&F?Math.min(F,h):h}function be(h){return Tt.Paginated===z&&p&&F?Math.min(F,h):h}function Ae(h){b=h,t(0,b)}function dt(h){A=h,t(1,A)}function Ye(h){se=h,t(2,se)}function Ce(h){ke=h,t(3,ke)}function pe(h){Ve=h,t(4,Ve)}function Je(h){Me=h,t(5,Me)}function Qe(h){Ie=h,t(7,Ie)}function ge(h){ze=h,t(8,ze)}function ut(h){de=h,t(9,de)}function Ge(h){ie=h,t(10,ie)}const pt=h=>De.next(h.detail);function je(h){ao.call(this,n,h)}function Ze(h){b=h,t(0,b)}function Xe(h){A=h,t(1,A)}function gt(h){Se=h,t(6,Se)}function Fe(h){se=h,t(2,se)}function kt(h){Ve=h,t(4,Ve)}function P(h){Me=h,t(5,Me)}function ue(h){re=h,t(11,re)}function We(h){Te=h,t(12,Te)}const Oe=h=>De.next(h.detail);function m(h){ao.call(this,n,h)}function te(h){ne[h?"unshift":"push"](()=>{o=h,Ne.set(o)})}return n.$$set=h=>{"htmlContent"in h&&t(13,f=h.htmlContent),"width"in h&&t(45,d=h.width),"height"in h&&t(46,S=h.height),"verticalMode"in h&&t(14,p=h.verticalMode),"fontColor"in h&&t(15,y=h.fontColor),"backgroundColor"in h&&t(16,w=h.backgroundColor),"hintFuriganaFontColor"in h&&t(17,u=h.hintFuriganaFontColor),"hintFuriganaShadowColor"in h&&t(18,k=h.hintFuriganaShadowColor),"fontFamilyGroupOne"in h&&t(19,g=h.fontFamilyGroupOne),"fontFamilyGroupTwo"in h&&t(20,D=h.fontFamilyGroupTwo),"fontSize"in h&&t(21,O=h.fontSize),"lineHeight"in h&&t(22,R=h.lineHeight),"hideSpoilerImage"in h&&t(23,v=h.hideSpoilerImage),"hideFurigana"in h&&t(24,N=h.hideFurigana),"furiganaStyle"in h&&t(25,K=h.furiganaStyle),"secondDimensionMaxValue"in h&&t(26,F=h.secondDimensionMaxValue),"firstDimensionMargin"in h&&t(27,B=h.firstDimensionMargin),"autoPositionOnResize"in h&&t(28,V=h.autoPositionOnResize),"avoidPageBreak"in h&&t(29,T=h.avoidPageBreak),"pageColumns"in h&&t(30,I=h.pageColumns),"autoBookmark"in h&&t(31,_=h.autoBookmark),"viewMode"in h&&t(32,z=h.viewMode),"exploredCharCount"in h&&t(0,b=h.exploredCharCount),"bookCharCount"in h&&t(1,A=h.bookCharCount),"multiplier"in h&&t(33,$=h.multiplier),"bookmarkData"in h&&t(2,se=h.bookmarkData),"autoScroller"in h&&t(3,ke=h.autoScroller),"bookmarkManager"in h&&t(4,Ve=h.bookmarkManager),"pageManager"in h&&t(5,Me=h.pageManager),"isBookmarkScreen"in h&&t(6,Se=h.isBookmarkScreen),"customReadingPoint"in h&&t(7,Ie=h.customReadingPoint),"customReadingPointTop"in h&&t(8,ze=h.customReadingPointTop),"customReadingPointLeft"in h&&t(9,de=h.customReadingPointLeft),"customReadingPointScrollOffset"in h&&t(10,ie=h.customReadingPointScrollOffset),"customReadingPointRange"in h&&t(11,re=h.customReadingPointRange),"showCustomReadingPoint"in h&&t(12,Te=h.showCustomReadingPoint)},n.$$.update=()=>{n.$$.dirty[0]&134234112|n.$$.dirty[1]&2&&(i=B&&Tt.Paginated===z&&!p?B*2:0),n.$$.dirty[1]&16384&&J.next(d),n.$$.dirty[1]&32768&&ee.next(S)},[b,A,se,ke,Ve,Me,Se,Ie,ze,de,ie,re,Te,f,p,y,w,u,k,g,D,O,R,v,N,K,F,B,V,T,I,_,z,$,o,r,a,l,s,Ne,De,C,L,He,X,d,S,Ae,dt,Ye,Ce,pe,Je,Qe,ge,ut,Ge,pt,je,Ze,Xe,gt,Fe,kt,P,ue,We,Oe,m,te]}class Ml extends Et{constructor(e){super(),Dt(this,e,Rl,yl,Ft,{htmlContent:13,width:45,height:46,verticalMode:14,fontColor:15,backgroundColor:16,hintFuriganaFontColor:17,hintFuriganaShadowColor:18,fontFamilyGroupOne:19,fontFamilyGroupTwo:20,fontSize:21,lineHeight:22,hideSpoilerImage:23,hideFurigana:24,furiganaStyle:25,secondDimensionMaxValue:26,firstDimensionMargin:27,autoPositionOnResize:28,avoidPageBreak:29,pageColumns:30,autoBookmark:31,viewMode:32,exploredCharCount:0,bookCharCount:1,multiplier:33,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6,customReadingPoint:7,customReadingPointTop:8,customReadingPointLeft:9,customReadingPointScrollOffset:10,customReadingPointRange:11,showCustomReadingPoint:12},null,[-1,-1,-1])}}function El(n,e){const t=document.createTextNode(e);if(n.firstChild){n.replaceChild(t,n.firstChild);return}n.appendChild(t)}function Dl(n,e,t){let{styleSheet:i}=e,o;return Jo(()=>{t(1,o=document.createElement("style")),document.head.appendChild(o)}),Hn(()=>{o&&document.head.removeChild(o)}),n.$$set=r=>{"styleSheet"in r&&t(0,i=r.styleSheet)},n.$$.update=()=>{n.$$.dirty&3&&o&&El(o,i)},[i,o]}class Fl extends Et{constructor(e){super(),Dt(this,e,Dl,null,Ft,{styleSheet:0})}}function Mo(n,e,t){const i=n.slice();return i[18]=e[t],i}function Eo(n){let e,t,i,o,r;return t=new st({props:{icon:ea}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(a){e=Z(a,"DIV",{role:!0,class:!0});var l=x(e);ve(t.$$.fragment,l),l.forEach(E),this.h()},h(){U(e,"role","button"),U(e,"class",qn)},m(a,l){G(a,e,l),ye(t,e,null),i=!0,o||(r=[me(e,"click",n[13]),me(e,"keyup",wt)],o=!0)},p:Bt,i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&E(e),Re(t),o=!1,St(r)}}}function Do(n){let e,t,i;return{c(){e=Q("div"),t=_e(n[1]),i=_e("x"),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);t=we(r,n[1]),i=we(r,"x"),r.forEach(E),this.h()},h(){U(e,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg")},m(o,r){G(o,e,r),oe(e,t),oe(e,i)},p(o,r){r&2&&Ue(t,o[1])},d(o){o&&E(e)}}}function Fo(n){let e,t,i,o={placement:"bottom",fallbackPlacements:["bottom-end","bottom-start"],yOffset:0,$$slots:{content:[Bl],icon:[Tl]},$$scope:{ctx:n}};return t=new ca({props:o}),n[16](t),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(r){e=Z(r,"DIV",{class:!0});var a=x(e);ve(t.$$.fragment,a),a.forEach(E),this.h()},h(){U(e,"class","flex")},m(r,a){G(r,e,a),ye(t,e,null),i=!0},p(r,a){const l={};a&2097152&&(l.$$scope={dirty:a,ctx:r}),t.$set(l)},i(r){i||(j(t.$$.fragment,r),i=!0)},o(r){Y(t.$$.fragment,r),i=!1},d(r){r&&E(e),n[16](null),Re(t)}}}function Tl(n){let e,t,i;return t=new st({props:{icon:ta}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{slot:!0,class:!0});var r=x(e);ve(t.$$.fragment,r),r.forEach(E),this.h()},h(){U(e,"slot","icon"),U(e,"class",qn)},m(o,r){G(o,e,r),ye(t,e,null),i=!0},p:Bt,i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&E(e),Re(t)}}}function To(n,e){let t,i=e[18].label+"",o,r,a,l;function s(){return e[15](e[18])}return{key:n,first:null,c(){t=Q("div"),o=_e(i),r=ae(),this.h()},l(f){t=Z(f,"DIV",{role:!0,class:!0});var d=x(t);o=we(d,i),r=le(d),d.forEach(E),this.h()},h(){U(t,"role","button"),U(t,"class","px-4 py-2 text-sm hover:bg-white hover:text-gray-700"),this.first=t},m(f,d){G(f,t,d),oe(t,o),oe(t,r),a||(l=[me(t,"click",s),me(t,"keyup",wt)],a=!0)},p(f,d){e=f},d(f){f&&E(t),a=!1,St(l)}}}function Bl(n){let e,t=[],i=new Map,o=n[9];const r=a=>a[18].label;for(let a=0;a<o.length;a+=1){let l=Mo(n,o,a),s=r(l);i.set(s,t[a]=To(s,l))}return{c(){e=Q("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=Z(a,"DIV",{class:!0,slot:!0});var l=x(e);for(let s=0;s<t.length;s+=1)t[s].l(l);l.forEach(E),this.h()},h(){U(e,"class","w-40 bg-gray-700 md:w-32"),U(e,"slot","content")},m(a,l){G(a,e,l);for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(e,null)},p(a,l){l&1536&&(o=a[9],t=Qo(t,l,r,1,a,o,i,e,Zo,To,null,Mo))},d(a){a&&E(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Il(n){let e,t,i,o,r,a,l,s,f,d,S,p,y,w=n[0]&&Eo(n);r=new st({props:{icon:n[2]?Jt:mo}});let u=!n[5]&&Do(n),k=(n[6]||n[7]===Tt.Paginated)&&Fo(n);return d=new fa({props:{disableRouteNavigation:!0,items:n[4]?[qe.SETTINGS,qe.DOMAIN_HINT,qe.MANAGE]:[qe.SETTINGS,qe.MANAGE]}}),d.$on("action",n[17]),{c(){e=Q("div"),t=Q("div"),w&&w.c(),i=ae(),o=Q("div"),Pe(r.$$.fragment),a=ae(),u&&u.c(),l=ae(),s=Q("div"),k&&k.c(),f=ae(),Pe(d.$$.fragment),this.h()},l(g){e=Z(g,"DIV",{class:!0});var D=x(e);t=Z(D,"DIV",{class:!0});var O=x(t);w&&w.l(O),i=le(O),o=Z(O,"DIV",{role:!0,class:!0});var R=x(o);ve(r.$$.fragment,R),R.forEach(E),a=le(O),u&&u.l(O),O.forEach(E),l=le(D),s=Z(D,"DIV",{class:!0});var v=x(s);k&&k.l(v),f=le(v),ve(d.$$.fragment,v),v.forEach(E),D.forEach(E),this.h()},h(){U(o,"role","button"),U(o,"class",qn),U(t,"class","flex transform-gpu "+wr),U(s,"class","flex transform-gpu "+Sr),U(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+Pr)},m(g,D){G(g,e,D),oe(e,t),w&&w.m(t,null),oe(t,i),oe(t,o),ye(r,o,null),oe(t,a),u&&u.m(t,null),oe(e,l),oe(e,s),k&&k.m(s,null),oe(s,f),ye(d,s,null),S=!0,p||(y=[me(o,"click",n[14]),me(o,"keyup",wt)],p=!0)},p(g,[D]){g[0]?w?(w.p(g,D),D&1&&j(w,1)):(w=Eo(g),w.c(),j(w,1),w.m(t,i)):w&&(rt(),Y(w,1,1,()=>{w=null}),at());const O={};D&4&&(O.icon=g[2]?Jt:mo),r.$set(O),g[5]?u&&(u.d(1),u=null):u?u.p(g,D):(u=Do(g),u.c(),u.m(t,null)),g[6]||g[7]===Tt.Paginated?k?(k.p(g,D),D&192&&j(k,1)):(k=Fo(g),k.c(),j(k,1),k.m(s,f)):k&&(rt(),Y(k,1,1,()=>{k=null}),at());const R={};D&16&&(R.items=g[4]?[qe.SETTINGS,qe.DOMAIN_HINT,qe.MANAGE]:[qe.SETTINGS,qe.MANAGE]),d.$set(R)},i(g){S||(j(w),j(r.$$.fragment,g),j(k),j(d.$$.fragment,g),S=!0)},o(g){Y(w),Y(r.$$.fragment,g),Y(k),Y(d.$$.fragment,g),S=!1},d(g){g&&E(e),w&&w.d(),Re(r),u&&u.d(),k&&k.d(),Re(d),p=!1,St(y)}}}function Al(n,e,t){let i,o,r,a;W(n,Xn,v=>t(5,o=v)),W(n,jn,v=>t(6,r=v)),W(n,li,v=>t(7,a=v));let{hasChapterData:l}=e,{autoScrollMultiplier:s}=e,{hasCustomReadingPoint:f}=e,{showFullscreenButton:d}=e,{isBookmarkScreen:S}=e;const p=wn(),y=[...f?[{label:"Show Point",action:"showCustomReadingPoint"}]:[],{label:"Set Point",action:"setCustomReadingPoint"},...f?[{label:"Reset Point",action:"resetCustomReadingPoint"}]:[]];let w;function u(v){p(v),w.toggleOpen()}const k=()=>p("tocClick"),g=()=>p("bookmarkClick"),D=v=>u(v.action);function O(v){ne[v?"unshift":"push"](()=>{w=v,t(3,w)})}const R=({detail:v})=>{v===qe.SETTINGS.label?p("settingsClick"):v===qe.DOMAIN_HINT.label?p("domainHintClick"):v===qe.MANAGE.label&&p("bookManagerClick")};return n.$$set=v=>{"hasChapterData"in v&&t(0,l=v.hasChapterData),"autoScrollMultiplier"in v&&t(1,s=v.autoScrollMultiplier),"hasCustomReadingPoint"in v&&t(11,f=v.hasCustomReadingPoint),"showFullscreenButton"in v&&t(12,d=v.showFullscreenButton),"isBookmarkScreen"in v&&t(2,S=v.isBookmarkScreen)},i=vr(window),[l,s,S,w,i,o,r,a,p,y,u,f,d,k,g,D,O,R]}class Ol extends Et{constructor(e){super(),Dt(this,e,Al,Il,Ft,{hasChapterData:0,autoScrollMultiplier:1,hasCustomReadingPoint:11,showFullscreenButton:12,isBookmarkScreen:2})}}function Bo(n,e,t){const i=n.slice();return i[16]=e[t],i}function Io(n,e){let t,i,o=e[16].label+"",r,a,l,s,f=e[16].startCharacter+"",d,S,p,y;function w(){return e[13](e[16])}return{key:n,first:null,c(){t=Q("div"),i=Q("div"),r=_e(o),l=ae(),s=Q("div"),d=_e(f),S=ae(),this.h()},l(u){t=Z(u,"DIV",{class:!0});var k=x(t);i=Z(k,"DIV",{id:!0,class:!0});var g=x(i);r=we(g,o),g.forEach(E),l=le(k),s=Z(k,"DIV",{});var D=x(s);d=we(D,f),D.forEach(E),S=le(k),k.forEach(E),this.h()},h(){U(i,"id",a=`for${e[16].reference}`),U(i,"class","mr-4 cursor-pointer"),q(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),q(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),q(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),q(s,"opacity-30",e[16].progress===100&&e[16]!==e[2]),U(t,"class","my-6 flex justify-between"),this.first=t},m(u,k){G(u,t,k),oe(t,i),oe(i,r),oe(t,l),oe(t,s),oe(s,d),oe(t,S),p||(y=[me(i,"click",w),me(i,"keydown",wt)],p=!0)},p(u,k){e=u,k&2&&o!==(o=e[16].label+"")&&Ue(r,o),k&2&&a!==(a=`for${e[16].reference}`)&&U(i,"id",a),k&6&&q(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),k&6&&q(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),k&6&&q(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),k&2&&f!==(f=e[16].startCharacter+"")&&Ue(d,f),k&6&&q(s,"opacity-30",e[16].progress===100&&e[16]!==e[2])},d(u){u&&E(t),p=!1,St(y)}}}function Ll(n){let e,t,i,o,r,a,l,s,f,d,S,p,y=[],w=new Map,u,k,g,D,O,R,v,N,K,F;d=new st({props:{icon:na}});let B=n[1];const V=T=>T[16].reference;for(let T=0;T<B.length;T+=1){let I=Bo(n,B,T),_=V(I);w.set(_,y[T]=Io(_,I))}return D=new st({props:{icon:oa}}),v=new st({props:{icon:ia}}),{c(){e=Q("div"),t=Q("div"),i=_e("Chapter Progress: "),o=_e(n[3]),r=_e(" ("),a=_e(n[4]),l=_e("%)"),s=ae(),f=Q("div"),Pe(d.$$.fragment),S=ae(),p=Q("div");for(let T=0;T<y.length;T+=1)y[T].c();u=ae(),k=Q("div"),g=Q("div"),Pe(D.$$.fragment),O=ae(),R=Q("div"),Pe(v.$$.fragment),this.h()},l(T){e=Z(T,"DIV",{class:!0});var I=x(e);t=Z(I,"DIV",{});var _=x(t);i=we(_,"Chapter Progress: "),o=we(_,n[3]),r=we(_," ("),a=we(_,n[4]),l=we(_,"%)"),_.forEach(E),s=le(I),f=Z(I,"DIV",{class:!0});var z=x(f);ve(d.$$.fragment,z),z.forEach(E),I.forEach(E),S=le(T),p=Z(T,"DIV",{class:!0});var b=x(p);for(let ke=0;ke<y.length;ke+=1)y[ke].l(b);b.forEach(E),u=le(T),k=Z(T,"DIV",{class:!0});var A=x(k);g=Z(A,"DIV",{class:!0});var $=x(g);ve(D.$$.fragment,$),$.forEach(E),O=le(A),R=Z(A,"DIV",{class:!0});var se=x(R);ve(v.$$.fragment,se),se.forEach(E),A.forEach(E),this.h()},h(){U(f,"class","flex cursor-pointer items-end md:items-center"),U(e,"class","flex justify-between p-4"),U(p,"class","flex-1 overflow-auto p-4"),U(g,"class","cursor-pointer"),q(g,"opacity-30",!n[6]),U(R,"class","cursor-pointer"),q(R,"opacity-30",!n[5]),U(k,"class","flex justify-between px-4 py-6")},m(T,I){G(T,e,I),oe(e,t),oe(t,i),oe(t,o),oe(t,r),oe(t,a),oe(t,l),oe(e,s),oe(e,f),ye(d,f,null),G(T,S,I),G(T,p,I);for(let _=0;_<y.length;_+=1)y[_]&&y[_].m(p,null);G(T,u,I),G(T,k,I),oe(k,g),ye(D,g,null),oe(k,O),oe(k,R),ye(v,R,null),N=!0,K||(F=[me(f,"click",n[9]),me(f,"keydown",wt),me(g,"click",n[14]),me(g,"keydown",wt),me(R,"click",n[15]),me(R,"keydown",wt)],K=!0)},p(T,[I]){(!N||I&8)&&Ue(o,T[3]),(!N||I&16)&&Ue(a,T[4]),I&262&&(B=T[1],y=Qo(y,I,V,1,T,B,w,p,Zo,Io,null,Bo)),(!N||I&64)&&q(g,"opacity-30",!T[6]),(!N||I&32)&&q(R,"opacity-30",!T[5])},i(T){N||(j(d.$$.fragment,T),j(D.$$.fragment,T),j(v.$$.fragment,T),N=!0)},o(T){Y(d.$$.fragment,T),Y(D.$$.fragment,T),Y(v.$$.fragment,T),N=!1},d(T){T&&E(e),Re(d),T&&E(S),T&&E(p);for(let I=0;I<y.length;I+=1)y[I].d();T&&E(u),T&&E(k),Re(D),Re(v),K=!1,St(F)}}}function Vl(n,e){const[t,i]=e.reduce((o,r,a)=>(o[0]+=n[a]*r,o[1]+=r,o),[0,0]);return t/i}function Ao(n){n&&(n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView())}function zl(n,e,t){let i,o,{sectionData:r=[]}=e,{exploredCharCount:a=0}=e,{verticalMode:l}=e,s=[],f,d=-1,S="0/0",p="0.00";Jo(()=>{tt.dialogs$.next([{component:"<div/>"}]),f&&Ao(document.getElementById(`for${f.reference}`))});function y(O,R){if(O){const v=s[d+R];w(v.reference,!1)}}function w(O,R=!1){rn.next(O),R&&u()}function u(){Nt.next(!1),tt.dialogs$.next([])}const k=O=>w(O.reference,!0),g=()=>y(i,l?1:-1),D=()=>y(o,l?-1:1);return n.$$set=O=>{"sectionData"in O&&t(10,r=O.sectionData),"exploredCharCount"in O&&t(11,a=O.exploredCharCount),"verticalMode"in O&&t(0,l=O.verticalMode)},n.$$.update=()=>{if(n.$$.dirty&5120&&r){const[O,R,v]=pi(r),N=r.filter(K=>K.reference===v||K.parentChapter===v);t(4,p=Vl(N.map(K=>K.progress),N.map(K=>K.charactersWeight)).toFixed(2)),t(1,s=O),t(12,d=R),t(2,f=O[d])}if(n.$$.dirty&4099&&t(6,i=l?d<s.length-1:!!d),n.$$.dirty&4099&&t(5,o=l?!!d:d<s.length-1),n.$$.dirty&2052&&f){Ao(document.getElementById(`for${f.reference}`));const O=f.characters;t(3,S=`${Math.min(Math.max(a-f.startCharacter,0),O)} / ${O}`)}},[l,s,f,S,p,o,i,y,w,u,r,a,d,k,g,D]}class Nl extends Et{constructor(e){super(),Dt(this,e,zl,Ll,Ft,{sectionData:10,exploredCharCount:11,verticalMode:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */class Hl{constructor(e){et(this,"fallbackSpec");this.fallbackSpec=Oo(e)}get fullscreenEnabled(){return this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled")??!1}get fullscreenElement(){return this.fallbackSpec("fullscreenElement","webkitFullscreenElement")??null}async requestFullscreen(e,t){const i=Oo(e)("requestFullscreen","webkitRequestFullscreen");i&&await i(t)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");e&&await e()}}function Oo(n){return(e,t)=>Lo(n,e)??Lo(n,t)}function Lo(n,e){const t=n[e];return typeof t=="function"?t.bind(n):t}const dn=new Hl(document);/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function Gl(n,e){return Wl(n).pipe(Ke(t=>{const i=e.createElement("div");return i.innerHTML=t,jl(i),Xl(i),ql(i,e),Kl(i),i.innerHTML}))}function Wl(n){return new vt(e=>{const{blobs:t}=n;let{elementHtml:i}=n;const o=[];return Object.entries(t).forEach(([r,a])=>{const l=URL.createObjectURL(a);o.push(l),i=i.replaceAll(yr(r),l).replaceAll(`ttu:${r}`,l)}),e.next(i),()=>{o.forEach(r=>URL.revokeObjectURL(r))}})}function jl(n){Array.from(n.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:si(e)})).forEach(({parentEl:e,isGaiji:t})=>{e==null||e.classList.add("ttu-img-container"),t||e==null||e.classList.add("ttu-illustration-container")})}function Xl(n){Array.from(n.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function ql(n,e){const t=()=>{let o=[...n.children];const r=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return r>0&&r<o.length&&(o=o.slice(r)),o},i=(o,r)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||r).insertBefore(a,o),a.appendChild(o)};t().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(r=>!si(r)).forEach(r=>i(r,o)),Array.from(o.getElementsByTagName("svg")).filter(r=>r.getElementsByTagName("image").length).forEach(r=>i(r,o))})}function Kl(n){n.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Ul=Pi;function Pi(n,e,t){n instanceof RegExp&&(n=Vo(n,t)),e instanceof RegExp&&(e=Vo(e,t));const i=vi(n,e,t);return i&&{start:i[0],end:i[1],pre:t.slice(0,i[0]),body:t.slice(i[0]+n.length,i[1]),post:t.slice(i[1]+e.length)}}function Vo(n,e){const t=e.match(n);return t?t[0]:null}Pi.range=vi;function vi(n,e,t){let i,o,r,a,l,s=t.indexOf(n),f=t.indexOf(e,s+1),d=s;if(s>=0&&f>0){if(n===e)return[s,f];for(i=[],r=t.length;d>=0&&!l;)d===s?(i.push(d),s=t.indexOf(n,d+1)):i.length===1?l=[i.pop(),f]:(o=i.pop(),o<r&&(r=o,a=f),f=t.indexOf(e,d+1)),d=s<f&&s>=0?s:f;i.length&&(l=[r,a])}return l}function Yl(n,e={}){const i=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function r(_){throw new Error(`CSS parse error: ${_}`)}function a(_){const z=_.exec(n);if(z)return n=n.slice(z[0].length),z}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function f(){a(/^\s*/)}function d(){if(f(),n[0]!=="/"||n[1]!=="*")return;let _=2;for(;n[_]&&(n[_]!=="*"||n[_+1]!=="/");)_++;if(!n[_])return r("end of comment is missing");const z=n.slice(2,_);return n=n.slice(_+2),{type:"comment",comment:z}}function S(){const _=[];let z;for(;z=d();)_.push(z);return i.removeComments?[]:_}function p(){for(f();n[0]==="}";)r("extra closing bracket");const _=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(_)return _[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(z){return z.replace(/,/g,"‌")}).split(/\s*(?![^(]*\)),\s*/).map(function(z){return z.replace(/\u200C/g,",")})}function y(){if(n[0]==="@")return V();a(/^([;\s]*)+/);const _=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let z=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!z)return;if(z=z[0].trim(),!a(/^:\s*/))return r("property missing ':'");const b=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),A={type:"declaration",property:z.replace(_,""),value:b?b[0].replace(_,"").trim():""};return a(/^[;\s]*/),A}function w(){if(!l())return r("missing '{'");let _,z=S();for(;_=y();)z.push(_),z=z.concat(S());return s()?z:r("missing '}'")}function u(){f();const _=[];let z;for(;z=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)_.push(z[1]),a(/^,\s*/);if(_.length)return{type:"keyframe",values:_,declarations:w()}}function k(){let _=a(/^@([-\w]+)?keyframes\s*/);if(!_)return;const z=_[1];if(_=a(/^([-\w]+)\s*/),!_)return r("@keyframes missing name");const b=_[1];if(!l())return r("@keyframes missing '{'");let A,$=S();for(;A=u();)$.push(A),$=$.concat(S());return s()?{type:"keyframes",name:b,vendor:z,keyframes:$}:r("@keyframes missing '}'")}function g(){if(a(/^@page */))return{type:"page",selectors:p()||[],declarations:w()}}function D(){const _=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(_)return{type:"page-margin-box",name:`${_[1]}-${_[2]}`+(_[3]?`-${_[3]}`:""),declarations:w()}}function O(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:w()}}function R(){const _=a(/^@supports *([^{]+)/);if(_)return{type:"supports",supports:_[1].trim(),rules:I()}}function v(){if(a(/^@host\s*/))return{type:"host",rules:I()}}function N(){const _=a(/^@media([^{]+)*/);if(_)return{type:"media",media:(_[1]||"").trim(),rules:I()}}function K(){const _=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(_)return{type:"custom-media",name:_[1].trim(),media:_[2].trim()}}function F(){const _=a(/^@([-\w]+)?document *([^{]+)/);if(_)return{type:"document",document:_[2].trim(),vendor:_[1]?_[1].trim():null,rules:I()}}function B(){const _=a(/^@(import|charset|namespace)\s*([^;]+);/);if(_)return{type:_[1],name:_[2].trim()}}function V(){if(f(),n[0]==="@"){const _=B()||O()||N()||k()||R()||F()||K()||v()||g()||D();if(_&&!i.preserveStatic){let z=!1;return _.declarations?z=_.declarations.some(b=>/var\(/.test(b.value)):z=(_.keyframes||_.rules||[]).some(A=>(A.declarations||[]).some($=>/var\(/.test($.value))),z?_:{}}return _}}function T(){if(!i.preserveStatic){const b=Ul("{","}",n);if(b){const A=/:(?:root|host)(?![.:#(])/.test(b.pre)&&/--\S*\s*:/.test(b.body),$=/var\(/.test(b.body);if(!A&&!$)return n=n.slice(b.end+1),{}}}const _=p()||[],z=i.preserveStatic?w():w().filter(b=>{const A=_.some(se=>/:(?:root|host)(?![.:#(])/.test(se))&&/^--\S/.test(b.property),$=/var\(/.test(b.value);return A||$});return _.length||r("selector missing"),{type:"rule",selectors:_,declarations:z}}function I(_){if(!_&&!l())return r("missing '{'");let z,b=S();for(;n.length&&(_||n[0]!=="}")&&(z=V()||T());)z.type&&b.push(z),b=b.concat(S());return!_&&!s()?r("missing '}'"):b}return{type:"stylesheet",stylesheet:{rules:I(!0),errors:o}}}function Jl(n,e="",t){const i={charset(r){return"@charset "+r.name+";"},comment(r){return r.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+r.comment+"*/":""},"custom-media"(r){return"@custom-media "+r.name+" "+r.media+";"},declaration(r){return r.property+":"+r.value+";"},document(r){return"@"+(r.vendor||"")+"document "+r.document+"{"+o(r.rules)+"}"},"font-face"(r){return"@font-face{"+o(r.declarations)+"}"},host(r){return"@host{"+o(r.rules)+"}"},import(r){return"@import "+r.name+";"},keyframe(r){return r.values.join(",")+"{"+o(r.declarations)+"}"},keyframes(r){return"@"+(r.vendor||"")+"keyframes "+r.name+"{"+o(r.keyframes)+"}"},media(r){return"@media "+r.media+"{"+o(r.rules)+"}"},namespace(r){return"@namespace "+r.name+";"},page(r){return"@page "+(r.selectors.length?r.selectors.join(", "):"")+"{"+o(r.declarations)+"}"},"page-margin-box"(r){return"@"+r.name+"{"+o(r.declarations)+"}"},rule(r){const a=r.declarations;if(a.length)return r.selectors.join(",")+"{"+o(a)+"}"},supports(r){return"@supports "+r.supports+"{"+o(r.rules)+"}"}};function o(r){let a="";for(let l=0;l<r.length;l++){const s=r[l];t&&t(s);const f=i[s.type](s);f&&(a+=f,f.length&&s.selectors&&(a+=e))}return a}return o(n.stylesheet.rules)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */const Ql=/\s?html\s?/gi,Zl=/\s?body\s?/gi;function xl(n,e){const i=Yl(n.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(r=>Ql.test(r)||Zl.test(r)));return i.forEach(o=>{const r={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new ns(o.declarations,r);o.declarations.forEach(l=>{In(r,es(l)),In(r,ts(l)),In(r,a.convert(l))}),Object.entries(r).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),i.push(os()),i.forEach(o=>{o.selectors=$l(o.selectors,e)}),Jl({stylesheet:{rules:i},type:"stylesheet"})}function $l(n,e){return n.map(t=>`${e} ${t}`)}function In(n,e){return e&&(n[e.key]=e.value),n}function es(n){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(n.property);if(e)return{key:e[1],value:n.value}}function ts(n){if(n.property==="font-family"){let e=n.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:n.property,value:e}}}class ns{constructor(e,t){et(this,"hasLineBreakDefined");this.ruleDeclarations=e,this.newDeclarations=t}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(t=>t.type==="declaration"&&t.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function os(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function is(n,e,t){return Gl(n,t).pipe(Ke(i=>({htmlContent:i,styleSheet:xl(n,e)})))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function rs(n){return new vt(e=>n.subscribe(t=>{e.next(t)}))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function cn(n=Mr){return e=>n?e:Rr}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function zo(n,e,t){return i=>new vt(o=>{const r=n();return i.pipe(ii(Pn),Ia(()=>t(r))).subscribe({next:a=>{e(a,r),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}/**
 * @license BSD-3-Clause
 * Copyright (c) 2023, ッツ Reader Authors
 * All rights reserved.
 */function as(n,e,t,i,o,r,a,l,s,f){switch(e[n.code]){case bt.BOOKMARK:return t(!0),!0;case bt.JUMP_TO_BOOKMARK:return i(),!0;case bt.AUTO_SCROLL_TOGGLE:return r==null||r.toggle(),!0;case bt.AUTO_SCROLL_INCREASE:return o(1),!0;case bt.AUTO_SCROLL_DECREASE:return o(-1),!0;case bt.NEXT_PAGE:return a==null||a.nextPage(),!0;case bt.PREV_PAGE:return a==null||a.prevPage(),!0;case bt.PREV_CHAPTER:return s(l?1:-1),!0;case bt.NEXT_CHAPTER:return s(l?-1:1),!0;case bt.SET_READING_POINT:return f(),!0;default:return!1}}const{document:An,window:No}=Gn;function Ho(n){var S;let e,t,i,o,r,a,l,s;function f(p){n[79](p)}let d={hasChapterData:!!((S=n[26])!=null&&S.length),hasCustomReadingPoint:!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1)),showFullscreenButton:dn.fullscreenEnabled,autoScrollMultiplier:n[29]};return n[10]!==void 0&&(d.isBookmarkScreen=n[10]),t=new Ol({props:d}),ne.push(()=>ce(t,"isBookmarkScreen",f)),t.$on("tocClick",n[80]),t.$on("setCustomReadingPoint",n[75]),t.$on("showCustomReadingPoint",n[81]),t.$on("resetCustomReadingPoint",n[82]),t.$on("fullscreenClick",n[71]),t.$on("bookmarkClick",n[70]),t.$on("settingsClick",n[83]),t.$on("domainHintClick",n[72]),t.$on("bookManagerClick",n[84]),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(p){e=Z(p,"DIV",{class:!0});var y=x(e);ve(t.$$.fragment,y),y.forEach(E),this.h()},h(){U(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(p,y){G(p,e,y),ye(t,e,null),a=!0,l||(s=Wn(o=ci.call(null,e,n[85])),l=!0)},p(p,y){var u;n=p;const w={};y[0]&67108864&&(w.hasChapterData=!!((u=n[26])!=null&&u.length)),y[0]&272678928&&(w.hasCustomReadingPoint=!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1))),y[0]&536870912&&(w.autoScrollMultiplier=n[29]),!i&&y[0]&1024&&(i=!0,w.isBookmarkScreen=n[10],he(()=>i=!1)),t.$set(w),o&&Yo(o.update)&&y[0]&512&&o.update.call(null,n[85])},i(p){a||(j(t.$$.fragment,p),p&&xo(()=>{r||(r=lo(e,Nn,{y:-300,easing:zn},!0)),r.run(1)}),a=!0)},o(p){Y(t.$$.fragment,p),p&&(r||(r=lo(e,Nn,{y:-300,easing:zn},!1)),r.run(0)),a=!1},d(p){p&&E(e),Re(t),p&&r&&r.end(),l=!1,s()}}}function ls(n){let e=(n[52]??"")+"",t;return{c(){t=_e(e)},l(i){t=we(i,e)},m(i,o){G(i,t,o)},p(i,o){o[1]&2097152&&e!==(e=(i[52]??"")+"")&&Ue(t,e)},i:Bt,o:Bt,d(i){i&&E(t)}}}function ss(n){var Ne,Ee,De;let e,t,i,o,r,a,l,s,f,d,S,p,y,w,u,k,g,D=(n[47]??"")+"",O,R,v=(n[48]??"")+"",N,K,F=(n[49]??"")+"",B,V,T=(n[50]??"")+"",I,_,z=(n[51]??"")+"",b,A;e=new Fl({props:{styleSheet:n[30].styleSheet}});function $(C){n[86](C)}function se(C){n[87](C)}function ke(C){n[88](C)}function Ve(C){n[89](C)}function Me(C){n[90](C)}function Se(C){n[91](C)}function Ie(C){n[92](C)}function ze(C){n[93](C)}function de(C){n[94](C)}function ie(C){n[95](C)}function re(C){n[96](C)}function Te(C){n[97](C)}function J(C){n[98](C)}let ee={htmlContent:n[30].htmlContent,width:n[31]??0,height:n[32]??0,verticalMode:n[23],fontColor:(Ne=n[33])==null?void 0:Ne.fontColor,backgroundColor:n[34],hintFuriganaFontColor:(Ee=n[33])==null?void 0:Ee.hintFuriganaFontColor,hintFuriganaShadowColor:(De=n[33])==null?void 0:De.hintFuriganaShadowColor,fontFamilyGroupOne:n[35],fontFamilyGroupTwo:n[36],fontSize:n[37],lineHeight:n[38],hideSpoilerImage:n[39],hideFurigana:n[40],furiganaStyle:n[41],viewMode:n[6],secondDimensionMaxValue:n[42],firstDimensionMargin:n[24],autoPositionOnResize:n[43],avoidPageBreak:n[44],pageColumns:n[45],autoBookmark:n[46],multiplier:n[29]};return n[0]!==void 0&&(ee.exploredCharCount=n[0]),n[1]!==void 0&&(ee.bookCharCount=n[1]),n[10]!==void 0&&(ee.isBookmarkScreen=n[10]),n[3]!==void 0&&(ee.bookmarkData=n[3]),n[2]!==void 0&&(ee.autoScroller=n[2]),n[12]!==void 0&&(ee.bookmarkManager=n[12]),n[13]!==void 0&&(ee.pageManager=n[13]),n[16]!==void 0&&(ee.customReadingPoint=n[16]),n[14]!==void 0&&(ee.customReadingPointTop=n[14]),n[15]!==void 0&&(ee.customReadingPointLeft=n[15]),n[17]!==void 0&&(ee.customReadingPointScrollOffset=n[17]),n[4]!==void 0&&(ee.customReadingPointRange=n[4]),n[5]!==void 0&&(ee.showCustomReadingPoint=n[5]),i=new Ml({props:ee}),ne.push(()=>ce(i,"exploredCharCount",$)),ne.push(()=>ce(i,"bookCharCount",se)),ne.push(()=>ce(i,"isBookmarkScreen",ke)),ne.push(()=>ce(i,"bookmarkData",Ve)),ne.push(()=>ce(i,"autoScroller",Me)),ne.push(()=>ce(i,"bookmarkManager",Se)),ne.push(()=>ce(i,"pageManager",Ie)),ne.push(()=>ce(i,"customReadingPoint",ze)),ne.push(()=>ce(i,"customReadingPointTop",de)),ne.push(()=>ce(i,"customReadingPointLeft",ie)),ne.push(()=>ce(i,"customReadingPointScrollOffset",re)),ne.push(()=>ce(i,"customReadingPointRange",Te)),ne.push(()=>ce(i,"showCustomReadingPoint",J)),i.$on("bookmark",n[70]),{c(){Pe(e.$$.fragment),t=ae(),Pe(i.$$.fragment),g=ae(),O=_e(D),R=ae(),N=_e(v),K=ae(),B=_e(F),V=ae(),I=_e(T),_=ae(),b=_e(z)},l(C){ve(e.$$.fragment,C),t=le(C),ve(i.$$.fragment,C),g=le(C),O=we(C,D),R=le(C),N=we(C,v),K=le(C),B=we(C,F),V=le(C),I=we(C,T),_=le(C),b=we(C,z)},m(C,L){ye(e,C,L),G(C,t,L),ye(i,C,L),G(C,g,L),G(C,O,L),G(C,R,L),G(C,N,L),G(C,K,L),G(C,B,L),G(C,V,L),G(C,I,L),G(C,_,L),G(C,b,L),A=!0},p(C,L){var Be,be,Ae;const He={};L[0]&1073741824&&(He.styleSheet=C[30].styleSheet),e.$set(He);const X={};L[0]&1073741824&&(X.htmlContent=C[30].htmlContent),L[1]&1&&(X.width=C[31]??0),L[1]&2&&(X.height=C[32]??0),L[0]&8388608&&(X.verticalMode=C[23]),L[1]&4&&(X.fontColor=(Be=C[33])==null?void 0:Be.fontColor),L[1]&8&&(X.backgroundColor=C[34]),L[1]&4&&(X.hintFuriganaFontColor=(be=C[33])==null?void 0:be.hintFuriganaFontColor),L[1]&4&&(X.hintFuriganaShadowColor=(Ae=C[33])==null?void 0:Ae.hintFuriganaShadowColor),L[1]&16&&(X.fontFamilyGroupOne=C[35]),L[1]&32&&(X.fontFamilyGroupTwo=C[36]),L[1]&64&&(X.fontSize=C[37]),L[1]&128&&(X.lineHeight=C[38]),L[1]&256&&(X.hideSpoilerImage=C[39]),L[1]&512&&(X.hideFurigana=C[40]),L[1]&1024&&(X.furiganaStyle=C[41]),L[0]&64&&(X.viewMode=C[6]),L[1]&2048&&(X.secondDimensionMaxValue=C[42]),L[0]&16777216&&(X.firstDimensionMargin=C[24]),L[1]&4096&&(X.autoPositionOnResize=C[43]),L[1]&8192&&(X.avoidPageBreak=C[44]),L[1]&16384&&(X.pageColumns=C[45]),L[1]&32768&&(X.autoBookmark=C[46]),L[0]&536870912&&(X.multiplier=C[29]),!o&&L[0]&1&&(o=!0,X.exploredCharCount=C[0],he(()=>o=!1)),!r&&L[0]&2&&(r=!0,X.bookCharCount=C[1],he(()=>r=!1)),!a&&L[0]&1024&&(a=!0,X.isBookmarkScreen=C[10],he(()=>a=!1)),!l&&L[0]&8&&(l=!0,X.bookmarkData=C[3],he(()=>l=!1)),!s&&L[0]&4&&(s=!0,X.autoScroller=C[2],he(()=>s=!1)),!f&&L[0]&4096&&(f=!0,X.bookmarkManager=C[12],he(()=>f=!1)),!d&&L[0]&8192&&(d=!0,X.pageManager=C[13],he(()=>d=!1)),!S&&L[0]&65536&&(S=!0,X.customReadingPoint=C[16],he(()=>S=!1)),!p&&L[0]&16384&&(p=!0,X.customReadingPointTop=C[14],he(()=>p=!1)),!y&&L[0]&32768&&(y=!0,X.customReadingPointLeft=C[15],he(()=>y=!1)),!w&&L[0]&131072&&(w=!0,X.customReadingPointScrollOffset=C[17],he(()=>w=!1)),!u&&L[0]&16&&(u=!0,X.customReadingPointRange=C[4],he(()=>u=!1)),!k&&L[0]&32&&(k=!0,X.showCustomReadingPoint=C[5],he(()=>k=!1)),i.$set(X),(!A||L[1]&65536)&&D!==(D=(C[47]??"")+"")&&Ue(O,D),(!A||L[1]&131072)&&v!==(v=(C[48]??"")+"")&&Ue(N,v),(!A||L[1]&262144)&&F!==(F=(C[49]??"")+"")&&Ue(B,F),(!A||L[1]&524288)&&T!==(T=(C[50]??"")+"")&&Ue(I,T),(!A||L[1]&1048576)&&z!==(z=(C[51]??"")+"")&&Ue(b,z)},i(C){A||(j(e.$$.fragment,C),j(i.$$.fragment,C),A=!0)},o(C){Y(e.$$.fragment,C),Y(i.$$.fragment,C),A=!1},d(C){Re(e,C),C&&E(t),Re(i,C),C&&E(g),C&&E(O),C&&E(R),C&&E(N),C&&E(K),C&&E(B),C&&E(V),C&&E(I),C&&E(_),C&&E(b)}}}function Go(n){let e,t,i,o,r,a;return t=new Nl({props:{sectionData:n[26],verticalMode:n[23],exploredCharCount:n[0]}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(l){e=Z(l,"DIV",{class:!0});var s=x(e);ve(t.$$.fragment,s),s.forEach(E),this.h()},h(){var l;U(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),M(e,"color",(l=n[33])==null?void 0:l.fontColor),M(e,"background-color",n[34])},m(l,s){G(l,e,s),ye(t,e,null),o=!0,r||(a=Wn(ci.call(null,e,n[99])),r=!0)},p(l,s){var d;n=l;const f={};s[0]&67108864&&(f.sectionData=n[26]),s[0]&8388608&&(f.verticalMode=n[23]),s[0]&1&&(f.exploredCharCount=n[0]),t.$set(f),s[1]&4&&M(e,"color",(d=n[33])==null?void 0:d.fontColor),s[1]&8&&M(e,"background-color",n[34])},i(l){o||(j(t.$$.fragment,l),l&&(i||xo(()=>{i=fr(e,Nn,{x:-100,duration:100,easing:zn}),i.start()})),o=!0)},o(l){Y(t.$$.fragment,l),o=!1},d(l){l&&E(e),Re(t),r=!1,a()}}}function Wo(n){let e,t,i;return{c(){e=Q("div"),t=ae(),i=Q("div"),this.h()},l(o){e=Z(o,"DIV",{class:!0}),x(e).forEach(E),t=le(o),i=Z(o,"DIV",{class:!0}),x(i).forEach(E),this.h()},h(){U(e,"class","fixed left-0 z-20 h-[1px] w-full border border-red-500"),M(e,"top",`${n[14]}px`),U(i,"class","fixed top-0 z-20 h-full w-[1px] border border-red-500"),M(i,"left",`${n[15]}px`)},m(o,r){G(o,e,r),G(o,t,r),G(o,i,r)},p(o,r){r[0]&16384&&M(e,"top",`${o[14]}px`),r[0]&32768&&M(i,"left",`${o[15]}px`)},d(o){o&&E(e),o&&E(t),o&&E(i)}}}function jo(n){let e,t,i;return t=new st({props:{icon:Kn,spin:!0}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);ve(t.$$.fragment,r),r.forEach(E),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl")},m(o,r){G(o,e,r),ye(t,e,null),i=!0},p:Bt,i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&E(e),Re(t)}}}function Xo(n){let e,t,i,o,r;return t=new st({props:{icon:ra}}),{c(){e=Q("div"),Pe(t.$$.fragment),this.h()},l(a){e=Z(a,"DIV",{class:!0});var l=x(e);ve(t.$$.fragment,l),l.forEach(E),this.h()},h(){U(e,"class","flex h-full w-8 items-center justify-center text-lg"),q(e,"text-red-500",n[20]>1),q(e,"animate-pulse",n[20]>1||n[21])},m(a,l){G(a,e,l),ye(t,e,null),i=!0,o||(r=[me(e,"click",cr(n[100])),me(e,"keyup",wt)],o=!0)},p(a,l){(!i||l[0]&1048576)&&q(e,"text-red-500",a[20]>1),(!i||l[0]&3145728)&&q(e,"animate-pulse",a[20]>1||a[21])},i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&E(e),Re(t),o=!1,St(r)}}}function qo(n){let e,t,i,o,r,a=(n[0]/n[1]*100).toFixed(2)+"",l,s;return{c(){e=Q("div"),t=_e(n[0]),i=_e(" / "),o=_e(n[1]),r=_e(" ("),l=_e(a),s=_e("%)"),this.h()},l(f){e=Z(f,"DIV",{class:!0});var d=x(e);t=we(d,n[0]),i=we(d," / "),o=we(d,n[1]),r=we(d," ("),l=we(d,a),s=we(d,"%)"),d.forEach(E),this.h()},h(){var f;U(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),M(e,"color",(f=n[33])==null?void 0:f.tooltipTextFontColor)},m(f,d){G(f,e,d),oe(e,t),oe(e,i),oe(e,o),oe(e,r),oe(e,l),oe(e,s)},p(f,d){var S;d[0]&1&&Ue(t,f[0]),d[0]&2&&Ue(o,f[1]),d[0]&3&&a!==(a=(f[0]/f[1]*100).toFixed(2)+"")&&Ue(l,a),d[1]&4&&M(e,"color",(S=f[33])==null?void 0:S.tooltipTextFontColor)},d(f){f&&E(e)}}}function us(n){var z;let e,t,i=(n[27]??"")+"",o,r,a,l,s,f,d,S,p,y,w,u,k,g,D,O,R;An.title=e=ho(((z=n[25])==null?void 0:z.title)??"");let v=n[9]&&Ho(n);const N=[ss,ls],K=[];function F(b,A){return b[30]?0:1}f=F(n),d=K[f]=N[f](n);let B=n[7]&&Go(n),V=(n[18]&&!n[53]||!n[22]&&n[5])&&Wo(n),T=n[8]&&jo(),I=n[19].length&&Xo(n),_=n[11]&&n[1]&&qo(n);return{c(){t=ae(),o=_e(i),r=ae(),a=Q("button"),l=ae(),v&&v.c(),s=ae(),d.c(),S=ae(),B&&B.c(),p=ae(),V&&V.c(),y=ae(),T&&T.c(),w=ae(),u=Q("div"),k=Q("div"),I&&I.c(),g=ae(),_&&_.c(),this.h()},l(b){ur("svelte-rnuhm6",An.head).forEach(E),t=le(b),o=we(b,i),r=le(b),a=Z(b,"BUTTON",{class:!0}),x(a).forEach(E),l=le(b),v&&v.l(b),s=le(b),d.l(b),S=le(b),B&&B.l(b),p=le(b),V&&V.l(b),y=le(b),T&&T.l(b),w=le(b),u=Z(b,"DIV",{class:!0});var $=x(u);k=Z($,"DIV",{class:!0});var se=x(k);I&&I.l(se),se.forEach(E),g=le($),_&&_.l($),$.forEach(E),this.h()},h(){var b;U(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),U(k,"class","h-full"),U(u,"class","writing-horizontal-tb fixed bottom-0 left-0 z-10 flex h-8 w-full cursor-pointer items-center justify-between text-xs leading-none"),M(u,"color",(b=n[33])==null?void 0:b.tooltipTextFontColor)},m(b,A){G(b,t,A),G(b,o,A),G(b,r,A),G(b,a,A),G(b,l,A),v&&v.m(b,A),G(b,s,A),K[f].m(b,A),G(b,S,A),B&&B.m(b,A),G(b,p,A),V&&V.m(b,A),G(b,y,A),T&&T.m(b,A),G(b,w,A),G(b,u,A),oe(u,k),I&&I.m(k,null),oe(u,g),_&&_.m(u,null),D=!0,O||(R=[me(No,"keydown",n[69]),me(No,"beforeunload",n[68]),me(a,"click",n[78]),me(u,"click",n[101]),me(u,"keyup",wt)],O=!0)},p(b,A){var se,ke;(!D||A[0]&33554432)&&e!==(e=ho(((se=b[25])==null?void 0:se.title)??""))&&(An.title=e),(!D||A[0]&134217728)&&i!==(i=(b[27]??"")+"")&&Ue(o,i),b[9]?v?(v.p(b,A),A[0]&512&&j(v,1)):(v=Ho(b),v.c(),j(v,1),v.m(s.parentNode,s)):v&&(rt(),Y(v,1,1,()=>{v=null}),at());let $=f;f=F(b),f===$?K[f].p(b,A):(rt(),Y(K[$],1,1,()=>{K[$]=null}),at(),d=K[f],d?d.p(b,A):(d=K[f]=N[f](b),d.c()),j(d,1),d.m(S.parentNode,S)),b[7]?B?(B.p(b,A),A[0]&128&&j(B,1)):(B=Go(b),B.c(),j(B,1),B.m(p.parentNode,p)):B&&(rt(),Y(B,1,1,()=>{B=null}),at()),b[18]&&!b[53]||!b[22]&&b[5]?V?V.p(b,A):(V=Wo(b),V.c(),V.m(y.parentNode,y)):V&&(V.d(1),V=null),b[8]?T?(T.p(b,A),A[0]&256&&j(T,1)):(T=jo(),T.c(),j(T,1),T.m(w.parentNode,w)):T&&(rt(),Y(T,1,1,()=>{T=null}),at()),b[19].length?I?(I.p(b,A),A[0]&524288&&j(I,1)):(I=Xo(b),I.c(),j(I,1),I.m(k,null)):I&&(rt(),Y(I,1,1,()=>{I=null}),at()),b[11]&&b[1]?_?_.p(b,A):(_=qo(b),_.c(),_.m(u,null)):_&&(_.d(1),_=null),A[1]&4&&M(u,"color",(ke=b[33])==null?void 0:ke.tooltipTextFontColor)},i(b){D||(j(v),j(d),j(B),j(T),j(I),D=!0)},o(b){Y(v),Y(d),Y(B),Y(T),Y(I),D=!1},d(b){b&&E(t),b&&E(o),b&&E(r),b&&E(a),b&&E(l),v&&v.d(b),b&&E(s),K[f].d(b),b&&E(S),B&&B.d(b),b&&E(p),V&&V.d(b),b&&E(y),T&&T.d(b),b&&E(w),b&&E(u),I&&I.d(),_&&_.d(),O=!1,St(R)}}}const Ko="background-color",Uo="writing-mode";function fs(n,e,t){let i,o,r,a,l,s,f,d,S,p,y,w,u,k,g,D,O,R,v,N,K,F,B,V,T,I,_,z,b,A,$,se,ke,Ve,Me,Se,Ie,ze,de,ie,re,Te,J,ee,Ne,Ee;W(n,Ir,c=>t(23,r=c)),W(n,ri,c=>t(24,a=c)),W(n,Ar,c=>t(108,l=c)),W(n,Or,c=>t(109,s=c)),W(n,Lr,c=>t(110,d=c)),W(n,Vr,c=>t(111,S=c)),W(n,ai,c=>t(112,y=c)),W(n,Ut,c=>t(113,w=c)),W(n,zr,c=>t(77,u=c)),W(n,Nr,c=>t(114,k=c)),W(n,Hr,c=>t(115,g=c)),W(n,li,c=>t(6,D=c)),W(n,Nt,c=>t(7,O=c)),W(n,Dn,c=>t(116,R=c)),W(n,Fn,c=>t(117,v=c)),W(n,jn,c=>t(28,K=c)),W(n,Tn,c=>t(29,F=c)),W(n,Gr,c=>t(35,z=c)),W(n,Wr,c=>t(36,b=c)),W(n,jr,c=>t(37,A=c)),W(n,Xr,c=>t(38,$=c)),W(n,qr,c=>t(39,se=c)),W(n,Kr,c=>t(40,ke=c)),W(n,Ur,c=>t(41,Ve=c)),W(n,Yr,c=>t(42,Me=c)),W(n,Jr,c=>t(43,Se=c)),W(n,Qr,c=>t(44,Ie=c)),W(n,Zr,c=>t(45,ze=c)),W(n,xr,c=>t(46,de=c)),W(n,Xn,c=>t(53,Ee=c));let De=!0,C=!0,L=!1,He=!0,X=0,Be=0,be,Ae,dt,Ye=Promise.resolve(void 0),Ce=-2,pe=-2,Je=r?v:R,Qe=0,ge,ut,Ge=!0,pt=!1,je=!1,Ze,Xe=[],gt=[],Fe,kt=0,P=!1,ue=0;const We=nn(2500).pipe(_t(()=>t(9,C=!1)),Mt());W(n,We,c=>t(27,N=c));const Oe=Ot(()=>rs($r)).pipe(Ke(c=>Number(c.url.searchParams.get("id"))),Ln({refCount:!0,bufferSize:1})),m=Oe.pipe(zt(async c=>{let H;try{if(Ze=ln(window,sn.BROWSER,void 0,!0,l,s),Ze.startContext({id:c,title:""}),H=await Ze.getBook(),!H)return H;Ze.startContext({id:H.id,title:H.title,imagePath:H.coverImage}),H.storageSource?t(76,Fe=await oo(H.storageSource,!0)):u!==Xt.Off&&t(76,Fe=await oo(S)),H.lastBookOpen=new Date().getTime(),await Ze.updateLastRead(H),H=await Ri(Fe,H),await Mi(Fe)}catch(fe){const Le=`Error loading book: ${fe.message}`;mt.warn(Le),tt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:Le}}]);return}finally{t(8,De=!1)}return Fe&&Fe.updateSettings(window,!0,s,l,!1,H.storageSource||S),H}),Vn());W(n,m,c=>t(25,f=c));const te=m.pipe(_t(c=>{c||go(`${fo}${qe.MANAGE.routeId}`)}),Mt());W(n,te,c=>t(52,Ne=c));const h=m.pipe(_t(c=>{c&&t(3,Ye=En.getBookmark(c.id))}),Mt());W(n,h,c=>t(47,ie=c));const ft=m.pipe(zt(c=>c?(Yn.next(c.sections||[]),is(c,".book-content",document)):Gt),Ln({refCount:!0,bufferSize:1}));W(n,ft,c=>t(30,B=c));const an=Ot(()=>visualViewport?lt(visualViewport,"resize"):Un()).pipe(Vn()),Qn=an.pipe(On(0),Ke(()=>(visualViewport==null?void 0:visualViewport.width)||0),cn());W(n,Qn,c=>t(31,V=c));const Zn=an.pipe(On(0),Ke(()=>(visualViewport==null?void 0:visualViewport.height)||0),cn());W(n,Zn,c=>t(32,T=c));const vn=Er.pipe(Ke(c=>ha.get(c)),$t(c=>!!c));W(n,vn,c=>t(33,I=c));const yn=vn.pipe(Ke(c=>c.backgroundColor));W(n,yn,c=>t(34,_=c));const xn=yn.pipe(zo(()=>document.body,(c,H)=>H.style.setProperty(Ko,c),c=>c.style.removeProperty(Ko)),Mt(),cn());W(n,xn,c=>t(48,re=c));const $n=Dr.pipe(zo(()=>document.documentElement,(c,H)=>H.style.setProperty(Uo,c),c=>c.style.removeProperty(Uo)),Mt(),cn());W(n,$n,c=>t(49,Te=c));const eo=Ot(()=>bn).pipe(Ke(c=>[...c.values()]));W(n,eo,c=>t(26,p=c));const to=Ot(()=>lt(document,"selectionchange")).pipe(xt(200),_t(()=>{var H,fe;const c=((H=window.getSelection())==null?void 0:H.toString())||"";!c&&Ge?ut=void 0:c?(ut=(fe=window.getSelection())==null?void 0:fe.getRangeAt(0),Ge=!1):Ge=!0}),Mt());W(n,to,c=>t(50,J=c));const no=Bn.pipe(Fa(6e4),zt(()=>jt()),Mt());W(n,no,c=>t(51,ee=c));function yi(c){return g&&(P||ue!==X||o&&Xe.length||o&&gt.length)?(c.preventDefault(),c.returnValue="Are you sure you want to exit?"):c}async function oo(c,H=!1){if(!c){if(H)throw new Error("No storage source found");return}if(c===uo.GDRIVE_DEFAULT){if(!k){tt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,sn.GDRIVE,c,!0,l,s)}if(c===uo.ONEDRIVE_DEFAULT){if(!k){tt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,sn.ONEDRIVE,c,!0,l,s)}if(c){const xe=await(await En.db).get("storageSource",c);if(xe){if(xe.type!==sn.FS&&!k){tt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,xe.type,c,!0,l,s)}if(H)throw new Error(`No storage source with name ${c} found`)}const fe=`No storage source with name ${c} found - skipping auto import/export`;mt.warn(fe),tt.dialogs$.next([{component:Ct,props:{title:"Configuration Error",message:fe}}])}async function Ri(c,H){if(!c)return H;l||c.clearData(!1),c.startContext({id:H.id,title:H.title,imagePath:H.coverImage||""});let{id:fe,...Le}=H;if(H.storageSource){const ot=await c.getBook();ot&&!(ot instanceof File)&&(Le={...ot,id:H.id,lastBookOpen:H.lastBookOpen,storageSource:H.storageSource})}else if(!H.elementHtml)throw new Error("Book has no data stored");const xe={id:fe,...Le};return await c.updateLastRead(xe).catch(ot=>{const $e=`Failed to update last read on external storage: ${ot.message}`;mt.warn($e),tt.dialogs$.next([{component:Ct,props:{title:"Update Error",message:$e}}])}),xe}async function Mi(c){if(Ze&&c&&(u===Xt.Down||u===Xt.All)){const H=await c.getProgress();H&&!(H instanceof File)&&(await Ze.saveProgress(H),ue=H.exploredCharCount||0)}}function Ei(c){w||!as(c,Br.getValue(),Rn,Fi,fe=>Tn.next(Tn.getValue()+fe),be,dt,r,Ii,ro)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c.preventDefault())}function Di(){let c;return Oe.subscribe(H=>c=H).unsubscribe(),c}async function Rn(c){var Le;const H=Di();if(!H||!Ae)return;let fe;if(t(9,C=!1),i){const xe=y?Ga(window,ut):void 0,ot=xe||ge;Kt((Le=ot==null?void 0:ot.endContainer)==null?void 0:Le.parentElement,"add",.5,500),fe=Ae.formatBookmarkDataByRange(H,ot),xe&&bi(window)}else fe=Ae.formatBookmarkData(H,Qe);if(await Ze.saveProgress(fe),o){const xe=P?gt:Xe;xe.includes(co.PROGRESS)||xe.push(co.PROGRESS),c&&Bn.next()}t(3,Ye=Promise.resolve(fe))}async function Fi(){const c=await Ye;!c||!Ae||Ae.scrollToBookmark(c,Qe)}function Ti(){if(t(9,C=!1),!dn.fullscreenElement){dn.requestFullscreen(document.documentElement);return}dn.exitFullscreen()}function Bi(){tt.dialogs$.next([{component:Ct,props:{title:"Old Domain",message:"You are currently using the old domain of ッツ Reader - consider switching to https://reader.ttsu.app to prevent issues and to ensure full features"},disableCloseOnClick:!0}])}function Ii(c){if(!(p!=null&&p.length))return;const[H,fe]=pi(p);!fe&&c===-1||c===1&&fe===H.length-1||rn.next(H[fe+c].reference)}async function jt(c=!0){if(P||!Xe.length||!f||!Fe)return;t(21,P=!0),c||(Ut.next(!0),mt.clearHistory(),io());const H=f.storageSource||S;Fe.updateSettings(window,!1,s,l,!c,H);const fe=await Fr(Ze,Fe,!c&&d===Fe.storageType,[{id:f.id,title:f.title,imagePath:f.coverImage}],Xe).catch(Le=>Le.message);if(Fe.updateSettings(window,!0,s,l,!1,H),t(21,P=!1),fe){if(!c){const Le=mt.errorCount>1;mt.warn(fe),tt.dialogs$.next([{component:Le?Tr:Ct,props:{title:"Error Processing Data",message:Le?"Some or all data could not be stored on an external storage":fe}}])}t(20,kt+=1)}else t(20,kt=0),c||tt.dialogs$.next([]),gt.length?(t(19,Xe=JSON.parse(JSON.stringify(gt))),gt=[],c?Bn.next():await jt(!1)):t(19,Xe=[]);c||Ut.next(!1)}function io(){tt.dialogs$.next([{component:"<div/>",disableCloseOnClick:!0}])}async function Mn(c,H=!0){io();let fe;try{H&&await En.deleteLastItem(),await Rn(!1),tt.dialogs$.next([]),o&&await jt(!1)}catch(Le){fe=Le.message}fe&&(mt.warn(fe),tt.dialogs$.next([{component:Ct,props:{title:"Error",message:fe},disableCloseOnClick:!0}])),go(`${fo}${c}`)}function ro(){const c=document.querySelector(".book-content");if(!c)return;i&&(t(14,Ce=window.innerHeight/2-2),t(15,pe=window.innerWidth/2-2)),t(9,C=!1),t(18,pt=!0),document.body.classList.add("cursor-crosshair");const{elLeftReferencePoint:H,elTopReferencePoint:fe,elRightReferencePoint:Le,elBottomReferencePoint:xe,pointGap:ot}=Ci(window,c,r,a);on(lt(document,"pointerup"),lt(document,"pointermove")).pipe(Oa(()=>pt)).subscribe($e=>{if($e instanceof PointerEvent)if($e.type==="pointerup")document.body.classList.remove("cursor-crosshair"),t(18,pt=!1),hr().then(()=>{t(15,pe=r?$e.x:pe),t(14,Ce=r?Ce:$e.y);const yt=Ha(pe,Ce);if(yt&&Kt(yt.parent,"add",.5,500),i)t(4,ge=yt==null?void 0:yt.range);else{let Rt=0;r?(Rt=Math.ceil(Math.max(0,pe-H)/(Le-H)*100),Fn.next(Rt)):(Rt=Math.ceil(Math.max(0,Ce-fe)/(xe-fe)*100),Dn.next(Rt)),t(16,Je=Rt)}});else{const yt=$e.x>=H+ot&&$e.x<=Le,Rt=$e.y>=fe&&$e.y<=xe-ot;i?(t(14,Ce=Rt?$e.y:Ce),t(15,pe=yt?$e.x:pe)):r&&yt?t(15,pe=$e.x):!r&&Rt&&t(14,Ce=$e.y)}})}const Ai=()=>t(9,C=!0);function Oi(c){L=c,t(10,L)}const Li=()=>{t(9,C=!1),Nt.next(!0)},Vi=()=>{t(9,C=!1),t(5,je=!0)},zi=()=>{t(9,C=!1),i?t(4,ge=void 0):r?(Fn.next(100),t(16,Je=100)):(Dn.next(0),t(16,Je=0))},Ni=()=>Mn(qe.SETTINGS.routeId,!1),Hi=()=>Mn(qe.MANAGE.routeId),Gi=()=>t(9,C=!1);function Wi(c){X=c,t(0,X)}function ji(c){Be=c,t(1,Be)}function Xi(c){L=c,t(10,L)}function qi(c){Ye=c,t(3,Ye)}function Ki(c){be=c,t(2,be)}function Ui(c){Ae=c,t(12,Ae)}function Yi(c){dt=c,t(13,dt)}function Ji(c){Je=c,t(16,Je)}function Qi(c){Ce=c,t(14,Ce)}function Zi(c){pe=c,t(15,pe)}function xi(c){Qe=c,t(17,Qe)}function $i(c){ge=c,t(4,ge)}function er(c){je=c,t(5,je),t(4,ge)}const tr=()=>Nt.next(!1),nr=()=>jt(!1),or=()=>t(11,He=!He);return n.$$.update=()=>{var c;n.$$.dirty[0]&132&&O&&(be==null||be.off()),n.$$.dirty[0]&3&&Be&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{exploredCharCount:X}})),n.$$.dirty[0]&2&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{bookCharCount:Be}})),n.$$.dirty[0]&48&&je&&(Kt((c=ge==null?void 0:ge.endContainer)==null?void 0:c.parentElement,"add",1),lt(document,"click").pipe(mn(1),Wt(1)).subscribe(()=>{var H;t(5,je=!1),Kt((H=ge==null?void 0:ge.endContainer)==null?void 0:H.parentElement,"remove",1)})),n.$$.dirty[0]&64&&t(22,i=D===Tt.Paginated),n.$$.dirty[2]&49152&&(o=Fe&&(u===Xt.Up||u===Xt.All)),n.$$.dirty[0]&8&&Ye.then(H=>ue=(H==null?void 0:H.exploredCharCount)||0)},[X,Be,be,Ye,ge,je,D,O,De,C,L,He,Ae,dt,Ce,pe,Je,Qe,pt,Xe,kt,P,i,r,a,f,p,N,K,F,B,V,T,I,_,z,b,A,$,se,ke,Ve,Me,Se,Ie,ze,de,ie,re,Te,J,ee,Ne,Ee,We,m,te,h,ft,Qn,Zn,vn,yn,xn,$n,eo,to,no,yi,Ei,Rn,Ti,Bi,jt,Mn,ro,Fe,u,Ai,Oi,Li,Vi,zi,Ni,Hi,Gi,Wi,ji,Xi,qi,Ki,Ui,Yi,Ji,Qi,Zi,xi,$i,er,tr,nr,or]}class Ss extends Et{constructor(e){super(),Dt(this,e,fs,us,Ft,{},null,[-1,-1,-1,-1,-1])}}export{Ss as default};
